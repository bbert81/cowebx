/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/mdnd/AreaManager"],function(_1,_2,_3){_1.getObject("dojox.mdnd.dropMode.OverDropMode",1);_1.declare("dojox.mdnd.dropMode.OverDropMode",null,{_oldXPoint:null,_oldYPoint:null,_oldBehaviour:"up",constructor:function(){this._dragHandler=[_1.connect(_3.mdnd.areaManager(),"onDragEnter",function(_4,_5){var m=_3.mdnd.areaManager();if(m._oldIndexArea==-1){m._oldIndexArea=m._lastValidIndexArea;}})];},addArea:function(_6,_7){var _8=_6.length,_9=_1.position(_7.node,true);_7.coords={"x":_9.x,"y":_9.y};if(_8==0){_6.push(_7);}else{var x=_7.coords.x;for(var i=0;i<_8;i++){if(x<_6[i].coords.x){for(var j=_8-1;j>=i;j--){_6[j+1]=_6[j];}_6[i]=_7;break;}}if(i==_8){_6.push(_7);}}return _6;},updateAreas:function(_a){var _b=_a.length;for(var i=0;i<_b;i++){this._updateArea(_a[i]);}},_updateArea:function(_c){var _d=_1.position(_c.node,true);_c.coords.x=_d.x;_c.coords.x2=_d.x+_d.w;_c.coords.y=_d.y;},initItems:function(_e){_1.forEach(_e.items,function(_f){var _10=_f.item.node;var _11=_1.position(_10,true);var y=_11.y+_11.h/2;_f.y=y;});_e.initItems=true;},refreshItems:function(_12,_13,_14,_15){if(_13==-1){return;}else{if(_12&&_14&&_14.h){var _16=_14.h;if(_12.margin){_16+=_12.margin.t;}var _17=_12.items.length;for(var i=_13;i<_17;i++){var _18=_12.items[i];if(_15){_18.y+=_16;}else{_18.y-=_16;}}}}},getDragPoint:function(_19,_1a,_1b){return {"x":_1b.x,"y":_1b.y};},getTargetArea:function(_1c,_1d,_1e){var _1f=0;var x=_1d.x;var y=_1d.y;var end=_1c.length;var _20=0,_21="right",_22=false;if(_1e==-1||arguments.length<3){_22=true;}else{if(this._checkInterval(_1c,_1e,x,y)){_1f=_1e;}else{if(this._oldXPoint<x){_20=_1e+1;}else{_20=_1e-1;end=0;_21="left";}_22=true;}}if(_22){if(_21==="right"){for(var i=_20;i<end;i++){if(this._checkInterval(_1c,i,x,y)){_1f=i;break;}}if(i==end){_1f=-1;}}else{for(var i=_20;i>=end;i--){if(this._checkInterval(_1c,i,x,y)){_1f=i;break;}}if(i==end-1){_1f=-1;}}}this._oldXPoint=x;return _1f;},_checkInterval:function(_23,_24,x,y){var _25=_23[_24];var _26=_25.node;var _27=_25.coords;var _28=_27.x;var _29=_27.x2;var _2a=_27.y;var _2b=_2a+_26.offsetHeight;if(_28<=x&&x<=_29&&_2a<=y&&y<=_2b){return true;}return false;},getDropIndex:function(_2c,_2d){var _2e=_2c.items.length;var _2f=_2c.coords;var y=_2d.y;if(_2e>0){for(var i=0;i<_2e;i++){if(y<_2c.items[i].y){return i;}else{if(i==_2e-1){return -1;}}}}return -1;},destroy:function(){_1.forEach(this._dragHandler,_1.disconnect);}});(function(){_3.mdnd.areaManager()._dropMode=new _3.mdnd.dropMode.OverDropMode();}());});require(["dojox/mdnd/dropMode/OverDropMode"]);