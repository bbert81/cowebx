/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox"],function(_1,_2,_3){_1.getObject("dojox.mdnd.Moveable",1);_1.declare("dojox.mdnd.Moveable",null,{handle:null,skip:true,dragDistance:3,constructor:function(_4,_5){this.node=_1.byId(_5);this.d=this.node.ownerDocument;if(!_4){_4={};}this.handle=_4.handle?_1.byId(_4.handle):null;if(!this.handle){this.handle=this.node;}this.skip=_4.skip;this.events=[_1.connect(this.handle,"onmousedown",this,"onMouseDown")];if(_3.mdnd.autoScroll){this.autoScroll=_3.mdnd.autoScroll;}},isFormElement:function(e){var t=e.target;if(t.nodeType==3){t=t.parentNode;}return " a button textarea input select option ".indexOf(" "+t.tagName.toLowerCase()+" ")>=0;},onMouseDown:function(e){if(this._isDragging){return;}var _6=_1.isIE?(e.button==1):(e.which==1);if(!_6){return;}if(this.skip&&this.isFormElement(e)){return;}if(this.autoScroll){this.autoScroll.setAutoScrollNode(this.node);this.autoScroll.setAutoScrollMaxPage();}this.events.push(_1.connect(this.d,"onmouseup",this,"onMouseUp"));this.events.push(_1.connect(this.d,"onmousemove",this,"onFirstMove"));this._selectStart=_1.connect(_1.body(),"onselectstart",_1.stopEvent);this._firstX=e.clientX;this._firstY=e.clientY;_1.stopEvent(e);},onFirstMove:function(e){_1.stopEvent(e);var d=(this._firstX-e.clientX)*(this._firstX-e.clientX)+(this._firstY-e.clientY)*(this._firstY-e.clientY);if(d>this.dragDistance*this.dragDistance){this._isDragging=true;_1.disconnect(this.events.pop());_1.style(this.node,"width",_1.contentBox(this.node).w+"px");this.initOffsetDrag(e);this.events.push(_1.connect(this.d,"onmousemove",this,"onMove"));}},initOffsetDrag:function(e){this.offsetDrag={"l":e.pageX,"t":e.pageY};var s=this.node.style;var _7=_1.position(this.node,true);this.offsetDrag.l=_7.x-this.offsetDrag.l;this.offsetDrag.t=_7.y-this.offsetDrag.t;var _8={"x":_7.x,"y":_7.y};this.size={"w":_7.w,"h":_7.h};this.onDragStart(this.node,_8,this.size);},onMove:function(e){_1.stopEvent(e);if(_1.isIE==8&&new Date()-this.date<20){return;}if(this.autoScroll){this.autoScroll.checkAutoScroll(e);}var _9={"x":this.offsetDrag.l+e.pageX,"y":this.offsetDrag.t+e.pageY};var s=this.node.style;s.left=_9.x+"px";s.top=_9.y+"px";this.onDrag(this.node,_9,this.size,{"x":e.pageX,"y":e.pageY});if(_1.isIE==8){this.date=new Date();}},onMouseUp:function(e){if(this._isDragging){_1.stopEvent(e);this._isDragging=false;if(this.autoScroll){this.autoScroll.stopAutoScroll();}delete this.onMove;this.onDragEnd(this.node);this.node.focus();}_1.disconnect(this.events.pop());_1.disconnect(this.events.pop());},onDragStart:function(_a,_b,_c){},onDragEnd:function(_d){},onDrag:function(_e,_f,_10,_11){},destroy:function(){_1.forEach(this.events,_1.disconnect);this.events=this.node=null;}});});require(["dojox/mdnd/Moveable"]);