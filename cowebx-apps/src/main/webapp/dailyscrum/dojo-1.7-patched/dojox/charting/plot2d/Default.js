/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/lang","dojo/_base/declare","./Base","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx"],function(_1,_2,_3,dc,df,_4,du,fx){var _5=df.lambda("item.purgeGroup()");var _6=1200;return _1.declare("dojox.charting.plot2d.Default",dojox.charting.plot2d.Base,{defaultParams:{hAxis:"x",vAxis:"y",lines:true,areas:false,markers:false,tension:"",animate:false,enableCache:false},optionalParams:{stroke:{},outline:{},shadow:{},fill:{},font:"",fontColor:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerFont:"",markerFontColor:""},constructor:function(_7,_8){this.opt=_1.clone(this.defaultParams);du.updateWithObject(this.opt,_8);du.updateWithPattern(this.opt,_8,this.optionalParams);this.series=[];this.hAxis=this.opt.hAxis;this.vAxis=this.opt.vAxis;this.animate=this.opt.animate;},createPath:function(_9,_a,_b){var _c;if(this.opt.enableCache&&_9._pathFreePool.length>0){_c=_9._pathFreePool.pop();_c.setShape(_b);_a.add(_c);}else{_c=_a.createPath(_b);}if(this.opt.enableCache){_9._pathUsePool.push(_c);}return _c;},render:function(_d,_e){if(this.zoom&&!this.isDataDirty()){return this.performZoom(_d,_e);}this.resetEvents();this.dirty=this.isDirty();if(this.dirty){_1.forEach(this.series,_5);this._eventSeries={};this.cleanGroup();this.group.setTransform(null);var s=this.group;df.forEachRev(this.series,function(_f){_f.cleanGroup(s);});}var t=this.chart.theme,_10,_11,_12,_13=this.events();for(var i=this.series.length-1;i>=0;--i){var run=this.series[i];if(!this.dirty&&!run.dirty){t.skip();this._reconnectEvents(run.name);continue;}run.cleanGroup();if(this.opt.enableCache){run._pathFreePool=(run._pathFreePool?run._pathFreePool:[]).concat(run._pathUsePool?run._pathUsePool:[]);run._pathUsePool=[];}if(!run.data.length){run.dirty=false;t.skip();continue;}var _14=t.next(this.opt.areas?"area":"line",[this.opt,run],true),s=run.group,_15=[],_16=[],_17=null,_18,ht=this._hScaler.scaler.getTransformerFromModel(this._hScaler),vt=this._vScaler.scaler.getTransformerFromModel(this._vScaler),_19=this._eventSeries[run.name]=new Array(run.data.length);var _1a=typeof run.data[0]=="number";var min=_1a?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0,max=_1a?Math.min(run.data.length,Math.ceil(this._hScaler.bounds.to)):run.data.length;for(var j=min;j<max;j++){if(run.data[j]!=null){if(!_17){_17=[];_16.push(j);_15.push(_17);}_17.push(run.data[j]);}else{_17=null;}}for(var seg=0;seg<_15.length;seg++){if(typeof _15[seg][0]=="number"){_18=_1.map(_15[seg],function(v,i){return {x:ht(i+_16[seg]+1)+_e.l,y:_d.height-_e.b-vt(v)};},this);}else{_18=_1.map(_15[seg],function(v,i){return {x:ht(v.x)+_e.l,y:_d.height-_e.b-vt(v.y)};},this);}var _1b=this.opt.tension?dc.curve(_18,this.opt.tension):"";if(this.opt.areas&&_18.length>1){var _1c=_14.series.fill;var _1d=_1.clone(_18);if(this.opt.tension){var _1e="L"+_1d[_1d.length-1].x+","+(_d.height-_e.b)+" L"+_1d[0].x+","+(_d.height-_e.b)+" L"+_1d[0].x+","+_1d[0].y;run.dyn.fill=s.createPath(_1b+" "+_1e).setFill(_1c).getFill();}else{_1d.push({x:_18[_18.length-1].x,y:_d.height-_e.b});_1d.push({x:_18[0].x,y:_d.height-_e.b});_1d.push(_18[0]);run.dyn.fill=s.createPolyline(_1d).setFill(_1c).getFill();}}if(this.opt.lines||this.opt.markers){_10=_14.series.stroke;if(_14.series.outline){_11=run.dyn.outline=dc.makeStroke(_14.series.outline);_11.width=2*_11.width+_10.width;}}if(this.opt.markers){run.dyn.marker=_14.symbol;}var _1f=null,_20=null,_21=null;if(_10&&_14.series.shadow&&_18.length>1){var _22=_14.series.shadow,_23=_1.map(_18,function(c){return {x:c.x+_22.dx,y:c.y+_22.dy};});if(this.opt.lines){if(this.opt.tension){run.dyn.shadow=s.createPath(dc.curve(_23,this.opt.tension)).setStroke(_22).getStroke();}else{run.dyn.shadow=s.createPolyline(_23).setStroke(_22).getStroke();}}if(this.opt.markers&&_14.marker.shadow){_22=_14.marker.shadow;_21=_1.map(_23,function(c){return this.createPath(run,s,"M"+c.x+" "+c.y+" "+_14.symbol).setStroke(_22).setFill(_22.color);},this);}}if(this.opt.lines&&_18.length>1){if(_11){if(this.opt.tension){run.dyn.outline=s.createPath(_1b).setStroke(_11).getStroke();}else{run.dyn.outline=s.createPolyline(_18).setStroke(_11).getStroke();}}if(this.opt.tension){run.dyn.stroke=s.createPath(_1b).setStroke(_10).getStroke();}else{run.dyn.stroke=s.createPolyline(_18).setStroke(_10).getStroke();}}if(this.opt.markers){_1f=new Array(_18.length);_20=new Array(_18.length);_11=null;if(_14.marker.outline){_11=dc.makeStroke(_14.marker.outline);_11.width=2*_11.width+(_14.marker.stroke?_14.marker.stroke.width:0);}_1.forEach(_18,function(c,i){var _24="M"+c.x+" "+c.y+" "+_14.symbol;if(_11){_20[i]=this.createPath(run,s,_24).setStroke(_11);}_1f[i]=this.createPath(run,s,_24).setStroke(_14.marker.stroke).setFill(_14.marker.fill);},this);run.dyn.markerFill=_14.marker.fill;run.dyn.markerStroke=_14.marker.stroke;if(_13){_1.forEach(_1f,function(s,i){var o={element:"marker",index:i+_16[seg],run:run,shape:s,outline:_20[i]||null,shadow:_21&&_21[i]||null,cx:_18[i].x,cy:_18[i].y};if(typeof _15[seg][0]=="number"){o.x=i+_16[seg]+1;o.y=_15[seg][i];}else{o.x=_15[seg][i].x;o.y=_15[seg][i].y;}this._connectEvents(o);_19[i+_16[seg]]=o;},this);}else{delete this._eventSeries[run.name];}}}run.dirty=false;}if(this.animate){var _25=this.group;fx.animateTransform(_1.delegate({shape:_25,duration:_6,transform:[{name:"translate",start:[0,_d.height-_e.b],end:[0,0]},{name:"scale",start:[1,0],end:[1,1]},{name:"original"}]},this.animate)).play();}this.dirty=false;return this;}});});