/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/lang","dojo/_base/declare","./PlotAction","dijit/Tooltip","dojox/gfx/matrix","dojox/lang/functional","dojox/lang/functional/scan","dojox/lang/functional/fold"],function(_1,_2,_3,_4,m,df){var _5=function(o){var t=o.run&&o.run.data&&o.run.data[o.index];if(t&&typeof t!="number"&&(t.tooltip||t.text)){return t.tooltip||t.text;}if(o.element=="candlestick"){return "<table cellpadding=\"1\" cellspacing=\"0\" border=\"0\" style=\"font-size:0.9em;\">"+"<tr><td>Open:</td><td align=\"right\"><strong>"+o.data.open+"</strong></td></tr>"+"<tr><td>High:</td><td align=\"right\"><strong>"+o.data.high+"</strong></td></tr>"+"<tr><td>Low:</td><td align=\"right\"><strong>"+o.data.low+"</strong></td></tr>"+"<tr><td>Close:</td><td align=\"right\"><strong>"+o.data.close+"</strong></td></tr>"+(o.data.mid!==undefined?"<tr><td>Mid:</td><td align=\"right\"><strong>"+o.data.mid+"</strong></td></tr>":"")+"</table>";}return o.element=="bar"?o.x:o.y;};var _6=Math.PI/4,_7=Math.PI/2;return _1.declare("dojox.charting.action2d.Tooltip",dojox.charting.action2d.PlotAction,{defaultParams:{text:_5},optionalParams:{},constructor:function(_8,_9,_a){this.text=_a&&_a.text?_a.text:_5;this.connect();},process:function(o){if(o.type==="onplotreset"||o.type==="onmouseout"){dijit.hideTooltip(this.aroundRect);this.aroundRect=null;if(o.type==="onplotreset"){delete this.angles;}return;}if(!o.shape||o.type!=="onmouseover"){return;}var _b={type:"rect"},_c=["after","before"];switch(o.element){case "marker":_b.x=o.cx;_b.y=o.cy;_b.width=_b.height=1;break;case "circle":_b.x=o.cx-o.cr;_b.y=o.cy-o.cr;_b.width=_b.height=2*o.cr;break;case "column":_c=["above","below"];case "bar":_b=_1.clone(o.shape.getShape());break;case "candlestick":_b.x=o.x;_b.y=o.y;_b.width=o.width;_b.height=o.height;break;default:if(!this.angles){if(typeof o.run.data[0]=="number"){this.angles=df.map(df.scanl(o.run.data,"+",0),"* 2 * Math.PI / this",df.foldl(o.run.data,"+",0));}else{this.angles=df.map(df.scanl(o.run.data,"a + b.y",0),"* 2 * Math.PI / this",df.foldl(o.run.data,"a + b.y",0));}}var _d=m._degToRad(o.plot.opt.startAngle),_e=(this.angles[o.index]+this.angles[o.index+1])/2+_d;_b.x=o.cx+o.cr*Math.cos(_e);_b.y=o.cy+o.cr*Math.sin(_e);_b.width=_b.height=1;if(_e<_6){}else{if(_e<_7+_6){_c=["below","above"];}else{if(_e<Math.PI+_6){_c=["before","after"];}else{if(_e<2*Math.PI-_6){_c=["above","below"];}}}}break;}var lt=this.chart.getCoords();_b.x+=lt.x;_b.y+=lt.y;_b.x=Math.round(_b.x);_b.y=Math.round(_b.y);_b.width=Math.ceil(_b.width);_b.height=Math.ceil(_b.height);this.aroundRect=_b;var _f=this.text(o);if(this.chart.getTextDir){var _10=(_1.style(this.chart.node,"direction")=="rtl");var _11=(this.chart.getTextDir(_f)=="rtl");}if(_f){if(_11&&!_10){dijit.showTooltip("<span dir = 'rtl'>"+_f+"</span>",this.aroundRect,_c);}else{if(!_11&&_10){dijit.showTooltip("<span dir = 'ltr'>"+_f+"</span>",this.aroundRect,_c);}else{dijit.showTooltip(_f,this.aroundRect,_c);}}}}});});