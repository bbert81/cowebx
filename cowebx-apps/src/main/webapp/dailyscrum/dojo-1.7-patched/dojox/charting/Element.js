/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/array","dojo/_base/declare","dojox/gfx"],function(_1,_2,_3){return _1.declare("dojox.charting.Element",null,{chart:null,group:null,htmlElements:null,dirty:true,constructor:function(_4){this.chart=_4;this.group=null;this.htmlElements=[];this.dirty=true;this.trailingSymbol="...";this._events=[];},createGroup:function(_5){if(!_5){_5=this.chart.surface;}if(!this.group){this.group=_5.createGroup();}return this;},purgeGroup:function(){this.destroyHtmlElements();if(this.group){this.group.clear();this.group.removeShape();this.group=null;}this.dirty=true;if(this._events.length){_1.forEach(this._events,function(_6){_6.shape.disconnect(_6.handle);});this._events=[];}return this;},cleanGroup:function(_7){this.destroyHtmlElements();if(!_7){_7=this.chart.surface;}if(this.group){this.group.clear();}else{this.group=_7.createGroup();}this.dirty=true;return this;},destroyHtmlElements:function(){if(this.htmlElements.length){_1.forEach(this.htmlElements,_1.destroy);this.htmlElements=[];}},destroy:function(){this.purgeGroup();},getTextWidth:function(s,_8){return _3._base._getTextBox(s,{font:_8}).w||0;},getTextWithLimitLength:function(s,_9,_a,_b){if(!s||s.length<=0){return {text:"",truncated:_b||false};}if(!_a||_a<=0){return {text:s,truncated:_b||false};}var _c=2,_d=0.618,_e=s.substring(0,1)+this.trailingSymbol,_f=this.getTextWidth(_e,_9);if(_a<=_f){return {text:_e,truncated:true};}var _10=this.getTextWidth(s,_9);if(_10<=_a){return {text:s,truncated:_b||false};}else{var _11=0,end=s.length;while(_11<end){if(end-_11<=_c){while(this.getTextWidth(s.substring(0,_11)+this.trailingSymbol,_9)>_a){_11-=1;}return {text:(s.substring(0,_11)+this.trailingSymbol),truncated:true};}var _12=_11+Math.round((end-_11)*_d),_13=this.getTextWidth(s.substring(0,_12),_9);if(_13<_a){_11=_12;end=end;}else{_11=_11;end=_12;}}}},getTextWithLimitCharCount:function(s,_14,_15,_16){if(!s||s.length<=0){return {text:"",truncated:_16||false};}if(!_15||_15<=0||s.length<=_15){return {text:s,truncated:_16||false};}return {text:s.substring(0,_15)+this.trailingSymbol,truncated:true};},_plotFill:function(_17,dim,_18){if(!_17||!_17.type||!_17.space){return _17;}var _19=_17.space;switch(_17.type){case "linear":if(_19==="plot"||_19==="shapeX"||_19==="shapeY"){_17=_3.makeParameters(_3.defaultLinearGradient,_17);_17.space=_19;if(_19==="plot"||_19==="shapeX"){var _1a=dim.height-_18.t-_18.b;_17.y1=_18.t+_1a*_17.y1/100;_17.y2=_18.t+_1a*_17.y2/100;}if(_19==="plot"||_19==="shapeY"){var _1a=dim.width-_18.l-_18.r;_17.x1=_18.l+_1a*_17.x1/100;_17.x2=_18.l+_1a*_17.x2/100;}}break;case "radial":if(_19==="plot"){_17=_3.makeParameters(_3.defaultRadialGradient,_17);_17.space=_19;var _1b=dim.width-_18.l-_18.r,_1c=dim.height-_18.t-_18.b;_17.cx=_18.l+_1b*_17.cx/100;_17.cy=_18.t+_1c*_17.cy/100;_17.r=_17.r*Math.sqrt(_1b*_1b+_1c*_1c)/200;}break;case "pattern":if(_19==="plot"||_19==="shapeX"||_19==="shapeY"){_17=_3.makeParameters(_3.defaultPattern,_17);_17.space=_19;if(_19==="plot"||_19==="shapeX"){var _1a=dim.height-_18.t-_18.b;_17.y=_18.t+_1a*_17.y/100;_17.height=_1a*_17.height/100;}if(_19==="plot"||_19==="shapeY"){var _1a=dim.width-_18.l-_18.r;_17.x=_18.l+_1a*_17.x/100;_17.width=_1a*_17.width/100;}}break;}return _17;},_shapeFill:function(_1d,_1e){if(!_1d||!_1d.space){return _1d;}var _1f=_1d.space;switch(_1d.type){case "linear":if(_1f==="shape"||_1f==="shapeX"||_1f==="shapeY"){_1d=_3.makeParameters(_3.defaultLinearGradient,_1d);_1d.space=_1f;if(_1f==="shape"||_1f==="shapeX"){var _20=_1e.width;_1d.x1=_1e.x+_20*_1d.x1/100;_1d.x2=_1e.x+_20*_1d.x2/100;}if(_1f==="shape"||_1f==="shapeY"){var _20=_1e.height;_1d.y1=_1e.y+_20*_1d.y1/100;_1d.y2=_1e.y+_20*_1d.y2/100;}}break;case "radial":if(_1f==="shape"){_1d=_3.makeParameters(_3.defaultRadialGradient,_1d);_1d.space=_1f;_1d.cx=_1e.x+_1e.width/2;_1d.cy=_1e.y+_1e.height/2;_1d.r=_1d.r*_1e.width/200;}break;case "pattern":if(_1f==="shape"||_1f==="shapeX"||_1f==="shapeY"){_1d=_3.makeParameters(_3.defaultPattern,_1d);_1d.space=_1f;if(_1f==="shape"||_1f==="shapeX"){var _20=_1e.width;_1d.x=_1e.x+_20*_1d.x/100;_1d.width=_20*_1d.width/100;}if(_1f==="shape"||_1f==="shapeY"){var _20=_1e.height;_1d.y=_1e.y+_20*_1d.y/100;_1d.height=_20*_1d.height/100;}}break;}return _1d;},_pseudoRadialFill:function(_21,_22,_23,_24,end){if(!_21||_21.type!=="radial"||_21.space!=="shape"){return _21;}var _25=_21.space;_21=_3.makeParameters(_3.defaultRadialGradient,_21);_21.space=_25;if(arguments.length<4){_21.cx=_22.x;_21.cy=_22.y;_21.r=_21.r*_23/100;return _21;}var _26=arguments.length<5?_24:(end+_24)/2;return {type:"linear",x1:_22.x,y1:_22.y,x2:_22.x+_21.r*_23*Math.cos(_26)/100,y2:_22.y+_21.r*_23*Math.sin(_26)/100,colors:_21.colors};return _21;}});});