/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/lang","dojo/_base/declare","./Base","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx","dojox/gfx/gradutils"],function(_1,_2,_3,dc,df,_4,du,fx,_5){var _6=df.lambda("item.purgeGroup()");return _1.declare("dojox.charting.plot2d.Scatter",dojox.charting.plot2d.Base,{defaultParams:{hAxis:"x",vAxis:"y",shadows:null,animate:null},optionalParams:{markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerFont:"",markerFontColor:""},constructor:function(_7,_8){this.opt=_1.clone(this.defaultParams);du.updateWithObject(this.opt,_8);du.updateWithPattern(this.opt,_8,this.optionalParams);this.series=[];this.hAxis=this.opt.hAxis;this.vAxis=this.opt.vAxis;this.animate=this.opt.animate;},render:function(_9,_a){if(this.zoom&&!this.isDataDirty()){return this.performZoom(_9,_a);}this.resetEvents();this.dirty=this.isDirty();if(this.dirty){_1.forEach(this.series,_6);this._eventSeries={};this.cleanGroup();var s=this.group;df.forEachRev(this.series,function(_b){_b.cleanGroup(s);});}var t=this.chart.theme,_c=this.events();for(var i=this.series.length-1;i>=0;--i){var _d=this.series[i];if(!this.dirty&&!_d.dirty){t.skip();this._reconnectEvents(_d.name);continue;}_d.cleanGroup();if(!_d.data.length){_d.dirty=false;t.skip();continue;}var _e=t.next("marker",[this.opt,_d]),s=_d.group,_f,ht=this._hScaler.scaler.getTransformerFromModel(this._hScaler),vt=this._vScaler.scaler.getTransformerFromModel(this._vScaler);if(typeof _d.data[0]=="number"){_f=_1.map(_d.data,function(v,i){return {x:ht(i+1)+_a.l,y:_9.height-_a.b-vt(v)};},this);}else{_f=_1.map(_d.data,function(v,i){return {x:ht(v.x)+_a.l,y:_9.height-_a.b-vt(v.y)};},this);}var _10=new Array(_f.length),_11=new Array(_f.length),_12=new Array(_f.length);_1.forEach(_f,function(c,i){var _13=typeof _d.data[i]=="number"?t.post(_e,"marker"):t.addMixin(_e,"marker",_d.data[i],true),_14="M"+c.x+" "+c.y+" "+_13.symbol;if(_13.marker.shadow){_10[i]=s.createPath("M"+(c.x+_13.marker.shadow.dx)+" "+(c.y+_13.marker.shadow.dy)+" "+_13.symbol).setStroke(_13.marker.shadow).setFill(_13.marker.shadow.color);if(this.animate){this._animateScatter(_10[i],_9.height-_a.b);}}if(_13.marker.outline){var _15=dc.makeStroke(_13.marker.outline);_15.width=2*_15.width+_13.marker.stroke.width;_12[i]=s.createPath(_14).setStroke(_15);if(this.animate){this._animateScatter(_12[i],_9.height-_a.b);}}var _16=dc.makeStroke(_13.marker.stroke),_17=this._plotFill(_13.marker.fill,_9,_a);if(_17&&(_17.type==="linear"||_17.type=="radial")){var _18=_5.getColor(_17,{x:c.x,y:c.y});if(_16){_16.color=_18;}_11[i]=s.createPath(_14).setStroke(_16).setFill(_18);}else{_11[i]=s.createPath(_14).setStroke(_16).setFill(_17);}if(this.animate){this._animateScatter(_11[i],_9.height-_a.b);}},this);if(_11.length){_d.dyn.stroke=_11[_11.length-1].getStroke();_d.dyn.fill=_11[_11.length-1].getFill();}if(_c){var _19=new Array(_11.length);_1.forEach(_11,function(s,i){var o={element:"marker",index:i,run:_d,shape:s,outline:_12&&_12[i]||null,shadow:_10&&_10[i]||null,cx:_f[i].x,cy:_f[i].y};if(typeof _d.data[0]=="number"){o.x=i+1;o.y=_d.data[i];}else{o.x=_d.data[i].x;o.y=_d.data[i].y;}this._connectEvents(o);_19[i]=o;},this);this._eventSeries[_d.name]=_19;}else{delete this._eventSeries[_d.name];}_d.dirty=false;}this.dirty=false;return this;},_animateScatter:function(_1a,_1b){fx.animateTransform(_1.delegate({shape:_1a,duration:1200,transform:[{name:"translate",start:[0,_1b],end:[0,0]},{name:"scale",start:[0,0],end:[1,1]},{name:"original"}]},this.animate)).play();}});});