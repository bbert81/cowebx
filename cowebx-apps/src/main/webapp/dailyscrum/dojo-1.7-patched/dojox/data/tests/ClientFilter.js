/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/data/ClientFilter","dojox/data/JsonRestStore"],function(_1,_2,_3){_1.getObject("dojox.data.tests.ClientFilter",1);mockService=function(_4){var _5=new _1.Deferred();setTimeout(function(){_5.callback([{firstName:"John",lastName:"Smith",__id:"mock/1"},{firstName:"Jim",lastName:"Smith",__id:"mock/2"},{firstName:"Jill",lastName:"Smith",__id:"mock/3"},{firstName:"Jerry",lastName:"Smith",__id:"mock/4"}]);},10);return _5;};mockService.servicePath="mock/";jsonStore=new _3.data.JsonRestStore({service:mockService});doh.register("dojox.data.tests.ClientFilter",[function updateWhileLoading(t){var d=new doh.Deferred();jsonStore.fetch({query:{lastName:"Smith",firstName:"*"},sort:[{attribute:"firstName",descending:true}],onComplete:function(_6,_7){t.is(5,_6.length);t.is(newJack,_6[4]);d.callback(true);}});newJack=jsonStore.newItem({firstName:"Jack",lastName:"Smith"});return d;},function makeChanges(t){var d=new doh.Deferred();jsonStore.fetch({queryOptions:{cache:true},query:{lastName:"Smith",firstName:"*"},sort:[{attribute:"firstName",descending:true}],onComplete:function(_8,_9){t.is(5,_8.length);t.is(newJack,_8[4]);var _a=jsonStore.newItem({firstName:"Joe",lastName:"Smith"});t.is(5,_8.length);jsonStore.updateResultSet(_8,_9);t.is(6,_8.length);t.is(_a,_8[1]);var _b=jsonStore.newItem({firstName:"Jack",lastName:"Jones"});jsonStore.updateResultSet(_8,_9);t.is(6,_8.length);jsonStore.setValue(_a,"firstName","Jesse");jsonStore.updateResultSet(_8,_9);t.is(6,_8.length);t.is(_a,_8[3]);t.f(_a==_8[1]);jsonStore.deleteItem(newJack);jsonStore.updateResultSet(_8,_9);t.is(5,_8.length);jsonStore.setValue(_a,"lastName","Baker");jsonStore.updateResultSet(_8,_9);t.is(4,_8.length);jsonStore.setValue(_b,"lastName","Smith");jsonStore.updateResultSet(_8,_9);t.is(5,_8.length);}});var _c;jsonStore.fetch({query:{lastName:"Smith",firstName:"Jack"},sort:[{attribute:"firstName",descending:true}],onComplete:function(_d,_e){_c=true;t.is(1,_d.length);d.callback(true);}});t.f(_c);return d;},function cachedResults(t){var d=new doh.Deferred();var _f;jsonStore.fetch({query:{lastName:"Smith",firstName:"Jack"},sort:[{attribute:"firstName",descending:true}],onComplete:function(_10,_11){_f=true;t.is(1,_10.length);d.callback(true);}});t.t(_f);return d;},function repeatedQueries(t){var d=new doh.Deferred();var _12;jsonStore.fetch({queryOptions:{cache:true},query:{},onComplete:function(_13,_14){t.is(6,_13.length);jsonStore.newItem({firstName:"Jack",lastName:"Jones"});jsonStore.fetch({query:{},onComplete:function(_15,_16){t.is(7,_15.length);}});jsonStore.serverVersion=jsonStore._updates.length;jsonStore.newItem({firstName:"Jack",lastName:"Jones"});jsonStore.fetch({query:{},onComplete:function(_17,_18){_12=true;t.is(8,_17.length);d.callback(true);}});}});return d;},function sorting(t){var d=new doh.Deferred();var _19;jsonStore.fetch({query:{lastName:"Smith",firstName:"*"},sort:[{attribute:"firstName",descending:true}],onComplete:function(_1a,_1b){var _1c=jsonStore.getValue(_1a[0],"firstName");t.is("John",_1c);jsonStore.fetch({query:{lastName:"Smith",firstName:"*"},sort:[{attribute:"firstName"}],onComplete:function(_1d,_1e){var _1f=jsonStore.getValue(_1d[0],"firstName");_19=true;t.is("Jack",_1f);d.callback(true);}});}});t.t(_19);return d;}]);});require(["dojox/data/tests/ClientFilter"]);