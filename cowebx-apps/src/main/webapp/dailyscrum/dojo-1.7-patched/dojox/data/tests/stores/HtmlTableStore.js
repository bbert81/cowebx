/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/data/HtmlTableStore","dojo/data/api/Read","dojo/data/api/Identity"],function(_1,_2,_3){_1.getObject("dojox.data.tests.stores.HtmlTableStore",1);_3.data.tests.stores.HtmlTableStore.getBooks2Store=function(){return new _3.data.HtmlTableStore({url:_1.moduleUrl("dojox.data.tests","stores/books2.html").toString(),tableId:"books2"});};_3.data.tests.stores.HtmlTableStore.getBooksStore=function(){return new _3.data.HtmlTableStore({url:_1.moduleUrl("dojox.data.tests","stores/books.html").toString(),tableId:"books"});};doh.register("dojox.data.tests.stores.HtmlTableStore",[function testReadAPI_fetch_all(t){var _4=_3.data.tests.stores.HtmlTableStore.getBooksStore();var d=new doh.Deferred();function _5(_6,_7){t.assertEqual(20,_6.length);d.callback(true);};function _8(_9,_a){d.errback(_9);};_4.fetch({query:{isbn:"*"},onComplete:_5,onError:_8});return d;},function testReadAPI_fetch_one(t){var _b=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _c(_d,_e){t.assertEqual(1,_d.length);d.callback(true);};function _f(_10,_11){d.errback(_10);};_b.fetch({query:{isbn:"A9B574"},onComplete:_c,onError:_f});return d;},function testReadAPI_fetch_paging(t){var _12=_3.data.tests.stores.HtmlTableStore.getBooksStore();var d=new doh.Deferred();function _13(_14,_15){t.assertEqual(5,_14.length);_15.start=3;_15.count=1;_15.onComplete=_16;_12.fetch(_15);};function _16(_17,_18){t.assertEqual(1,_17.length);_18.start=0;_18.count=5;_18.onComplete=_19;_12.fetch(_18);};function _19(_1a,_1b){t.assertEqual(5,_1a.length);_1b.start=2;_1b.count=20;_1b.onComplete=_1c;_12.fetch(_1b);};function _1c(_1d,_1e){t.assertEqual(18,_1d.length);_1e.start=9;_1e.count=100;_1e.onComplete=_1f;_12.fetch(_1e);};function _1f(_20,_21){t.assertEqual(11,_20.length);_21.start=2;_21.count=20;_21.onComplete=_22;_12.fetch(_21);};function _22(_23,_24){t.assertEqual(18,_23.length);d.callback(true);};function _25(_26,_27){t.assertEqual(20,_26.length);_27.start=1;_27.count=5;_27.onComplete=_13;_12.fetch(_27);};function _28(_29,_2a){d.errback(_29);};_12.fetch({onComplete:_25,onError:_28});return d;},function testReadAPI_fetch_pattern0(t){var _2b=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _2c(_2d,_2e){t.assertEqual(1,_2d.length);d.callback(true);};function _2f(_30,_31){d.errback(_30);};_2b.fetch({query:{isbn:"?9B574"},onComplete:_2c,onError:_2f});return d;},function testReadAPI_fetch_pattern1(t){var _32=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _33(_34,_35){t.assertEqual(4,_34.length);d.callback(true);};function _36(_37,_38){d.errback(_37);};_32.fetch({query:{isbn:"A9B57?"},onComplete:_33,onError:_36});return d;},function testReadAPI_fetch_pattern2(t){var _39=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _3a(_3b,_3c){t.assertEqual(5,_3b.length);d.callback(true);};function _3d(_3e,_3f){d.errback(_3e);};_39.fetch({query:{isbn:"A9*"},onComplete:_3a,onError:_3d});return d;},function testReadAPI_fetch_pattern_caseInsensitive(t){var _40=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _41(_42,_43){t.assertEqual(1,_42.length);d.callback(true);};function _44(_45,_46){d.errback(_45);};_40.fetch({query:{isbn:"?9b574"},queryOptions:{ignoreCase:true},onComplete:_41,onError:_44});return d;},function testReadAPI_fetch_pattern_caseSensitive(t){var _47=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _48(_49,_4a){t.assertEqual(1,_49.length);d.callback(true);};function _4b(_4c,_4d){d.errback(_4c);};_47.fetch({query:{isbn:"?9B574"},queryOptions:{ignoreCase:false},onComplete:_48,onError:_4b});return d;},function testReadAPI_getLabel(t){var _4e=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _4f(_50,_51){t.assertEqual(_50.length,1);var _52=_4e.getLabel(_50[0]);t.assertTrue(_52!==null);t.assertEqual("Table Row #3",_52);d.callback(true);};function _53(_54,_55){d.errback(_54);};_4e.fetch({query:{isbn:"A9B574"},onComplete:_4f,onError:_53});return d;},function testReadAPI_getLabelAttributes(t){var _56=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _57(_58,_59){t.assertEqual(_58.length,1);var _5a=_56.getLabelAttributes(_58[0]);t.assertTrue(_5a===null);d.callback(true);};function _5b(_5c,_5d){d.errback(_5c);};_56.fetch({query:{isbn:"A9B574"},onComplete:_57,onError:_5b});return d;},function testReadAPI_getValue(t){var _5e=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _5f(_60,_61){t.assertEqual(1,_60.length);var _62=_60[0];t.assertTrue(_5e.hasAttribute(_62,"isbn"));t.assertEqual(_5e.getValue(_62,"isbn"),"A9B574");d.callback(true);};function _63(_64,_65){d.errback(_64);};_5e.fetch({query:{isbn:"A9B574"},onComplete:_5f,onError:_63});return d;},function testReadAPI_getValues(t){var _66=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _67(_68,_69){t.assertEqual(1,_68.length);var _6a=_68[0];t.assertTrue(_66.hasAttribute(_6a,"isbn"));var _6b=_66.getValues(_6a,"isbn");t.assertEqual(1,_6b.length);t.assertEqual("A9B574",_6b[0]);d.callback(true);};function _6c(_6d,_6e){d.errback(_6d);};_66.fetch({query:{isbn:"A9B574"},onComplete:_67,onError:_6c});return d;},function testReadAPI_isItem(t){var _6f=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _70(_71,_72){t.assertEqual(1,_71.length);var _73=_71[0];t.assertTrue(_6f.isItem(_73));t.assertTrue(!_6f.isItem({}));t.assertTrue(!_6f.isItem("Foo"));t.assertTrue(!_6f.isItem(1));d.callback(true);};function _74(_75,_76){d.errback(_75);};_6f.fetch({query:{isbn:"A9B574"},onComplete:_70,onError:_74});return d;},function testReadAPI_isItem_multistore(t){var _77=_3.data.tests.stores.HtmlTableStore.getBooksStore();var _78=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _79(_7a,_7b){t.assertEqual(1,_7a.length);var _7c=_7a[0];t.assertTrue(_77.isItem(_7c));function _7d(_7e,_7f){t.assertEqual(1,_7e.length);var _80=_7e[0];t.assertTrue(_78.isItem(_80));t.assertTrue(!_77.isItem(_80));t.assertTrue(!_78.isItem(_7c));d.callback(true);};_78.fetch({query:{isbn:"A9B574"},onComplete:_7d,onError:_81});};function _81(_82,_83){d.errback(_82);};_77.fetch({query:{isbn:"1"},onComplete:_79,onError:_81});return d;},function testReadAPI_hasAttribute(t){var _84=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _85(_86,_87){t.assertEqual(1,_86.length);var _88=_86[0];t.assertTrue(_84.hasAttribute(_88,"isbn"));t.assertTrue(!_84.hasAttribute(_88,"bob"));d.callback(true);};function _89(_8a,_8b){d.errback(_8a);};_84.fetch({query:{isbn:"A9B574"},onComplete:_85,onError:_89});return d;},function testReadAPI_containsValue(t){var _8c=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _8d(_8e,_8f){t.assertEqual(1,_8e.length);var _90=_8e[0];t.assertTrue(_8c.containsValue(_90,"isbn","A9B574"));t.assertTrue(!_8c.containsValue(_90,"isbn","bob"));d.callback(true);};function _91(_92,_93){d.errback(_92);};_8c.fetch({query:{isbn:"A9B574"},onComplete:_8d,onError:_91});return d;},function testReadAPI_sortDescending(t){var _94=_3.data.tests.stores.HtmlTableStore.getBooksStore();var _95=[9,8,7,6,5,4,3,20,2,19,18,17,16,15,14,13,12,11,10,1];var d=new doh.Deferred();function _96(_97,_98){t.assertEqual(20,_97.length);for(var i=0;i<_97.length;i++){t.assertEqual(_95[i],_94.getValue(_97[i],"isbn").toString());}d.callback(true);};function _99(_9a,_9b){d.errback(_9a);};var _9c=[{attribute:"isbn",descending:true}];_94.fetch({query:{isbn:"*"},sort:_9c,onComplete:_96,onError:_99});return d;},function testReadAPI_sortAscending(t){var _9d=_3.data.tests.stores.HtmlTableStore.getBooksStore();var _9e=[1,10,11,12,13,14,15,16,17,18,19,2,20,3,4,5,6,7,8,9];var d=new doh.Deferred();function _9f(_a0,_a1){t.assertEqual(20,_a0.length);var _a2=1;for(var i=0;i<_a0.length;i++){t.assertEqual(_9e[i],_9d.getValue(_a0[i],"isbn").toString());}d.callback(true);};function _a3(_a4,_a5){d.errback(_a4);};var _a6=[{attribute:"isbn"}];_9d.fetch({query:{isbn:"*"},sort:_a6,onComplete:_9f,onError:_a3});return d;},function testReadAPI_sortDescendingNumeric(t){var _a7=_3.data.tests.stores.HtmlTableStore.getBooksStore();_a7.comparatorMap={};_a7.comparatorMap["isbn"]=function(a,b){var ret=0;if(parseInt(a.toString())>parseInt(b.toString())){ret=1;}else{if(parseInt(a.toString())<parseInt(b.toString())){ret=-1;}}return ret;};var d=new doh.Deferred();function _a8(_a9,_aa){t.assertEqual(20,_a9.length);var _ab=20;for(var i=0;i<_a9.length;i++){t.assertEqual(_ab,_a7.getValue(_a9[i],"isbn").toString());_ab--;}d.callback(true);};function _ac(_ad,_ae){d.errback(_ad);};var _af=[{attribute:"isbn",descending:true}];_a7.fetch({query:{isbn:"*"},sort:_af,onComplete:_a8,onError:_ac});return d;},function testReadAPI_sortAscendingNumeric(t){var _b0=_3.data.tests.stores.HtmlTableStore.getBooksStore();_b0.comparatorMap={};_b0.comparatorMap["isbn"]=function(a,b){var ret=0;if(parseInt(a.toString())>parseInt(b.toString())){ret=1;}else{if(parseInt(a.toString())<parseInt(b.toString())){ret=-1;}}return ret;};var d=new doh.Deferred();function _b1(_b2,_b3){t.assertEqual(20,_b2.length);var _b4=1;for(var i=0;i<_b2.length;i++){t.assertEqual(_b4,_b0.getValue(_b2[i],"isbn").toString());_b4++;}d.callback(true);};function _b5(_b6,_b7){d.errback(_b6);};var _b8=[{attribute:"isbn"}];_b0.fetch({query:{isbn:"*"},sort:_b8,onComplete:_b1,onError:_b5});return d;},function testReadAPI_isItemLoaded(t){var _b9=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _ba(_bb,_bc){t.assertEqual(1,_bb.length);var _bd=_bb[0];t.assertTrue(_b9.isItemLoaded(_bd));d.callback(true);};function _be(_bf,_c0){d.errback(_bf);};_b9.fetch({query:{isbn:"A9B574"},onComplete:_ba,onError:_be});return d;},function testReadAPI_getFeatures(t){var _c1=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var _c2=_c1.getFeatures();var _c3=0;for(i in _c2){t.assertTrue((i==="dojo.data.api.Read"||i==="dojo.data.api.Identity"));_c3++;}t.assertEqual(2,_c3);},function testReadAPI_getAttributes(t){var _c4=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _c5(_c6,_c7){t.assertEqual(1,_c6.length);var _c8=_c6[0];var _c9=_c4.getAttributes(_c8);t.assertEqual(3,_c9.length);for(var i=0;i<_c9.length;i++){t.assertTrue((_c9[i]==="isbn"||_c9[i]==="title"||_c9[i]==="author"));}d.callback(true);};function _ca(_cb,_cc){d.errback(_cb);};_c4.fetch({query:{isbn:"A9B574"},onComplete:_c5,onError:_ca});return d;},function testReadAPI_functionConformance(t){var _cd=_3.data.tests.stores.HtmlTableStore.getBooksStore();var _ce=new _1.data.api.Read();var _cf=true;for(i in _ce){var _d0=_ce[i];if(typeof _d0==="function"){var _d1=_cd[i];if(!(typeof _d1==="function")){_cf=false;break;}}}t.assertTrue(_cf);},function testIdentityAPI_getIdentity(t){var _d2=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _d3(_d4,_d5){t.assertEqual(1,_d4.length);var _d6=_d4[0];t.assertEqual(3,_d2.getIdentity(_d6));d.callback(true);};function _d7(_d8,_d9){d.errback(_d8);};_d2.fetch({query:{isbn:"A9B574"},onComplete:_d3,onError:_d7});return d;},function testIdentityAPI_getIdentityAttributes(t){var _da=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _db(_dc,_dd){t.assertEqual(1,_dc.length);var _de=_dc[0];var _df=_da.getIdentityAttributes(_de);t.assertEqual(null,_df);d.callback(true);};function _e0(_e1,_e2){d.errback(_e1);};_da.fetch({query:{isbn:"A9B574"},onComplete:_db,onError:_e0});return d;},function testIdentityAPI_fetchItemByIdentity(t){var _e3=_3.data.tests.stores.HtmlTableStore.getBooks2Store();var d=new doh.Deferred();function _e4(_e5,_e6){t.assertTrue(_e5!==null);t.assertTrue(_e3.isItem(_e5));t.assertEqual("A9B574",_e3.getValue(_e5,"isbn"));d.callback(true);};function _e7(_e8,_e9){d.errback(_e8);};_e3.fetchItemByIdentity({identity:3,onItem:_e4,onError:_e7});return d;},function testIdentityAPI_functionConformance(t){var _ea=_3.data.tests.stores.HtmlTableStore.getBooksStore();var _eb=new _1.data.api.Identity();var _ec=true;for(i in _eb){var _ed=_eb[i];if(typeof _ed==="function"){var _ee=_ea[i];if(!(typeof _ee==="function")){_ec=false;break;}}}t.assertTrue(_ec);}]);});require(["dojox/data/tests/stores/HtmlTableStore"]);