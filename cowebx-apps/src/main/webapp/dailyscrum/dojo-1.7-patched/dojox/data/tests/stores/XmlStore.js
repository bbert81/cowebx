/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/data/XmlStore","dojo/data/api/Read","dojo/data/api/Write","dojo/data/api/Identity"],function(_1,_2,_3){_1.getObject("dojox.data.tests.stores.XmlStore",1);_3.data.tests.stores.XmlStore.getBooks3Store=function(){return new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/books2.xml").toString(),label:"title",keyAttribute:"isbn"});};_3.data.tests.stores.XmlStore.getBooks2Store=function(){return new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/books2.xml").toString(),label:"title"});};_3.data.tests.stores.XmlStore.getBooks2StorePC=function(){return new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/books2.xml").toString(),label:"title",urlPreventCache:false});};_3.data.tests.stores.XmlStore.getBooksStore=function(){return new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/books.xml").toString(),label:"title"});};_3.data.tests.stores.XmlStore.getCDataTestStore=function(){return new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/cdata_test.xml").toString(),label:"title"});};_3.data.tests.stores.XmlStore.getGeographyStore=function(){return new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/geography2.xml").toString(),label:"text",keyAttribute:"text",attributeMap:{text:"@text"},rootItem:"geography"});};doh.register("dojox.data.tests.stores.XmlStore",[function testReadAPI_fetch_all(t){var _4=_3.data.tests.stores.XmlStore.getBooksStore();var d=new doh.Deferred();function _5(_6,_7){t.assertEqual(20,_6.length);d.callback(true);};function _8(_9,_a){d.errback(_9);};_4.fetch({query:{isbn:"*"},onComplete:_5,onError:_8});return d;},function testReadAPI_fetch_one(t){var _b=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _c(_d,_e){t.assertEqual(1,_d.length);d.callback(true);};function _f(_10,_11){d.errback(_10);};_b.fetch({query:{isbn:"A9B574"},onComplete:_c,onError:_f});return d;},{name:"testReadAPI_fetch_paging",timeout:10000,runTest:function(t){var _12=_3.data.tests.stores.XmlStore.getBooksStore();var d=new doh.Deferred();var _13=function(_14,_15){t.assertEqual(18,_14.length);d.callback(true);};var _16=function(_17,_18){t.assertEqual(11,_17.length);_18.start=2;_18.count=20;_18.onComplete=_13;_12.fetch(_18);};var _19=function(_1a,_1b){t.assertEqual(18,_1a.length);_1b.start=9;_1b.count=100;_1b.onComplete=_16;_12.fetch(_1b);};var _1c=function(_1d,_1e){t.assertEqual(5,_1d.length);_1e.start=2;_1e.count=20;_1e.onComplete=_19;_12.fetch(_1e);};var _1f=function(_20,_21){t.assertEqual(1,_20.length);_21.start=0;_21.count=5;_21.onComplete=_1c;_12.fetch(_21);};var _22=function(_23,_24){t.assertEqual(5,_23.length);_24.start=3;_24.count=1;_24.onComplete=_1f;_12.fetch(_24);};var _25=function(_26,_27){t.assertEqual(20,_26.length);_27.start=1;_27.count=5;_27.onComplete=_22;_12.fetch(_27);};function _28(_29,_2a){d.errback(_29);};_12.fetch({onComplete:_25,onError:_28});return d;}},function testReadAPI_fetch_pattern0(t){var _2b=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _2c(_2d,_2e){t.assertEqual(1,_2d.length);d.callback(true);};function _2f(_30,_31){d.errback(_30);};_2b.fetch({query:{isbn:"?9B574"},onComplete:_2c,onError:_2f});return d;},function testReadAPI_fetch_pattern1(t){var _32=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _33(_34,_35){t.assertEqual(4,_34.length);d.callback(true);};function _36(_37,_38){d.errback(_37);};_32.fetch({query:{isbn:"A9B57?"},onComplete:_33,onError:_36});return d;},function testReadAPI_fetch_pattern1_preventCacheOff(t){var _39=_3.data.tests.stores.XmlStore.getBooks2StorePC();var d=new doh.Deferred();function _3a(_3b,_3c){t.assertEqual(4,_3b.length);d.callback(true);};function _3d(_3e,_3f){d.errback(_3e);};_39.fetch({query:{isbn:"A9B57?"},onComplete:_3a,onError:_3d});return d;},function testReadAPI_fetch_pattern2(t){var _40=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _41(_42,_43){t.assertEqual(5,_42.length);d.callback(true);};function _44(_45,_46){d.errback(_45);};_40.fetch({query:{isbn:"A9*"},onComplete:_41,onError:_44});return d;},function testReadAPI_fetch_pattern_multi(t){var _47=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _48(_49,_4a){t.assertEqual(1,_49.length);d.callback(true);};function _4b(_4c,_4d){d.errback(_4c);};_47.fetch({query:{isbn:"A9B57?",title:"?itle of 3"},onComplete:_48,onError:_4b});return d;},function testReadAPI_fetch_pattern_multiValuedValue(t){var _4e=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _4f(_50,_51){t.assertEqual(1,_50.length);d.callback(true);};function _52(_53,_54){d.errback(_53);};_4e.fetch({query:{author:"Third Author of 5"},onComplete:_4f,onError:_52});return d;},function testReadAPI_fetch_pattern_caseInsensitive(t){var _55=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _56(_57,_58){t.assertEqual(1,_57.length);d.callback(true);};function _59(_5a,_5b){d.errback(_5a);};_55.fetch({query:{isbn:"?9b574"},queryOptions:{ignoreCase:true},onComplete:_56,onError:_59});return d;},function testReadAPI_fetch_pattern_caseSensitive(t){var _5c=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _5d(_5e,_5f){t.assertEqual(1,_5e.length);d.callback(true);};function _60(_61,_62){d.errback(_61);};_5c.fetch({query:{isbn:"?9B574"},queryOptions:{ignoreCase:false},onComplete:_5d,onError:_60});return d;},function testReadAPI_fetch_all_rootItem(t){var _63=new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/books3.xml").toString(),rootItem:"book"});var d=new doh.Deferred();function _64(_65,_66){t.assertEqual(5,_65.length);d.callback(true);};function _67(_68,_69){d.errback(_68);};_63.fetch({query:{isbn:"*"},onComplete:_64,onError:_67});return d;},function testReadAPI_fetch_withAttrMap_all(t){var _6a=new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/books_isbnAttr.xml").toString(),attributeMap:{"book.isbn":"@isbn"}});var d=new doh.Deferred();function _6b(_6c,_6d){t.assertEqual(5,_6c.length);d.callback(true);};function _6e(_6f,_70){d.errback(_6f);};_6a.fetch({query:{isbn:"*"},onComplete:_6b,onError:_6e});return d;},function testReadAPI_fetch_withAttrMap_one(t){var _71=new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/books_isbnAttr.xml").toString(),attributeMap:{"book.isbn":"@isbn"}});var d=new doh.Deferred();function _72(_73,_74){t.assertEqual(1,_73.length);d.callback(true);};function _75(_76,_77){d.errback(_76);};_71.fetch({query:{isbn:"2"},onComplete:_72,onError:_75});return d;},function testReadAPI_fetch_withAttrMap_pattern0(t){var _78=new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/books_isbnAttr2.xml").toString(),attributeMap:{"book.isbn":"@isbn"}});var d=new doh.Deferred();function _79(_7a,_7b){t.assertEqual(3,_7a.length);d.callback(true);};function _7c(_7d,_7e){d.errback(_7d);};_78.fetch({query:{isbn:"ABC?"},onComplete:_79,onError:_7c});return d;},function testReadAPI_fetch_withAttrMap_pattern1(t){var _7f=new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/books_isbnAttr2.xml").toString(),attributeMap:{"book.isbn":"@isbn"}});var d=new doh.Deferred();function _80(_81,_82){t.assertEqual(5,_81.length);d.callback(true);};function _83(_84,_85){d.errback(_84);};_7f.fetch({query:{isbn:"A*"},onComplete:_80,onError:_83});return d;},function testReadAPI_fetch_withAttrMap_pattern2(t){var _86=new _3.data.XmlStore({url:_1.moduleUrl("dojox.data.tests","stores/books_isbnAttr2.xml").toString(),attributeMap:{"book.isbn":"@isbn"}});var d=new doh.Deferred();function _87(_88,_89){t.assertEqual(2,_88.length);d.callback(true);};function _8a(_8b,_8c){d.errback(_8b);};_86.fetch({query:{isbn:"?C*"},onComplete:_87,onError:_8a});return d;},function testReadAPI_getLabel(t){var _8d=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _8e(_8f,_90){t.assertEqual(_8f.length,1);var _91=_8d.getLabel(_8f[0]);t.assertTrue(_91!==null);t.assertEqual("Title of 4",_91);d.callback(true);};function _92(_93,_94){d.errback(_93);};_8d.fetch({query:{isbn:"A9B574"},onComplete:_8e,onError:_92});return d;},function testReadAPI_getLabelAttributes(t){var _95=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _96(_97,_98){t.assertEqual(_97.length,1);var _99=_95.getLabelAttributes(_97[0]);t.assertTrue(_1.isArray(_99));t.assertEqual("title",_99[0]);d.callback(true);};function _9a(_9b,_9c){d.errback(_9b);};_95.fetch({query:{isbn:"A9B574"},onComplete:_96,onError:_9a});return d;},function testReadAPI_getValue(t){var _9d=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _9e(_9f,_a0){t.assertEqual(1,_9f.length);var _a1=_9f[0];t.assertTrue(_9d.hasAttribute(_a1,"isbn"));t.assertEqual(_9d.getValue(_a1,"isbn"),"A9B574");d.callback(true);};function _a2(_a3,_a4){d.errback(_a3);};_9d.fetch({query:{isbn:"A9B574"},onComplete:_9e,onError:_a2});return d;},function testReadAPI_getValue_cdata(t){var _a5=_3.data.tests.stores.XmlStore.getCDataTestStore();var d=new doh.Deferred();function _a6(_a7,_a8){t.assertEqual(1,_a7.length);var _a9=_a7[0];try{t.assertTrue(_a5.hasAttribute(_a9,"ids"));t.assertEqual(_a5.getValue(_a9,"ids"),"{68d3c190-4b83-11dd-c204-000000000001}17");var _aa=_a5.getValue(_a9,"title");t.assertTrue(_a5.isItem(_aa));var _ab=_a5.getValue(_aa,"text()");t.assertEqual("<b>First</b> 3",_1.trim(_ab));d.callback(true);}catch(e){d.errback(e);}};function _ac(_ad,_ae){d.errback(_ad);};_a5.fetch({query:{ids:"{68d3c190-4b83-11dd-c204-000000000001}17"},onComplete:_a6,onError:_ac});return d;},function testReadAPI_getValues_cdata(t){var _af=_3.data.tests.stores.XmlStore.getCDataTestStore();var d=new doh.Deferred();function _b0(_b1,_b2){t.assertEqual(1,_b1.length);var _b3=_b1[0];try{t.assertTrue(_af.hasAttribute(_b3,"ids"));t.assertEqual(_af.getValue(_b3,"ids"),"{68d3c190-4b83-11dd-c204-000000000001}17");var _b4=_af.getValue(_b3,"title");t.assertTrue(_af.isItem(_b4));var _b5=_af.getValues(_b4,"text()");t.assertEqual("<b>First</b> 3",_1.trim(_b5[0]));d.callback(true);}catch(e){d.errback(e);}};function _b6(_b7,_b8){d.errback(_b7);};_af.fetch({query:{ids:"{68d3c190-4b83-11dd-c204-000000000001}17"},onComplete:_b0,onError:_b6});return d;},function testReadAPI_getValue_cdata_toString(t){var _b9=_3.data.tests.stores.XmlStore.getCDataTestStore();var d=new doh.Deferred();function _ba(_bb,_bc){t.assertEqual(1,_bb.length);var _bd=_bb[0];try{t.assertTrue(_b9.hasAttribute(_bd,"ids"));t.assertEqual(_b9.getValue(_bd,"ids"),"{68d3c190-4b83-11dd-c204-000000000001}17");var _be=_b9.getValue(_bd,"title");t.assertTrue(_b9.isItem(_be));var _bf=_be.toString();t.assertEqual("<b>First</b> 3",_1.trim(_bf));d.callback(true);}catch(e){d.errback(e);}};function _c0(_c1,_c2){d.errback(_c1);};_b9.fetch({query:{ids:"{68d3c190-4b83-11dd-c204-000000000001}17"},onComplete:_ba,onError:_c0});return d;},function testReadAPI_getValues(t){var _c3=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _c4(_c5,_c6){t.assertEqual(1,_c5.length);var _c7=_c5[0];t.assertTrue(_c3.hasAttribute(_c7,"isbn"));var _c8=_c3.getValues(_c7,"isbn");t.assertEqual(1,_c8.length);t.assertEqual("A9B574",_c8[0]);d.callback(true);};function _c9(_ca,_cb){d.errback(_ca);};_c3.fetch({query:{isbn:"A9B574"},onComplete:_c4,onError:_c9});return d;},function testReadAPI_isItem(t){var _cc=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _cd(_ce,_cf){t.assertEqual(1,_ce.length);var _d0=_ce[0];t.assertTrue(_cc.isItem(_d0));t.assertTrue(!_cc.isItem({}));t.assertTrue(!_cc.isItem("Foo"));t.assertTrue(!_cc.isItem(1));d.callback(true);};function _d1(_d2,_d3){d.errback(_d2);};_cc.fetch({query:{isbn:"A9B574"},onComplete:_cd,onError:_d1});return d;},function testReadAPI_isItem_multistore(t){var _d4=_3.data.tests.stores.XmlStore.getBooks2Store();var _d5=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();var _d6=function(_d7,_d8){d.errback(_d7);};var _d9=function(_da,_db){t.assertEqual(1,_da.length);var _dc=_da[0];t.assertTrue(_d4.isItem(_dc));var _dd=function(_de,_df){t.assertEqual(1,_de.length);var _e0=_de[0];t.assertTrue(_d5.isItem(_e0));t.assertTrue(!_d4.isItem(_e0));t.assertTrue(!_d5.isItem(_dc));d.callback(true);};_d5.fetch({query:{isbn:"A9B574"},onComplete:_dd,onError:_d6});};_d4.fetch({query:{isbn:"A9B574"},onComplete:_d9,onError:_d6});return d;},function testReadAPI_hasAttribute(t){var _e1=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _e2(_e3,_e4){t.assertEqual(1,_e3.length);var _e5=_e3[0];t.assertTrue(_e1.hasAttribute(_e5,"isbn"));t.assertTrue(!_e1.hasAttribute(_e5,"bob"));t.assertTrue(_e1.hasAttribute(_e5,"@xmlAttribute"));t.assertFalse(_e1.hasAttribute(_e5,"@bogus"));d.callback(true);};function _e6(_e7,_e8){d.errback(_e7);};_e1.fetch({query:{isbn:"A9B574"},onComplete:_e2,onError:_e6});return d;},function testReadAPI_containsValue(t){var _e9=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _ea(_eb,_ec){t.assertEqual(1,_eb.length);var _ed=_eb[0];t.assertTrue(_e9.containsValue(_ed,"isbn","A9B574"));t.assertTrue(!_e9.containsValue(_ed,"isbn","bob"));d.callback(true);};function _ee(_ef,_f0){d.errback(_ef);};_e9.fetch({query:{isbn:"A9B574"},onComplete:_ea,onError:_ee});return d;},function testReadAPI_sortDescending(t){var _f1=_3.data.tests.stores.XmlStore.getBooksStore();var _f2=[9,8,7,6,5,4,3,20,2,19,18,17,16,15,14,13,12,11,10,1];var d=new doh.Deferred();function _f3(_f4,_f5){t.assertEqual(20,_f4.length);for(var i=0;i<_f4.length;i++){t.assertEqual(_f2[i],_f1.getValue(_f4[i],"isbn").toString());}d.callback(true);};function _f6(_f7,_f8){d.errback(_f7);};var _f9=[{attribute:"isbn",descending:true}];_f1.fetch({query:{isbn:"*"},sort:_f9,onComplete:_f3,onError:_f6});return d;},function testReadAPI_sortAscending(t){var _fa=_3.data.tests.stores.XmlStore.getBooksStore();var _fb=[1,10,11,12,13,14,15,16,17,18,19,2,20,3,4,5,6,7,8,9];var d=new doh.Deferred();function _fc(_fd,_fe){t.assertEqual(20,_fd.length);var _ff=1;for(var i=0;i<_fd.length;i++){t.assertEqual(_fb[i],_fa.getValue(_fd[i],"isbn").toString());}d.callback(true);};function _100(_101,_102){d.errback(_101);};var _103=[{attribute:"isbn"}];_fa.fetch({query:{isbn:"*"},sort:_103,onComplete:_fc,onError:_100});return d;},function testReadAPI_sortDescendingNumeric(t){var _104=_3.data.tests.stores.XmlStore.getBooksStore();_104.comparatorMap={};_104.comparatorMap["isbn"]=function(a,b){var ret=0;if(parseInt(a.toString(),10)>parseInt(b.toString(),10)){ret=1;}else{if(parseInt(a.toString(),10)<parseInt(b.toString(),10)){ret=-1;}}return ret;};var d=new doh.Deferred();function _105(_106,_107){t.assertEqual(20,_106.length);var _108=20;for(var i=0;i<_106.length;i++){t.assertEqual(_108,_104.getValue(_106[i],"isbn").toString());_108--;}d.callback(true);};function _109(_10a,_10b){d.errback(_10a);};var _10c=[{attribute:"isbn",descending:true}];_104.fetch({query:{isbn:"*"},sort:_10c,onComplete:_105,onError:_109});return d;},function testReadAPI_sortAscendingNumeric(t){var _10d=_3.data.tests.stores.XmlStore.getBooksStore();_10d.comparatorMap={};_10d.comparatorMap["isbn"]=function(a,b){var ret=0;if(parseInt(a.toString(),10)>parseInt(b.toString(),10)){ret=1;}else{if(parseInt(a.toString(),10)<parseInt(b.toString(),10)){ret=-1;}}return ret;};var d=new doh.Deferred();function _10e(_10f,_110){t.assertEqual(20,_10f.length);var _111=1;for(var i=0;i<_10f.length;i++){t.assertEqual(_111,_10d.getValue(_10f[i],"isbn").toString());_111++;}d.callback(true);};function _112(_113,_114){d.errback(_113);};var _115=[{attribute:"isbn"}];_10d.fetch({query:{isbn:"*"},sort:_115,onComplete:_10e,onError:_112});return d;},function testReadAPI_isItemLoaded(t){var _116=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _117(_118,_119){t.assertEqual(1,_118.length);var item=_118[0];t.assertTrue(_116.isItemLoaded(item));d.callback(true);};function _11a(_11b,_11c){d.errback(_11b);};_116.fetch({query:{isbn:"A9B574"},onComplete:_117,onError:_11a});return d;},function testReadAPI_getFeatures(t){var _11d=_3.data.tests.stores.XmlStore.getBooks2Store();var _11e=_11d.getFeatures();var _11f=0;var i;for(i in _11e){t.assertTrue((i==="dojo.data.api.Read"||i==="dojo.data.api.Write"||"dojo.data.api.Identity"));_11f++;}t.assertEqual(3,_11f);},function testReadAPI_getAttributes(t){var _120=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _121(_122,_123){t.assertEqual(1,_122.length);var item=_122[0];var _124=_120.getAttributes(item);for(var i=0;i<_124.length;i++){}if(_1.isIE){t.assertEqual(5,_124.length);}else{t.assertEqual(6,_124.length);}d.callback(true);};function _125(_126,_127){d.errback(_126);};_120.fetch({query:{isbn:"A9B577"},onComplete:_121,onError:_125});return d;},function testWriteAPI_setValue(t){var _128=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _129(_12a,_12b){t.assertEqual(1,_12a.length);var item=_12a[0];t.assertTrue(_128.containsValue(item,"isbn","A9B574"));_128.setValue(item,"isbn","A9B574-new");t.assertEqual(_128.getValue(item,"isbn").toString(),"A9B574-new");d.callback(true);};function _12c(_12d,_12e){d.errback(_12d);};_128.fetch({query:{isbn:"A9B574"},onComplete:_129,onError:_12c});return d;},function testWriteAPI_setValues(t){var _12f=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _130(_131,_132){t.assertEqual(1,_131.length);var item=_131[0];t.assertTrue(_12f.containsValue(item,"isbn","A9B574"));_12f.setValues(item,"isbn",["A9B574-new1","A9B574-new2"]);var _133=_12f.getValues(item,"isbn");t.assertEqual(_133[0].toString(),"A9B574-new1");t.assertEqual(_133[1].toString(),"A9B574-new2");_12f.setValues(_133[0],"text()",["A9B574","-new3"]);t.assertEqual(_12f.getValue(_133[0],"text()").toString(),"A9B574-new3");d.callback(true);};function _134(_135,_136){d.errback(_135);};_12f.fetch({query:{isbn:"A9B574"},onComplete:_130,onError:_134});return d;},function testWriteAPI_unsetAttribute(t){var _137=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _138(_139,_13a){t.assertEqual(1,_139.length);var item=_139[0];t.assertTrue(_137.containsValue(item,"isbn","A9B574"));_137.unsetAttribute(item,"isbn");t.assertTrue(!_137.hasAttribute(item,"isbn"));t.assertTrue(_137.isDirty(item));d.callback(true);};function _13b(_13c,_13d){d.errback(_13c);};_137.fetch({query:{isbn:"A9B574"},onComplete:_138,onError:_13b});return d;},function testWriteAPI_isDirty(t){var _13e=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _13f(_140,_141){t.assertEqual(1,_140.length);var item=_140[0];t.assertTrue(_13e.containsValue(item,"isbn","A9B574"));_13e.setValue(item,"isbn","A9B574-new");t.assertEqual(_13e.getValue(item,"isbn").toString(),"A9B574-new");t.assertTrue(_13e.isDirty(item));d.callback(true);};function _142(_143,_144){d.errback(_143);};_13e.fetch({query:{isbn:"A9B574"},onComplete:_13f,onError:_142});return d;},function testWriteAPI_revert(t){var _145=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();var _146=function(_147,_148){d.errback(_147);};var _149=function(_14a,_14b){t.assertEqual(1,_14a.length);var item=_14a[0];t.assertTrue(_145.containsValue(item,"isbn","A9B574"));t.assertTrue(!_145.isDirty(item));_145.setValue(item,"isbn","A9B574-new");t.assertEqual(_145.getValue(item,"isbn").toString(),"A9B574-new");t.assertTrue(_145.isDirty(item));_145.revert();var _14c=function(_14d,_14e){t.assertEqual(1,_14d.length);var item=_14d[0];t.assertTrue(_145.containsValue(item,"isbn","A9B574"));d.callback(true);};_145.fetch({query:{isbn:"A9B574"},onComplete:_14c,onError:_146});};_145.fetch({query:{isbn:"A9B574"},onComplete:_149,onError:_146});return d;},function testIdentityAPI_getIdentity(t){var _14f=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _150(_151,_152){t.assertEqual(1,_151.length);var item=_151[0];try{t.assertTrue(_14f.containsValue(item,"isbn","A9B5CC"));t.assertTrue(_14f.getIdentity(item)!==null);d.callback(true);}catch(e){d.errback(e);}};function _153(_154,_155){d.errback(_154);};_14f.fetch({query:{isbn:"A9B5CC"},onComplete:_150,onError:_153});return d;},function testIdentityAPI_getIdentityAttributes(t){var _156=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _157(item,_158){try{t.assertTrue(item!==null);var _159=_156.getIdentityAttributes(item);t.assertTrue(_159===null);t.assertEqual("/books[0]/book[4]",_156.getIdentity(item));d.callback(true);}catch(e){d.errback(e);}};function _15a(_15b,_15c){d.errback(_15b);};_156.fetchItemByIdentity({identity:"/books[0]/book[4]",onItem:_157,onError:_15a});return d;},function testIdentityAPI_getIdentityAttributes_usingKeyAttributeIdentity(t){var _15d=_3.data.tests.stores.XmlStore.getBooks3Store();var d=new doh.Deferred();function _15e(item,_15f){try{t.assertTrue(item!==null);var _160=_15d.getIdentityAttributes(item);t.assertTrue(_160!==null);t.assertTrue(_160.length===1);t.assertTrue(_160[0]==="isbn");d.callback(true);}catch(e){d.errback(e);}};function _161(_162,_163){d.errback(_162);};_15d.fetchItemByIdentity({identity:"A9B574",onItem:_15e,onError:_161});return d;},function testIdentityAPI_fetchItemByIdentity(t){var _164=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _165(item,_166){try{t.assertTrue(item!==null);t.assertEqual("/books[0]/book[4]",_164.getIdentity(item));d.callback(true);}catch(e){d.errback(e);}};function _167(_168,_169){d.errback(_168);};_164.fetchItemByIdentity({identity:"/books[0]/book[4]",onItem:_165,onError:_167});return d;},function testIdentityAPI_fetchItemByIdentity2(t){var _16a=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _16b(item,_16c){try{t.assertTrue(item!==null);t.assertEqual("/books[0]/book[0]",_16a.getIdentity(item));d.callback(true);}catch(e){d.errback(e);}};function _16d(_16e,_16f){d.errback(_16e);};_16a.fetchItemByIdentity({identity:"/books[0]/book[0]",onItem:_16b,onError:_16d});return d;},function testIdentityAPI_fetchItemByIdentity3(t){var _170=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _171(item,_172){try{t.assertTrue(item!==null);t.assertEqual("/books[0]/book[2]",_170.getIdentity(item));d.callback(true);}catch(e){d.errback(e);}};function _173(_174,_175){d.errback(_174);};_170.fetchItemByIdentity({identity:"/books[0]/book[2]",onItem:_171,onError:_173});return d;},function testIdentityAPI_fetchItemByIdentity_usingKeyAttributeIdentity(t){var _176=_3.data.tests.stores.XmlStore.getBooks3Store();var d=new doh.Deferred();function _177(item,_178){try{t.assertTrue(item!==null);t.assertEqual("A9B574",_176.getIdentity(item));d.callback(true);}catch(e){d.errback(e);}};function _179(_17a,_17b){d.errback(_17a);};_176.fetchItemByIdentity({identity:"A9B574",onItem:_177,onError:_179});return d;},function testIdentityAPI_fetchItemByIdentity_usingKeyAttributeIdentity2(t){var _17c=_3.data.tests.stores.XmlStore.getBooks3Store();var d=new doh.Deferred();function _17d(item,_17e){try{t.assertTrue(item!==null);t.assertEqual("A9B57C",_17c.getIdentity(item));d.callback(true);}catch(e){d.errback(e);}};function _17f(_180,_181){d.errback(_180);};_17c.fetchItemByIdentity({identity:"A9B57C",onItem:_17d,onError:_17f});return d;},function testIdentityAPI_fetchItemByIdentity_usingKeyAttributeIdentity3(t){var _182=_3.data.tests.stores.XmlStore.getBooks3Store();var d=new doh.Deferred();function _183(item,_184){try{t.assertTrue(item!==null);t.assertEqual("A9B5CC",_182.getIdentity(item));d.callback(true);}catch(e){d.errback(e);}};function _185(_186,_187){d.errback(_186);};_182.fetchItemByIdentity({identity:"A9B5CC",onItem:_183,onError:_185});return d;},function testIdentityAPI_fetchItemByIdentity_usingKeyAttributeIdentity4(t){var _188=_3.data.tests.stores.XmlStore.getGeographyStore();var d=new doh.Deferred();function _189(item,_18a){try{t.assertTrue(item!==null);t.assertEqual("Mexico City",_188.getIdentity(item));d.callback(true);}catch(e){d.errback(e);}};function _18b(_18c,_18d){d.errback(_18c);};_188.fetchItemByIdentity({identity:"Mexico City",onItem:_189,onError:_18b});return d;},function testIdentityAPI_fetchItemByIdentity_fails(t){var _18e=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _18f(item,_190){t.assertTrue(item===null);d.callback(true);};function _191(_192,_193){d.errback(_192);};_18e.fetchItemByIdentity({identity:"/books[0]/book[200]",onItem:_18f,onError:_191});return d;},function testIdentityAPI_fetchItemByIdentity_fails2(t){var _194=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _195(item,_196){t.assertTrue(item===null);d.callback(true);};function _197(_198,_199){d.errback(_198);};_194.fetchItemByIdentity({identity:"/books[1]/book[4]",onItem:_195,onError:_197});return d;},function testIdentityAPI_fetchItemByIdentity_fails3(t){var _19a=_3.data.tests.stores.XmlStore.getBooks2Store();var d=new doh.Deferred();function _19b(item,_19c){t.assertTrue(item===null);d.callback(true);};function _19d(_19e,_19f){d.errback(_19e);};_19a.fetchItemByIdentity({identity:"/books[1]/book[200]",onItem:_19b,onError:_19d});return d;},function testIdentityAPI_fetchItemByIdentity_usingKeyAttributeIdentity_fails(t){var _1a0=_3.data.tests.stores.XmlStore.getBooks3Store();var d=new doh.Deferred();function _1a1(item,_1a2){try{t.assertTrue(item===null);d.callback(true);}catch(e){d.errback(e);}};function _1a3(_1a4,_1a5){d.errback(_1a4);};_1a0.fetchItemByIdentity({identity:"A9B574_NONEXISTANT",onItem:_1a1,onError:_1a3});return d;},function testReadAPI_functionConformance(t){var _1a6=_3.data.tests.stores.XmlStore.getBooksStore();var _1a7=new _1.data.api.Read();var _1a8=true;var i;for(i in _1a7){var _1a9=_1a7[i];if(typeof _1a9==="function"){var _1aa=_1a6[i];if(!(typeof _1aa==="function")){_1a8=false;break;}}}t.assertTrue(_1a8);},function testWriteAPI_functionConformance(t){var _1ab=_3.data.tests.stores.XmlStore.getBooksStore();var _1ac=new _1.data.api.Write();var _1ad=true;var i;for(i in _1ac){var _1ae=_1ac[i];if(typeof _1ae==="function"){var _1af=_1ab[i];if(!(typeof _1af==="function")){_1ad=false;break;}}}t.assertTrue(_1ad);},function testIdentityAPI_functionConformance(t){var _1b0=_3.data.tests.stores.XmlStore.getBooksStore();var _1b1=new _1.data.api.Identity();var _1b2=true;var i;for(i in _1b1){var _1b3=_1b1[i];if(typeof _1b3==="function"){var _1b4=_1b0[i];if(!(typeof _1b4==="function")){_1b2=false;break;}}}t.assertTrue(_1b2);}]);});require(["dojox/data/tests/stores/XmlStore"]);