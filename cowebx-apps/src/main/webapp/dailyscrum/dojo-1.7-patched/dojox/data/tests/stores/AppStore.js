/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/data/AppStore","dojo/data/api/Read","dojo/data/api/Write","dojo/data/api/Identity"],function(_1,_2,_3){_1.getObject("dojox.data.tests.stores.AppStore",1);_3.data.tests.stores.AppStore.getStore=function(_4){_4=_4?true:false;return new _3.data.AppStore({url:_1.moduleUrl("dojox.atom.tests.widget","samplefeedEdit.xml").toString(),urlPreventCache:_4});};doh.register("dojox.data.tests.stores.AppStore",[function testReadAPI_fetch_all(t){var _5=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _6(_7,_8){t.assertEqual(8,_7.length);d.callback(true);};function _9(_a,_b){d.errback(_a);};_5.fetch({query:{title:"*"},onComplete:_6,onError:_9});return d;},function testReadAPI_fetch_all_preventCache(t){var _c=_3.data.tests.stores.AppStore.getStore(true);var d=new doh.Deferred();function _d(_e,_f){t.assertEqual(8,_e.length);d.callback(true);};function _10(_11,_12){d.errback(_11);};_c.fetch({query:{title:"*"},onComplete:_d,onError:_10});return d;},function testReadAPI_fetch_one(t){var _13=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _14(_15,_16){t.assertEqual(1,_15.length);d.callback(true);};function _17(_18,_19){d.errback(_18);};_13.fetch({query:{title:"Test Editable Entry #1"},onComplete:_14,onError:_17});return d;},function testReadAPI_fetch_paging(t){var _1a=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _1b(_1c,_1d){t.assertEqual(0,_1c.length);d.callback(true);};function _1e(_1f,_20){t.assertEqual(6,_1f.length);_20.start=9;_20.count=100;_20.onComplete=_1b;_1a.fetch(_20);};function _21(_22,_23){t.assertEqual(5,_22.length);_23.start=2;_23.count=20;_23.onComplete=_1e;_1a.fetch(_23);};function _24(_25,_26){t.assertEqual(1,_25.length);_26.start=0;_26.count=5;_26.onComplete=_21;_1a.fetch(_26);};function _27(_28,_29){t.assertEqual(5,_28.length);_29.start=3;_29.count=1;_29.onComplete=_24;_1a.fetch(_29);};function _2a(_2b,_2c){t.assertEqual(8,_2b.length);_2c.start=1;_2c.count=5;_2c.onComplete=_27;_1a.fetch(_2c);};function _2d(_2e,_2f){d.errback(_2e);};_1a.fetch({onComplete:_2a,onError:_2d});return d;},function testReadAPI_fetch_pattern0(t){var _30=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _31(_32,_33){t.assertEqual(1,_32.length);d.callback(true);};function _34(_35,_36){d.errback(_35);};_30.fetch({query:{title:"?est Editable Entry #1"},onComplete:_31,onError:_34});return d;},function testReadAPI_fetch_pattern1(t){var _37=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _38(_39,_3a){t.assertEqual(8,_39.length);d.callback(true);};function _3b(_3c,_3d){d.errback(_3c);};_37.fetch({query:{title:"*Test*"},onComplete:_38,onError:_3b});return d;},function testReadAPI_fetch_pattern_caseInsensitive(t){var _3e=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _3f(_40,_41){t.assertEqual(8,_40.length);d.callback(true);};function _42(_43,_44){d.errback(_43);};_3e.fetch({query:{title:"*test*"},queryOptions:{ignoreCase:true},onComplete:_3f,onError:_42});return d;},function testReadAPI_getLabel(t){var _45=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _46(_47,_48){t.assertEqual(_47.length,1);var _49=_45.getLabel(_47[0]);t.assertTrue(_49!==null);t.assertEqual("Test Editable Entry #1",_49);d.callback(true);};function _4a(_4b,_4c){d.errback(_4b);};_45.fetch({query:{title:"Test Editable Entry #1"},onComplete:_46,onError:_4a});return d;},function testReadAPI_getLabelAttributes(t){var _4d=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _4e(_4f,_50){t.assertEqual(_4f.length,1);var _51=_4d.getLabelAttributes(_4f[0]);t.assertTrue(_1.isArray(_51));t.assertEqual("title",_51[0]);d.callback(true);};function _52(_53,_54){d.errback(_53);};_4d.fetch({query:{title:"Test Editable Entry #1"},onComplete:_4e,onError:_52});return d;},function testReadAPI_getValue(t){var _55=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _56(_57,_58){t.assertEqual(1,_57.length);var _59=_57[0];t.assertTrue(_55.hasAttribute(_59,"id"));t.assertEqual(_55.getValue(_59,"id"),"http://example.com/samplefeedEdit.xml/entry/10");d.callback(true);};function _5a(_5b,_5c){d.errback(_5b);};_55.fetch({query:{title:"Test Editable Entry #1"},onComplete:_56,onError:_5a});return d;},function testReadAPI_getValues(t){var _5d=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _5e(_5f,_60){t.assertEqual(1,_5f.length);var _61=_5f[0];t.assertTrue(_5d.hasAttribute(_61,"id"));var _62=_5d.getValues(_61,"id");t.assertEqual(1,_62.length);t.assertEqual(_62[0],"http://example.com/samplefeedEdit.xml/entry/10");d.callback(true);};function _63(_64,_65){d.errback(_64);};_5d.fetch({query:{title:"Test Editable Entry #1"},onComplete:_5e,onError:_63});return d;},function testReadAPI_isItem(t){var _66=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _67(_68,_69){t.assertEqual(1,_68.length);var _6a=_68[0];t.assertTrue(_66.isItem(_6a));t.assertTrue(!_66.isItem({}));t.assertTrue(!_66.isItem("Foo"));t.assertTrue(!_66.isItem(1));d.callback(true);};function _6b(_6c,_6d){d.errback(_6c);};_66.fetch({query:{title:"Test Editable Entry #1"},onComplete:_67,onError:_6b});return d;},function testReadAPI_isItem_multistore(t){var _6e=_3.data.tests.stores.AppStore.getStore();var _6f=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _70(_71,_72){d.errback(_71);};function _73(_74,_75){t.assertEqual(1,_74.length);var _76=_74[0];t.assertTrue(_6e.isItem(_76));function _77(_78,_79){t.assertEqual(1,_78.length);var _7a=_78[0];t.assertTrue(_6f.isItem(_7a));t.assertTrue(!_6e.isItem(_7a));t.assertTrue(!_6f.isItem(_76));d.callback(true);};_6f.fetch({query:{title:"Test Entry #1"},onComplete:_77,onError:_70});};_6e.fetch({query:{title:"Test Editable Entry #1"},onComplete:_73,onError:_70});return d;},function testReadAPI_hasAttribute(t){var _7b=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _7c(_7d,_7e){d.errback(_7d);};function _7f(_80,_81){t.assertEqual(1,_80.length);var _82=_80[0];t.assertTrue(_7b.hasAttribute(_82,"title"));t.assertTrue(_7b.hasAttribute(_82,"summary"));t.assertTrue(!_7b.hasAttribute(_82,"bob"));d.callback(true);};_7b.fetch({query:{title:"Test Editable Entry #1"},onComplete:_7f,onError:_7c});return d;},function testReadAPI_containsValue(t){var _83=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _84(_85,_86){t.assertEqual(1,_85.length);var _87=_85[0];t.assertTrue(_83.containsValue(_87,"title","Test Editable Entry #1"));t.assertTrue(!_83.containsValue(_87,"title","bob"));d.callback(true);};function _88(_89,_8a){d.errback(_89);};_83.fetch({query:{title:"Test Editable Entry #1"},onComplete:_84,onError:_88});return d;},function testReadAPI_sortDescending(t){var _8b=_3.data.tests.stores.AppStore.getStore();var _8c=["Test Entry #6","Test Entry #5","Test Entry #4","Test Entry #3","Test Entry #2","Test Entry #1","Test Editable Entry #2","Test Editable Entry #1"];var d=new doh.Deferred();function _8d(_8e,_8f){t.assertEqual(8,_8e.length);for(var i=0;i<_8e.length;i++){t.assertEqual(_8c[i],_8b.getValue(_8e[i],"title"));}d.callback(true);};function _90(_91,_92){d.errback(_91);};var _93=[{attribute:"title",descending:true}];_8b.fetch({query:{title:"*"},sort:_93,onComplete:_8d,onError:_90});return d;},function testReadAPI_sortAscending(t){var _94=_3.data.tests.stores.AppStore.getStore();var _95=["Test Editable Entry #1","Test Editable Entry #2","Test Entry #1","Test Entry #2","Test Entry #3","Test Entry #4","Test Entry #5","Test Entry #6"];var d=new doh.Deferred();function _96(_97,_98){t.assertEqual(8,_97.length);var _99=1;for(var i=0;i<_97.length;i++){t.assertEqual(_95[i],_94.getValue(_97[i],"title"));}d.callback(true);};function _9a(_9b,_9c){d.errback(_9b);};var _9d=[{attribute:"title"}];_94.fetch({query:{title:"*"},sort:_9d,onComplete:_96,onError:_9a});return d;},function testReadAPI_isItemLoaded(t){var _9e=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _9f(_a0,_a1){t.assertEqual(1,_a0.length);var _a2=_a0[0];t.assertTrue(_9e.isItemLoaded(_a2));d.callback(true);};function _a3(_a4,_a5){d.errback(_a4);};_9e.fetch({query:{title:"Test Editable Entry #1"},onComplete:_9f,onError:_a3});return d;},function testReadAPI_getFeatures(t){var _a6=_3.data.tests.stores.AppStore.getStore();var _a7=_a6.getFeatures();var _a8=0;for(var i in _a7){t.assertTrue((i==="dojo.data.api.Read"||i==="dojo.data.api.Write"||i==="dojo.data.api.Identity"));_a8++;}t.assertEqual(3,_a8);},function testReadAPI_getAttributes(t){var _a9=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _aa(_ab,_ac){t.assertEqual(1,_ab.length);var _ad=_ab[0];var _ae=_a9.getAttributes(_ad);t.assertEqual(6,_ae.length);d.callback(true);};function _af(_b0,_b1){d.errback(_b0);};_a9.fetch({query:{title:"Test Editable Entry #1"},onComplete:_aa,onError:_af});return d;},function testWriteAPI_newItem(t){var _b2=_3.data.tests.stores.AppStore.getStore();_b2.newItem({title:"New entry",id:"12345",content:"This is test content",author:{name:"Bob"}});var d=new doh.Deferred();function _b3(_b4,_b5){t.assertEqual(1,_b4.length);var _b6=_b4[0];t.assertTrue(_b2.containsValue(_b6,"title","New entry"));t.assertTrue(_b2.containsValue(_b6,"content","This is test content"));d.callback(true);};function _b7(_b8,_b9){d.errback(_b8);};_b2.fetch({query:{title:"New entry"},onComplete:_b3,onError:_b7});return d;},function testWriteAPI_newItemInCallback(t){var _ba=_3.data.tests.stores.AppStore.getStore();_ba.newItem({title:"New entry",id:"12345",content:"This is test content",author:{name:"Bob"}});var d=new doh.Deferred();function _bb(_bc,_bd){d.errback(_bc);};function _be(_bf,_c0){t.assertEqual(1,_bf.length);var _c1=_bf[0];t.assertTrue(_ba.containsValue(_c1,"title","New entry"));t.assertTrue(_ba.containsValue(_c1,"content","This is test content"));_ba.newItem({title:"New entry2",id:"12346",content:"This is test content",author:[{name:"Bob"}]});function _c2(_c3,_c4){t.assertEqual(1,_c3.length);var _c5=_c3[0];t.assertTrue(_ba.containsValue(_c5,"title","New entry2"));d.callback(true);};_ba.fetch({query:{title:"New entry2"},onComplete:_c2,onError:_bb});};_ba.fetch({query:{title:"New entry"},onComplete:_be,onError:_bb});return d;},function testWriteAPI_deleteItem(t){var _c6=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _c7(_c8,_c9){d.errback(_c8);};function _ca(_cb,_cc){t.assertEqual(1,_cb.length);var _cd=_cb[0];t.assertTrue(_c6.containsValue(_cd,"title","Test Editable Entry #1"));_c6.deleteItem(_cd);function _ce(_cf,_d0){t.assertEqual(0,_cf.length);d.callback(true);};_c6.fetch({query:{title:"Test Editable Entry #1"},onComplete:_ce,onError:_c7});};_c6.fetch({query:{title:"Test Editable Entry #1"},onComplete:_ca,onError:_c7});return d;},function testWriteAPI_setValue(t){var _d1=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _d2(_d3,_d4){t.assertEqual(1,_d3.length);var _d5=_d3[0];t.assertTrue(_d1.containsValue(_d5,"title","Test Editable Entry #1"));_d1.setValue(_d5,"title","Edited title");t.assertEqual(_d1.getValue(_d5,"title"),"Edited title");d.callback(true);};function _d6(_d7,_d8){d.errback(_d7);};_d1.fetch({query:{title:"Test Editable Entry #1"},onComplete:_d2,onError:_d6});return d;},function testWriteAPI_setValues(t){var _d9=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _da(_db,_dc){t.assertEqual(1,_db.length);var _dd=_db[0];t.assertTrue(_d9.containsValue(_dd,"title","Test Editable Entry #1"));_d9.setValues(_dd,"author",[{name:"John"},{name:"Bill",email:"bill@example.com",uri:"http://example.com/bill"}]);var _de=_d9.getValues(_dd,"author");t.assertEqual(_de[0].name,"John");t.assertEqual(_de[1].name,"Bill");t.assertEqual(_de[1].email,"bill@example.com");t.assertEqual(_de[1].uri,"http://example.com/bill");d.callback(true);};function _df(_e0,_e1){d.errback(_e0);};_d9.fetch({query:{title:"Test Editable Entry #1"},onComplete:_da,onError:_df});return d;},function testWriteAPI_unsetAttribute(t){var _e2=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _e3(_e4,_e5){t.assertEqual(1,_e4.length);var _e6=_e4[0];t.assertTrue(_e2.containsValue(_e6,"title","Test Editable Entry #1"));_e2.unsetAttribute(_e6,"title");t.assertTrue(!_e2.hasAttribute(_e6,"title"));t.assertTrue(_e2.isDirty(_e6));d.callback(true);};function _e7(_e8,_e9){d.errback(_e8);};_e2.fetch({query:{title:"Test Editable Entry #1"},onComplete:_e3,onError:_e7});return d;},function testWriteAPI_isDirty(t){var _ea=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _eb(_ec,_ed){t.assertEqual(1,_ec.length);var _ee=_ec[0];t.assertTrue(_ea.containsValue(_ee,"title","Test Editable Entry #1"));_ea.setValue(_ee,"title","Edited title");t.assertEqual(_ea.getValue(_ee,"title"),"Edited title");t.assertTrue(_ea.isDirty(_ee));d.callback(true);};function _ef(_f0,_f1){d.errback(_f0);};_ea.fetch({query:{title:"Test Editable Entry #1"},onComplete:_eb,onError:_ef});return d;},function testWriteAPI_revert(t){var _f2=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _f3(_f4,_f5){d.errback(_f4);};function _f6(_f7,_f8){t.assertEqual(1,_f7.length);var _f9=_f7[0];t.assertTrue(_f2.containsValue(_f9,"title","Test Editable Entry #1"));t.assertTrue(!_f2.isDirty(_f9));_f2.setValue(_f9,"title","Edited title");t.assertEqual(_f2.getValue(_f9,"title"),"Edited title");t.assertTrue(_f2.isDirty(_f9));_f2.revert();function _fa(_fb,_fc){t.assertEqual(1,_fb.length);var _fd=_fb[0];t.assertTrue(_f2.containsValue(_fd,"title","Test Editable Entry #1"));d.callback(true);};_f2.fetch({query:{title:"Test Editable Entry #1"},onComplete:_fa,onError:_f3});};_f2.fetch({query:{title:"Test Editable Entry #1"},onComplete:_f6,onError:_f3});return d;},function testWriteAPI_revert2(t){var _fe=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _ff(_100,_101){d.errback(_100);};function _102(_103,_104){t.assertEqual(1,_103.length);var item=_103[0];t.assertTrue(_fe.containsValue(item,"title","Test Editable Entry #1"));_fe.deleteItem(item);function _105(_106,_107){t.assertEqual(7,_106.length);_fe.newItem({title:"New entry",id:"12345",content:"This is test content",author:{name:"Bob"}});function _108(_109,_10a){t.assertEqual(1,_109.length);_fe.revert();function _10b(_10c,_10d){t.assertEqual(0,_10c.length);d.callback(true);};_fe.fetch({query:{title:"New entry"},onComplete:_10b,onError:_ff});};_fe.fetch({query:{title:"New entry"},onComplete:_108,onError:_ff});};_fe.fetch({query:{title:"*"},onComplete:_105,onError:_ff});};_fe.fetch({query:{title:"Test Editable Entry #1"},onComplete:_102,onError:_ff});return d;},function testReadAPI_getIdentity(t){var _10e=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _10f(_110,_111){t.assertEqual(1,_110.length);var id=_10e.getIdentity(_110[0]);t.assertEqual("http://example.com/samplefeedEdit.xml/entry/10",id);d.callback(true);};function _112(_113,_114){d.errback(_113);};_10e.fetch({query:{title:"Test Editable Entry #1"},onComplete:_10f,onError:_112});return d;},function testReadAPI_getIdentityAttributes(t){var _115=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _116(_117,_118){t.assertEqual(1,_117.length);var _119=_115.getIdentityAttributes(_117[0]);t.assertEqual(1,_119.length);t.assertEqual("id",_119[0]);d.callback(true);};function _11a(_11b,_11c){d.errback(_11b);};_115.fetch({query:{title:"Test Editable Entry #1"},onComplete:_116,onError:_11a});return d;},function testReadAPI_fetchItemByIdentity(t){var _11d=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _11e(item,_11f){var id=_11d.getIdentity(item);t.assertEqual("http://example.com/samplefeedEdit.xml/entry/10",id);d.callback(true);};function _120(_121,_122){d.errback(_121);};_11d.fetchItemByIdentity({identity:"http://example.com/samplefeedEdit.xml/entry/10",onItem:_11e,onError:_120});return d;},function testReadAPI_fetchItemByIdentity_fails(t){var _123=_3.data.tests.stores.AppStore.getStore();var d=new doh.Deferred();function _124(item,_125){t.assertTrue(item===null);d.callback(true);};function _126(_127,_128){d.errback(_127);};_123.fetchItemByIdentity({identity:"http://example.com/samplefeedEdit.xml/entry/10/none",onItem:_124,onError:_126});return d;},function testReadAPI_functionConformance(t){var _129=_3.data.tests.stores.AppStore.getStore();var _12a=new _1.data.api.Read();var _12b=true;for(var i in _12a){var _12c=_12a[i];if(typeof _12c==="function"){var _12d=_129[i];if(!(typeof _12d==="function")){_12b=false;break;}}}t.assertTrue(_12b);},function testWriteAPI_functionConformance(t){var _12e=_3.data.tests.stores.AppStore.getStore();var _12f=new _1.data.api.Write();var _130=true;for(var i in _12f){var _131=_12f[i];if(typeof _131==="function"){var _132=_12e[i];if(!(typeof _132==="function")){_130=false;break;}}}t.assertTrue(_130);},function testIdentityAPI_functionConformance(t){var _133=_3.data.tests.stores.AppStore.getStore();var _134=new _1.data.api.Identity();var _135=true;for(var i in _134){var _136=_134[i];if(typeof _136==="function"){var _137=_133[i];if(!(typeof _137==="function")){_135=false;break;}}}t.assertTrue(_135);}]);});require(["dojox/data/tests/stores/AppStore"]);