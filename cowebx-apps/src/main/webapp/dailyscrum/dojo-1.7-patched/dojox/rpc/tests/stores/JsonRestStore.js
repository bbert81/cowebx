/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/data/JsonRestStore","dojo/data/api/Read","dojox/rpc/Service"],function(_1,_2,_3){_1.getObject("dojox.rpc.tests.stores.JsonRestStore",1);_3.rpc.tests.stores.JsonRestStore.error=function(t,d,_4){d.errback(_4);};var _5=new _3.rpc.Service(_1.moduleUrl("dojox.rpc.tests.resources","test.smd"));var _6=new _3.data.JsonRestStore({service:_5.jsonRestStore});doh.register("dojox.rpc.tests.stores.JsonRestStore",[{name:"Fetch some items",timeout:10000,runTest:function(t){var d=new doh.Deferred();_6.fetch({query:"query",onComplete:function(_7,_8){t.is(4,_7.length);d.callback(true);},onError:_1.partial(_3.rpc.tests.stores.JsonRestStore.error,doh,d)});return d;}},{name:"fetch by id",timeout:10000,runTest:function(t){var d=new doh.Deferred();_6.fetch({query:"obj1",onComplete:function(_9,_a){t.is("Object 1",_9.name);t.t(_6.hasAttribute(_9,"name"));t.is(_6.getValues(_9,"name").length,1);t.t(_6.isItem(_9));d.callback(true);},onError:_1.partial(_3.rpc.tests.stores.JsonRestStore.error,doh,d)});return d;}},{name:"Modify,save, check by id",timeout:10000,runTest:function(t){var d=new doh.Deferred();_6.fetch({query:"query",onComplete:function(_b,_c){var _d=new Date().getTime();_6.setValue(_b[0],"updated",_d);_6.setValue(_b[0],"obj",{foo:"bar"});_6.setValue(_b[0],"obj dup",_b[0].obj);_6.setValue(_b[0],"testArray",[1,2,3,4]);_6.save();_6.fetch({query:"obj1",onComplete:function(_e,_f){t.is("Object 1",_e.name);t.is(_d,_e.updated);t.is("bar",_e.obj.foo);t.is(_e.obj,_e["obj dup"]);d.callback(true);},onError:_1.partial(_3.rpc.tests.stores.JsonRestStore.error,doh,d)});},onError:_1.partial(_3.rpc.tests.stores.JsonRestStore.error,doh,d)});return d;}},{name:"Post, delete, and put",timeout:10000,runTest:function(t){var d=new doh.Deferred();_6.fetch({query:"obj1",onComplete:function(_10,_11){var now=new Date().getTime();var _12=_10.testArray;var _13={"name":"new object"};_12.push(_13);_6.save();_6.deleteItem(_13,{parent:_12});_6.save();_12.sort(function(_14,_15){return _14<_15;});_6.save();_12.sort(function(_16,_17){return _16>_17;});_6.save();d.callback(true);},onError:_1.partial(_3.rpc.tests.stores.JsonRestStore.error,doh,d)});return d;}},{name:"Revert",timeout:10000,runTest:function(t){var d=new doh.Deferred();_6.fetch({query:"obj1",onComplete:function(_18,_19){_6.setValue(_18,"name","new name");_6.setValue(_18,"newProp","new value");_6.unsetAttribute(_18,"updated");t.is(_6.getValue(_18,"name"),"new name");t.is(_6.getValue(_18,"newProp"),"new value");t.is(_6.getValue(_18,"updated"),undefined);_6.revert();t.is(_6.getValue(_18,"name"),"Object 1");t.is(_6.getValue(_18,"newProp"),undefined);t.t(typeof _6.getValue(_18,"updated")=="number");d.callback(true);},onError:_1.partial(_3.rpc.tests.stores.JsonRestStore.error,doh,d)});return d;}},{name:"Lazy loading",timeout:10000,runTest:function(t){var d=new doh.Deferred();_6.fetch({query:"query",onComplete:function(_1a,_1b){_6.getValue(_1a,3,function(_1c){t.is(_1c.name,"Object 4");d.callback(true);});},onError:_1.partial(_3.rpc.tests.stores.JsonRestStore.error,doh,d)});return d;}},{name:"Array manipulation",timeout:10000,runTest:function(t){var d=new doh.Deferred();_6.fetch({query:"obj1",onComplete:function(_1d,_1e){var _1f=_1d.testArray;_1f.reverse();_1f.unshift(_1f.pop());_6.onSave=function(_20){t.is(_20.length,1);d.callback(true);_6.onSave=function(){};};_6.save();},onError:_1.partial(_3.rpc.tests.stores.JsonRestStore.error,doh,d)});return d;}},{name:"ReadAPI:  Fetch_20_Streaming",timeout:10000,runTest:function(t){var d=new doh.Deferred();var _21=0;function _22(_23,_24){t.assertTrue(typeof _23=="number");_21++;};function _25(_26,_27){t.is(5,_21);t.is(null,_26);d.callback(true);};_6.fetch({query:"bigQuery",onBegin:null,count:5,onItem:_22,onComplete:_25,onError:_1.partial(_3.rpc.tests.stores.JsonRestStore.error,t,d)});return d;}},function testReadAPI_functionConformance(t){var _28=new _1.data.api.Read();var _29=true;for(i in _28){if(i.toString().charAt(0)!=="_"){var _2a=_28[i];if(typeof _2a==="function"){var _2b=_6[i];if(!(typeof _2b==="function")){_29=false;break;}}}}}]);});require(["dojox/rpc/tests/stores/JsonRestStore"]);