/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/image/Badge","dojox/data/FlickrRestStore"],function(_1,_2,_3){_1.getObject("dojox.image.FlickrBadge",1);_1.declare("dojox.image.FlickrBadge",_3.image.Badge,{children:"a.flickrImage",userid:"",username:"",setid:"",tags:"",searchText:"",target:"",apikey:"8c6803164dbc395fb7131c9d54843627",_store:null,postCreate:function(){if(this.username&&!this.userid){var _4=_1.io.script.get({url:"http://www.flickr.com/services/rest/",preventCache:true,content:{format:"json",method:"flickr.people.findByUsername",api_key:this.apikey,username:this.username},callbackParamName:"jsoncallback"});_4.addCallback(this,function(_5){if(_5.user&&_5.user.nsid){this.userid=_5.user.nsid;if(!this._started){this.startup();}}});}},startup:function(){if(this._started){return;}if(this.userid){var _6={userid:this.userid};if(this.setid){_6["setid"]=this.setid;}if(this.tags){_6.tags=this.tags;}if(this.searchText){_6.text=this.searchText;}var _7=arguments;this._store=new _3.data.FlickrRestStore({apikey:this.apikey});this._store.fetch({count:this.cols*this.rows,query:_6,onComplete:_1.hitch(this,function(_8){_1.forEach(_8,function(_9){var a=_1.doc.createElement("a");_1.addClass(a,"flickrImage");a.href=this._store.getValue(_9,"link");if(this.target){a.target=this.target;}var _a=_1.doc.createElement("img");_a.src=this._store.getValue(_9,"imageUrlThumb");_1.style(_a,{width:"100%",height:"100%"});a.appendChild(_a);this.domNode.appendChild(a);},this);_3.image.Badge.prototype.startup.call(this,_7);})});}}});});require(["dojox/image/FlickrBadge"]);