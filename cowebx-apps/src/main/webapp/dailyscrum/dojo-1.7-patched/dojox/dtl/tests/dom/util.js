/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/dtl/dom","dojox/dtl/render/dom","dojox/string/Builder"],function(_1,_2,_3){_1.getObject("dojox.dtl.tests.dom.util",1);_3.dtl.DomBuffer.prototype.onClone=function(_4,to){var _5=this._clones=this._clones||[];for(var i=0,_6;_6=_5[i];i++){for(var j=0,_7;_7=_6[j];j++){if(_7===_4){_6.push(to);return;}else{if(_7===to){_6.push(_4);return;}}}}_5.push([_4,to]);};_3.dtl.DomBuffer.prototype.onAddEvent=function(_8,_9,_a){var _b=this._events=this._events||[];var _c=false;for(var i=0,_d;_d=_b[i];i++){if(_d[0]===_8){_c=true;_d[1]=_9;_d[2]=_a;}}if(!_c){_b.push([_8,_9,_a]);}};_3.dtl.tests.dom.util.render=function(_e,_f){try{var div=document.createElement("div");_1.style(div,"visibility","hidden");var _10=document.createElement("div");div.appendChild(_10);_1.body().appendChild(div);var _11=_e.getBuffer();var _12=new _3.dtl.render.dom.Render(_10,_e);_12.render(_f,_e,_11);var _13=_11._clones;var _14=_11._events;var _15=_3.dtl.tests.dom.util.serialize(_12.domNode,_e.tokens,_13,_14).toString();_11=_e.getBuffer();_11._clones=_13;_11._events=_14;_12.render(_f,_e,_11);var _16=_3.dtl.tests.dom.util.serialize(_12.domNode,_e.tokens,_13,_14).toString();doh.is("Compare re-render: "+_15,"Compare re-render: "+_16);return _15;}catch(e){throw e;}finally{div.parentNode.removeChild(div);}};_3.dtl.tests.dom.util.serialize=function(_17,_18,_19,_1a,_1b){var _1c=_3.dtl.dom.types;_19=_19||[];_1a=_1a||[];if(_17.nodeType==3){_1b.append(_17.nodeValue);}else{var _1d=_17.nodeName.toLowerCase();if(!_1d){return;}if(!_1b){_1b=new _3.string.Builder();}_1b.append("<").append(_1d);var _1e={};var _1f=_1.filter(_18,function(_20){return _20[0]==_3.dtl.TOKEN_ATTR&&_1.isString(_20[3])&&_1.trim(_20[3]);});_1f=_1.map(_1f,"return item[2];");_1f=_1.filter(_1f,function(_21){if(!_1e[_21]){return _1e[_21]=true;}});for(var i=0,_22;_22=_1f[i];i++){var _23="";if(_22=="class"){_23=_17.className||_23;}else{if(_22=="for"){_23=_17.htmlFor||_23;}else{var _24={checked:1,disabled:1,readonly:1};if(_24[_22]&&typeof _17[_22]=="boolean"){_23=_1.attr(_17,_22)?"true":"false";}else{_23=_17.getAttribute(_22,2)||_23;}if(_17.tagName=="TEXTAREA"&&(_22=="type"||_22=="value")){continue;}if(_17.tagName=="INPUT"&&_22=="type"&&_23=="text"){continue;}if(_1.isIE&&(_22=="href"||_22=="src")){var _25=location.href.lastIndexOf(location.hash);var _26=location.href.substring(0,_25).split("/");_26.pop();_26=_26.join("/")+"/";if(_23.indexOf(_26)==0){_23=_23.replace(_26,"");}_23=decodeURIComponent(_23);}}}if(_23!==""){_1b.append(" ").append(_22).append("=\"").append(_23.replace(/"/g,"\\\"")).append("\"");}}if(_1a){for(var i=0,evt;evt=_1a[i];i++){if(evt[0]===_17){_1b.append(" ").append(evt[1]).append("=\"").append(evt[2]).append("\"");}}}if(!_17.childNodes.length){_1b.append("/>");}else{_1b.append(">");_1.forEach(_17.childNodes,function(_27){_3.dtl.tests.dom.util.serialize(_27,_18,_19,_1a,_1b);});_1b.append("</").append(_1d).append(">");}return _1b;}};});require(["dojox/dtl/tests/dom/util"]);