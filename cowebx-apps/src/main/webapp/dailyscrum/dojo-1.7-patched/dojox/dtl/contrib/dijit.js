/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/lang","../_base","../dom","dojo/parser"],function(_1,dd){_1.getObject("dtl.contrib.dijit",true,dojox);var _2=dd.contrib.dijit;_2.AttachNode=_1.extend(function(_3,_4){this._keys=_3;this._object=_4;},{render:function(_5,_6){if(!this._rendered){this._rendered=true;for(var i=0,_7;_7=this._keys[i];i++){_5.getThis()[_7]=this._object||_6.getParent();}}return _6;},unrender:function(_8,_9){if(this._rendered){this._rendered=false;for(var i=0,_a;_a=this._keys[i];i++){if(_8.getThis()[_a]===(this._object||_9.getParent())){delete _8.getThis()[_a];}}}return _9;},clone:function(_b){return new this.constructor(this._keys,this._object);}});_2.EventNode=_1.extend(function(_c,_d){this._command=_c;var _e,_f=_c.split(/\s*,\s*/);var _10=_1.trim;var _11=[];var fns=[];while(_e=_f.pop()){if(_e){var fn=null;if(_e.indexOf(":")!=-1){var _12=_e.split(":");_e=_10(_12[0]);fn=_10(_12.slice(1).join(":"));}else{_e=_10(_e);}if(!fn){fn=_e;}_11.push(_e);fns.push(fn);}}this._types=_11;this._fns=fns;this._object=_d;this._rendered=[];},{_clear:false,render:function(_13,_14){for(var i=0,_15;_15=this._types[i];i++){if(!this._clear&&!this._object){_14.getParent()[_15]=null;}var fn=this._fns[i];var _16;if(fn.indexOf(" ")!=-1){if(this._rendered[i]){_1.disconnect(this._rendered[i]);this._rendered[i]=false;}_16=_1.map(fn.split(" ").slice(1),function(_17){return new dd._Filter(_17).resolve(_13);});fn=fn.split(" ",2)[0];}if(!this._rendered[i]){if(!this._object){this._rendered[i]=_14.addEvent(_13,_15,fn,_16);}else{this._rendered[i]=_1.connect(this._object,_15,_13.getThis(),fn);}}}this._clear=true;return _14;},unrender:function(_18,_19){while(this._rendered.length){_1.disconnect(this._rendered.pop());}return _19;},clone:function(){return new this.constructor(this._command,this._object);}});function _1a(n1){var n2=n1.cloneNode(true);if(_1.isIE){_1.query("script",n2).forEach("item.text = this[index].text;",_1.query("script",n1));}return n2;};_2.DojoTypeNode=_1.extend(function(_1b,_1c){this._node=_1b;this._parsed=_1c;var _1d=_1b.getAttribute("dojoAttachEvent");if(_1d){this._events=new _2.EventNode(_1.trim(_1d));}var _1e=_1b.getAttribute("dojoAttachPoint");if(_1e){this._attach=new _2.AttachNode(_1.trim(_1e).split(/\s*,\s*/));}if(!_1c){this._dijit=_1.parser.instantiate([_1a(_1b)])[0];}else{_1b=_1a(_1b);var old=_2.widgetsInTemplate;_2.widgetsInTemplate=false;this._template=new dd.DomTemplate(_1b);_2.widgetsInTemplate=old;}},{render:function(_1f,_20){if(this._parsed){var _21=new dd.DomBuffer();this._template.render(_1f,_21);var _22=_1a(_21.getRootNode());var div=document.createElement("div");div.appendChild(_22);var _23=div.innerHTML;div.removeChild(_22);if(_23!=this._rendered){this._rendered=_23;if(this._dijit){this._dijit.destroyRecursive();}this._dijit=_1.parser.instantiate([_22])[0];}}var _24=this._dijit.domNode;if(this._events){this._events._object=this._dijit;this._events.render(_1f,_20);}if(this._attach){this._attach._object=this._dijit;this._attach.render(_1f,_20);}return _20.concat(_24);},unrender:function(_25,_26){return _26.remove(this._dijit.domNode);},clone:function(){return new this.constructor(this._node,this._parsed);}});_1.mixin(_2,{widgetsInTemplate:true,dojoAttachPoint:function(_27,_28){return new _2.AttachNode(_28.contents.slice(16).split(/\s*,\s*/));},dojoAttachEvent:function(_29,_2a){return new _2.EventNode(_2a.contents.slice(16));},dojoType:function(_2b,_2c){var _2d=false;if(_2c.contents.slice(-7)==" parsed"){_2d=true;}var _2e=_2c.contents.slice(9);var _2f=_2d?_2e.slice(0,-7):_2e.toString();if(_2.widgetsInTemplate){var _30=_2b.swallowNode();_30.setAttribute("dojoType",_2f);return new _2.DojoTypeNode(_30,_2d);}return new dd.AttributeNode("dojoType",_2f);},on:function(_31,_32){var _33=_32.contents.split();return new _2.EventNode(_33[0]+":"+_33.slice(1).join(" "));}});dd.register.tags("dojox.dtl.contrib",{"dijit":["attr:dojoType","attr:dojoAttachPoint",["attr:attach","dojoAttachPoint"],"attr:dojoAttachEvent",[/(attr:)?on(click|key(up))/i,"on"]]});return dojox.dtl.contrib.dijit;});