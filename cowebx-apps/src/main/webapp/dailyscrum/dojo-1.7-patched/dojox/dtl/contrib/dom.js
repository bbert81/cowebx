/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/lang","../_base","../dom","dojo/_base/html"],function(_1,dd){_1.getObject("dtl.contrib.dom",true,dojox);var _2=dd.contrib.dom;var _3={render:function(){return this.contents;}};_2.StyleNode=_1.extend(function(_4){this.contents={};this._current={};this._styles=_4;for(var _5 in _4){if(_4[_5].indexOf("{{")!=-1){var _6=new dd.Template(_4[_5]);}else{var _6=_1.delegate(_3);_6.contents=_4[_5];}this.contents[_5]=_6;}},{render:function(_7,_8){for(var _9 in this.contents){var _a=this.contents[_9].render(_7);if(this._current[_9]!=_a){_1.style(_8.getParent(),_9,this._current[_9]=_a);}}return _8;},unrender:function(_b,_c){this._current={};return _c;},clone:function(_d){return new this.constructor(this._styles);}});_2.BufferNode=_1.extend(function(_e,_f){this.nodelist=_e;this.options=_f;},{_swap:function(_10,_11){if(!this.swapped&&this.parent.parentNode){if(_10=="node"){if((_11.nodeType==3&&!this.options.text)||(_11.nodeType==1&&!this.options.node)){return;}}else{if(_10=="class"){if(_10!="class"){return;}}}this.onAddNode&&_1.disconnect(this.onAddNode);this.onRemoveNode&&_1.disconnect(this.onRemoveNode);this.onChangeAttribute&&_1.disconnect(this.onChangeAttribute);this.onChangeData&&_1.disconnect(this.onChangeData);this.swapped=this.parent.cloneNode(true);this.parent.parentNode.replaceChild(this.swapped,this.parent);}},render:function(_12,_13){this.parent=_13.getParent();if(this.options.node){this.onAddNode=_1.connect(_13,"onAddNode",_1.hitch(this,"_swap","node"));this.onRemoveNode=_1.connect(_13,"onRemoveNode",_1.hitch(this,"_swap","node"));}if(this.options.text){this.onChangeData=_1.connect(_13,"onChangeData",_1.hitch(this,"_swap","node"));}if(this.options["class"]){this.onChangeAttribute=_1.connect(_13,"onChangeAttribute",_1.hitch(this,"_swap","class"));}_13=this.nodelist.render(_12,_13);if(this.swapped){this.swapped.parentNode.replaceChild(this.parent,this.swapped);_1.destroy(this.swapped);}else{this.onAddNode&&_1.disconnect(this.onAddNode);this.onRemoveNode&&_1.disconnect(this.onRemoveNode);this.onChangeAttribute&&_1.disconnect(this.onChangeAttribute);this.onChangeData&&_1.disconnect(this.onChangeData);}delete this.parent;delete this.swapped;return _13;},unrender:function(_14,_15){return this.nodelist.unrender(_14,_15);},clone:function(_16){return new this.constructor(this.nodelist.clone(_16),this.options);}});_1.mixin(_2,{buffer:function(_17,_18){var _19=_18.contents.split().slice(1);var _1a={};var _1b=false;for(var i=_19.length;i--;){_1b=true;_1a[_19[i]]=true;}if(!_1b){_1a.node=true;}var _1c=_17.parse(["endbuffer"]);_17.next_token();return new _2.BufferNode(_1c,_1a);},html:function(_1d,_1e){_1.deprecated("{% html someVariable %}","Use {{ someVariable|safe }} instead");return _1d.create_variable_node(_1e.contents.slice(5)+"|safe");},style_:function(_1f,_20){var _21={};_20=_20.contents.replace(/^style\s+/,"");var _22=_20.split(/\s*;\s*/g);for(var i=0,_23;_23=_22[i];i++){var _24=_23.split(/\s*:\s*/g);var key=_24[0];var _25=_1.trim(_24[1]);if(_25){_21[key]=_25;}}return new _2.StyleNode(_21);}});dd.register.tags("dojox.dtl.contrib",{"dom":["html","attr:style","buffer"]});return dojox.dtl.contrib.dom;});