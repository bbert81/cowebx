/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/declare","../_base","dijit/_Templated","../_Templated","dojo/_base/html"],function(_1,dd,dt){return _1.declare("dojox.dtl._Templated",dt,{_dijitTemplateCompat:false,buildRendering:function(){var _2;if(this.domNode&&!this._template){return;}if(!this._template){var t=this.getCachedTemplate(this.templatePath,this.templateString,this._skipNodeCache);if(t instanceof dd.Template){this._template=t;}else{_2=t;}}if(!_2){var _3=new dd._Context(this);if(!this._created){delete _3._getter;}var _4=_1._toDom(this._template.render(_3));if(_4.nodeType!==1&&_4.nodeType!==3){for(var i=0,l=_4.childNodes.length;i<l;++i){_2=_4.childNodes[i];if(_2.nodeType==1){break;}}}else{_2=_4;}}this._attachTemplateNodes(_2);if(this.widgetsInTemplate){var _5=_1.parser,_6,_7;if(_5._query!="[dojoType]"){_6=_5._query;_7=_5._attrName;_5._query="[dojoType]";_5._attrName="dojoType";}var cw=(this._startupWidgets=_1.parser.parse(_2,{noStart:!this._earlyTemplatedStartup,inherited:{dir:this.dir,lang:this.lang}}));if(_6){_5._query=_6;_5._attrName=_7;}this._supportingWidgets=dijit.findWidgets(_2);this._attachTemplateNodes(cw,function(n,p){return n[p];});}if(this.domNode){_1.place(_2,this.domNode,"before");this.destroyDescendants();_1.destroy(this.domNode);}this.domNode=_2;this._fillContent(this.srcNodeRef);},_templateCache:{},getCachedTemplate:function(_8,_9,_a){var _b=this._templateCache;var _c=_9||_8;if(_b[_c]){return _b[_c];}_9=_1.string.trim(_9||_1.cache(_8,{sanitize:true}));if(this._dijitTemplateCompat&&(_a||_9.match(/\$\{([^\}]+)\}/g))){_9=this._stringRepl(_9);}if(_a||!_9.match(/\{[{%]([^\}]+)[%}]\}/g)){return _b[_c]=_1._toDom(_9);}else{return _b[_c]=new dd.Template(_9);}},render:function(){this.buildRendering();},startup:function(){_1.forEach(this._startupWidgets,function(w){if(w&&!w._started&&w.startup){w.startup();}});this.inherited(arguments);}});});