/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/mobile/app/SceneAssistant"],function(_1,_2,_3){_1.getObject("dojox.mobile.tests.imageControlsApp.app.assistants.flickr-image-thumb-view-assistant",1);_1.declare("FlickrImageThumbViewAssistant",_3.mobile.app.SceneAssistant,{apiKey:"8c6803164dbc395fb7131c9d54843627",setup:function(){this.controller.parse();this.handlePhotoLoad=_1.hitch(this,this.handlePhotoLoad);this.search=_1.hitch(this,this.search);this.resizeViewer=_1.hitch(this,this.resizeViewer);this.textWidget=_2.byId("searchTextThumbInput");var _4=this.viewer=_2.byId("flickrImageThumbView");_4.labelParam="ownername";var _5=this;this.connect(_4,"onSelect",function(_6,_7){_5.controller.stageController.pushScene("flickr-image-view",{type:"data",images:_5.urls,index:_7});});this.connect(this.textWidget,"onChange",function(_8){if(!_8||_8.length==0){_5.viewer.set("items",[]);return;}if(!_5.timer){_5.timer=setTimeout(_5.search,1000);}});this.connect(_2.byId("btnSmall"),"onClick",function(_9){_5.setThumbSize("small");});this.connect(_2.byId("btnMedium"),"onClick",function(_a){_5.setThumbSize("medium");});this.connect(_2.byId("btnLarge"),"onClick",function(_b){_5.setThumbSize("large");});var _c;this.connect(window,"resize",function(_d){if(_c){clearTimeout(_c);}_c=setTimeout(_5.resizeViewer,300);});},activate:function(_e){if(!this.dataType){this.dataType=(_e?_e.type:"interesting");switch(this.dataType){case "interesting":_1.style(this.textWidget.domNode,"display","none");this.loadInteresting();break;case "text":_1.style(this.textWidget.domNode,"visibility","visible");this.loadText(this.textWidget.set("value"));break;case "tag":_1.style(this.textWidget.domNode,"visibility","visible");this.loadTags(this.textWidget.set("value"));break;default:undefined;}}},setThumbSize:function(_f){_1.removeClass(this.viewer.domNode,["small","medium","large"]);_1.addClass(this.viewer.domNode,_f);this.resizeViewer();},resizeViewer:function(){this.viewer.resize();},search:function(){if(this.timer){clearTimeout(this.timer);this.timer=null;}var _10=this.textWidget.set("value");if(!_10||_1.trim(_10).length<1){this.viewer.set("items",[]);return;}switch(this.dataType){case "text":this.loadText(_10);break;case "tag":this.loadTags(_10);break;}},loadInteresting:function(){var _11=this;var url="http://api.flickr.com/services/rest/?method="+"flickr.interestingness.getList";var _12=_1.io.script.get({url:url,content:{api_key:this.apiKey,format:"json",per_page:20},jsonp:"jsoncallback"});_12.addBoth(this.handlePhotoLoad);},loadText:function(_13){var _14=this;var url="http://api.flickr.com/services/rest/?method="+"flickr.photos.search";var _15=_1.io.script.get({url:url,content:{api_key:this.apiKey,format:"json",text:_13,extras:"owner_name",per_page:20},jsonp:"jsoncallback"});_15.addBoth(this.handlePhotoLoad);},loadTags:function(_16){var _17=this;var url="http://api.flickr.com/services/rest/?method="+"flickr.photos.search";var _18=_1.io.script.get({url:url,content:{api_key:this.apiKey,format:"json",tags:_16,per_page:20},jsonp:"jsoncallback"});_18.addBoth(this.handlePhotoLoad);},handlePhotoLoad:function(res){if(res&&res.photos&&res.photos.photo){var _19=this.images=res.photos.photo;var _1a=[];var _1b;for(var i=0;i<_19.length;i++){_1b="http://farm"+_19[i].farm+".static.flickr.com/"+_19[i].server+"/"+_19[i].id+"_"+_19[i].secret;_1a.push({large:_1b+".jpg",small:_1b+"_t.jpg",thumb:_1b+"_s.jpg",ownername:_19[i].ownername,title:_19[i].title});}this.urls=_1a;this.index=0;this.viewer.set("selectedIndex",this.index);this.viewer.set("items",_1a);}else{this.viewer.set("items",[]);}}});});require(["dojox/mobile/tests/imageControlsApp/app/assistants/flickr-image-thumb-view-assistant"]);