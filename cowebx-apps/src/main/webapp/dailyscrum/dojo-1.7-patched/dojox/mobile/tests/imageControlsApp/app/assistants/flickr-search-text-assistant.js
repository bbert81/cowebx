/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/mobile/app/SceneAssistant"],function(_1,_2,_3){_1.getObject("dojox.mobile.tests.imageControlsApp.app.assistants.flickr-search-text-assistant",1);_1.declare("FlickrSearchTextAssistant",_3.mobile.app.SceneAssistant,{setup:function(){this.controller.parse();this.apiKey="8c6803164dbc395fb7131c9d54843627";this.listWidget=_2.byId("searchList");this.textWidget=_2.byId("searchTextInput");this.listWidget.set("items",[]);var _4=this;this.search=_1.hitch(this,this.search);this.handleGroupResults=_1.hitch(this,this.handleGroupResults);this.connect(this.textWidget,"onChange",function(_5){if(!_5||_5.length==0){_4.listWidget.set("items",[]);return;}if(!_4.timer){_4.timer=setTimeout(_4.search,300);}});this.connect(this.listWidget,"onSelect",function(_6,_7,_8){_4.controller.stageController.pushScene("flickr-image-view",_1.mixin({type:"group"},_6));});},activate:function(_9){this.searchType=_9;if(_9){var _a=_2.byId("searchHeader");switch(_9){case "group":_a.setLabel("Search Flickr Groups");break;case "user":_a.setLabel("Search Flickr People");break;case "tag":_a.setLabel("Search Flickr Tags");break;}}_2.byId("searchTextInput").focus();},search:function(){if(this.timer){clearTimeout(this.timer);this.timer=null;}var _b=this.textWidget.set("value");if(!_b||_1.trim(_b).length<1){this.listWidget.set("items",[]);return;}var _c="http://api.flickr.com/services/rest/?method=flickr.groups.search";var _d=_1.io.script.get({url:_c,content:{api_key:this.apiKey,format:"json",text:_b,perPage:10},jsonp:"jsoncallback"});_d.addBoth(this.handleGroupResults);},handleGroupResults:function(_e){var _f;if(_e&&_e.groups&&_e.groups.group){_f=_e.groups.group;for(var i=0;i<_f.length;i++){_f[i].label=_f[i].name;}}else{_f=[];}this.listWidget.set("items",_f);}});});require(["dojox/mobile/tests/imageControlsApp/app/assistants/flickr-search-text-assistant"]);