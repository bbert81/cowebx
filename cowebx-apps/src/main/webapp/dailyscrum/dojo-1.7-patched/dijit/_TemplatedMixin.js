/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/kernel",".","./_WidgetBase","dojo/string","dojo/cache","dojo/_base/array","dojo/_base/declare","dojo/_base/html","dojo/_base/lang","dojo/_base/sniff","dojo/_base/unload","dojo/_base/window","dojo/text"],function(_1,_2){_1.declare("dijit._TemplatedMixin",null,{templateString:null,templatePath:null,_skipNodeCache:false,_earlyTemplatedStartup:false,constructor:function(){this._attachPoints=[];this._attachEvents=[];},_stringRepl:function(_3){var _4=this.declaredClass,_5=this;return _1.string.substitute(_3,this,function(_6,_7){if(_7.charAt(0)=="!"){_6=_1.getObject(_7.substr(1),false,_5);}if(typeof _6=="undefined"){throw new Error(_4+" template:"+_7);}if(_6==null){return "";}return _7.charAt(0)=="!"?_6:_6.toString().replace(/"/g,"&quot;");},this);},buildRendering:function(){if(!this.templateString){this.templateString=_1.cache(this.templatePath,{sanitize:true});}var _8=_2._TemplatedMixin.getCachedTemplate(this.templateString,this._skipNodeCache);var _9;if(_1.isString(_8)){_9=_1._toDom(this._stringRepl(_8));if(_9.nodeType!=1){throw new Error("Invalid template: "+_8);}}else{_9=_8.cloneNode(true);}this.domNode=_9;this.inherited(arguments);this._attachTemplateNodes(_9,function(n,p){return n.getAttribute(p);});this._beforeFillContent();this._fillContent(this.srcNodeRef);},_beforeFillContent:function(){},_fillContent:function(_a){var _b=this.containerNode;if(_a&&_b){while(_a.hasChildNodes()){_b.appendChild(_a.firstChild);}}},_attachTemplateNodes:function(_c,_d){var _e=_1.isArray(_c)?_c:(_c.all||_c.getElementsByTagName("*"));var x=_1.isArray(_c)?0:-1;for(;x<_e.length;x++){var _f=(x==-1)?_c:_e[x];if(this.widgetsInTemplate&&(_d(_f,"dojoType")||_d(_f,"data-dojo-type"))){continue;}var _10=_d(_f,"dojoAttachPoint")||_d(_f,"data-dojo-attach-point");if(_10){var _11,_12=_10.split(/\s*,\s*/);while((_11=_12.shift())){if(_1.isArray(this[_11])){this[_11].push(_f);}else{this[_11]=_f;}this._attachPoints.push(_11);}}var _13=_d(_f,"dojoAttachEvent")||_d(_f,"data-dojo-attach-event");if(_13){var _14,_15=_13.split(/\s*,\s*/);var _16=_1.trim;while((_14=_15.shift())){if(_14){var _17=null;if(_14.indexOf(":")!=-1){var _18=_14.split(":");_14=_16(_18[0]);_17=_16(_18[1]);}else{_14=_16(_14);}if(!_17){_17=_14;}this._attachEvents.push(this.connect(_f,_14,_17));}}}}},destroyRendering:function(){_1.forEach(this._attachPoints,function(_19){delete this[_19];},this);this._attachPoints=[];_1.forEach(this._attachEvents,this.disconnect,this);this._attachEvents=[];this.inherited(arguments);}});_2._TemplatedMixin._templateCache={};_2._TemplatedMixin.getCachedTemplate=function(_1a,_1b){var _1c=_2._TemplatedMixin._templateCache;var key=_1a;var _1d=_1c[key];if(_1d){try{if(!_1d.ownerDocument||_1d.ownerDocument==_1.doc){return _1d;}}catch(e){}_1.destroy(_1d);}_1a=_1.string.trim(_1a);if(_1b||_1a.match(/\$\{([^\}]+)\}/g)){return (_1c[key]=_1a);}else{var _1e=_1._toDom(_1a);if(_1e.nodeType!=1){throw new Error("Invalid template: "+_1a);}return (_1c[key]=_1e);}};if(_1.isIE){_1.addOnWindowUnload(function(){var _1f=_2._TemplatedMixin._templateCache;for(var key in _1f){var _20=_1f[key];if(typeof _20=="object"){_1.destroy(_20);}delete _1f[key];}});}_1.extend(_2._WidgetBase,{dojoAttachEvent:"",dojoAttachPoint:""});return _2._TemplatedMixin;});