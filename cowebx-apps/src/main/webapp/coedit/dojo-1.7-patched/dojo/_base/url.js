/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["./kernel","require"],function(_1, require){var _2=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),_3=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");_1._Url=function(){var n=null,_4=arguments,_5=[_4[0]];for(var i=1;i<_4.length;i++){if(!_4[i]){continue;}var _6=new _1._Url(_4[i]+""),_7=new _1._Url(_5[0]+"");if(_6.path==""&&!_6.scheme&&!_6.authority&&!_6.query){if(_6.fragment!=n){_7.fragment=_6.fragment;}_6=_7;}else{if(!_6.scheme){_6.scheme=_7.scheme;if(!_6.authority){_6.authority=_7.authority;if(_6.path.charAt(0)!="/"){var _8=_7.path.substring(0,_7.path.lastIndexOf("/")+1)+_6.path;var _9=_8.split("/");for(var j=0;j<_9.length;j++){if(_9[j]=="."){if(j==_9.length-1){_9[j]="";}else{_9.splice(j,1);j--;}}else{if(j>0&&!(j==1&&_9[0]=="")&&_9[j]==".."&&_9[j-1]!=".."){if(j==(_9.length-1)){_9.splice(j,1);_9[j-1]="";}else{_9.splice(j-1,2);j-=2;}}}}_6.path=_9.join("/");}}}}_5=[];if(_6.scheme){_5.push(_6.scheme,":");}if(_6.authority){_5.push("//",_6.authority);}_5.push(_6.path);if(_6.query){_5.push("?",_6.query);}if(_6.fragment){_5.push("#",_6.fragment);}}this.uri=_5.join("");var r=this.uri.match(_2);this.scheme=r[2]||(r[1]?"":n);this.authority=r[4]||(r[3]?"":n);this.path=r[5];this.query=r[7]||(r[6]?"":n);this.fragment=r[9]||(r[8]?"":n);if(this.authority!=n){r=this.authority.match(_3);this.user=r[3]||n;this.password=r[4]||n;this.host=r[6]||r[7];this.port=r[9]||n;}};_1._Url.prototype.toString=function(){return this.uri;};_1.moduleUrl=function(_a,_b){if(!_a){return null;}_a=_a.replace(/\./g,"/")+(_b?("/"+_b):"");var _c="",_d=_a.match(/(.+)(\.[^\/]*?)$/);if(_d){_a=_d[1];_c=_d[2];}return new _1._Url(require.nameToUrl(_a,_c));};});