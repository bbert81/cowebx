/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/lang","dojo/_base/declare","dojo/query","dijit/_Widget","../Chart","dojox/lang/utils","dojox/lang/functional"],function(_1,_2,_3,_4,_5,du,df){var _6,_7,_8,_9,_a,_b=function(o){return o;},dc=dojox.charting,d=_1;_1.declare("dojox.charting.widget.Chart",dijit._Widget,{theme:null,margins:null,stroke:undefined,fill:undefined,buildRendering:function(){this.inherited(arguments);n=this.domNode;var _c=d.query("> .axis",n).map(_7).filter(_b),_d=d.query("> .plot",n).map(_8).filter(_b),_e=d.query("> .action",n).map(_9).filter(_b),_f=d.query("> .series",n).map(_a).filter(_b);n.innerHTML="";var c=this.chart=new _5(n,{margins:this.margins,stroke:this.stroke,fill:this.fill,textDir:this.textDir});if(this.theme){c.setTheme(this.theme);}_c.forEach(function(_10){c.addAxis(_10.name,_10.kwArgs);});_d.forEach(function(_11){c.addPlot(_11.name,_11.kwArgs);});this.actions=_e.map(function(_12){return new _12.action(c,_12.plot,_12.kwArgs);});var _13=df.foldl(_f,function(_14,_15){if(_15.type=="data"){c.addSeries(_15.name,_15.data,_15.kwArgs);_14=true;}else{c.addSeries(_15.name,[0],_15.kwArgs);var kw={};du.updateWithPattern(kw,_15.kwArgs,{"query":"","queryOptions":null,"start":0,"count":1},true);if(_15.kwArgs.sort){kw.sort=_1.clone(_15.kwArgs.sort);}d.mixin(kw,{onComplete:function(_16){var _17;if("valueFn" in _15.kwArgs){var fn=_15.kwArgs.valueFn;_17=d.map(_16,function(x){return fn(_15.data.getValue(x,_15.field,0));});}else{_17=d.map(_16,function(x){return _15.data.getValue(x,_15.field,0);});}c.addSeries(_15.name,_17,_15.kwArgs).render();}});_15.data.fetch(kw);}return _14;},false);if(_13){c.render();}},destroy:function(){this.chart.destroy();this.inherited(arguments);},resize:function(box){this.chart.resize(box);}});_6=function(_18,_19,kw){var dp=eval("("+_19+".prototype.defaultParams)");var x,_1a;for(x in dp){if(x in kw){continue;}_1a=_18.getAttribute(x);kw[x]=du.coerceType(dp[x],_1a==null||typeof _1a=="undefined"?dp[x]:_1a);}var op=eval("("+_19+".prototype.optionalParams)");for(x in op){if(x in kw){continue;}_1a=_18.getAttribute(x);if(_1a!=null){kw[x]=du.coerceType(op[x],_1a);}}};_7=function(_1b){var _1c=_1b.getAttribute("name"),_1d=_1b.getAttribute("type");if(!_1c){return null;}var o={name:_1c,kwArgs:{}},kw=o.kwArgs;if(_1d){if(dc.axis2d[_1d]){_1d=dojox._scopeName+".charting.axis2d."+_1d;}var _1e=eval("("+_1d+")");if(_1e){kw.type=_1e;}}else{_1d=dojox._scopeName+".charting.axis2d.Default";}_6(_1b,_1d,kw);if(kw.font||kw.fontColor){if(!kw.tick){kw.tick={};}if(kw.font){kw.tick.font=kw.font;}if(kw.fontColor){kw.tick.fontColor=kw.fontColor;}}return o;};_8=function(_1f){var _20=_1f.getAttribute("name"),_21=_1f.getAttribute("type");if(!_20){return null;}var o={name:_20,kwArgs:{}},kw=o.kwArgs;if(_21){if(dc.plot2d&&dc.plot2d[_21]){_21=dojox._scopeName+".charting.plot2d."+_21;}var _22=eval("("+_21+")");if(_22){kw.type=_22;}}else{_21=dojox._scopeName+".charting.plot2d.Default";}_6(_1f,_21,kw);return o;};_9=function(_23){var _24=_23.getAttribute("plot"),_25=_23.getAttribute("type");if(!_24){_24="default";}var o={plot:_24,kwArgs:{}},kw=o.kwArgs;if(_25){if(dc.action2d[_25]){_25=dojox._scopeName+".charting.action2d."+_25;}var _26=eval("("+_25+")");if(!_26){return null;}o.action=_26;}else{return null;}_6(_23,_25,kw);return o;};_a=function(_27){var ga=d.partial(d.attr,_27);var _28=ga("name");if(!_28){return null;}var o={name:_28,kwArgs:{}},kw=o.kwArgs,t;t=ga("plot");if(t!=null){kw.plot=t;}t=ga("marker");if(t!=null){kw.marker=t;}t=ga("stroke");if(t!=null){kw.stroke=eval("("+t+")");}t=ga("outline");if(t!=null){kw.outline=eval("("+t+")");}t=ga("shadow");if(t!=null){kw.shadow=eval("("+t+")");}t=ga("fill");if(t!=null){kw.fill=eval("("+t+")");}t=ga("font");if(t!=null){kw.font=t;}t=ga("fontColor");if(t!=null){kw.fontColor=eval("("+t+")");}t=ga("legend");if(t!=null){kw.legend=t;}t=ga("data");if(t!=null){o.type="data";o.data=t?_1.map(String(t).split(","),Number):[];return o;}t=ga("array");if(t!=null){o.type="data";o.data=eval("("+t+")");return o;}t=ga("store");if(t!=null){o.type="store";o.data=eval("("+t+")");t=ga("field");o.field=t!=null?t:"value";t=ga("query");if(!!t){kw.query=t;}t=ga("queryOptions");if(!!t){kw.queryOptions=eval("("+t+")");}t=ga("start");if(!!t){kw.start=Number(t);}t=ga("count");if(!!t){kw.count=Number(t);}t=ga("sort");if(!!t){kw.sort=eval("("+t+")");}t=ga("valueFn");if(!!t){kw.valueFn=df.lambda(t);}return o;}return null;};return dojox.charting.widget.Chart;});