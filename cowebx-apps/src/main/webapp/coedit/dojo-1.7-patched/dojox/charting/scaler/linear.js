/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["../..","dojo/_base/lang","./common"],function(_1,_2,_3){var _4=_2.getObject("charting.scaler.linear",true,_1);var _5=3,_6=_3.findString,_7=_3.getNumericLabel;var _8=function(_9,_a,_b,_c,_d,_e,_f){_b=_2.delegate(_b);if(!_c){if(_b.fixUpper=="major"){_b.fixUpper="minor";}if(_b.fixLower=="major"){_b.fixLower="minor";}}if(!_d){if(_b.fixUpper=="minor"){_b.fixUpper="micro";}if(_b.fixLower=="minor"){_b.fixLower="micro";}}if(!_e){if(_b.fixUpper=="micro"){_b.fixUpper="none";}if(_b.fixLower=="micro"){_b.fixLower="none";}}var _10=_6(_b.fixLower,["major"])?Math.floor(_b.min/_c)*_c:_6(_b.fixLower,["minor"])?Math.floor(_b.min/_d)*_d:_6(_b.fixLower,["micro"])?Math.floor(_b.min/_e)*_e:_b.min,_11=_6(_b.fixUpper,["major"])?Math.ceil(_b.max/_c)*_c:_6(_b.fixUpper,["minor"])?Math.ceil(_b.max/_d)*_d:_6(_b.fixUpper,["micro"])?Math.ceil(_b.max/_e)*_e:_b.max;if(_b.useMin){_9=_10;}if(_b.useMax){_a=_11;}var _12=(!_c||_b.useMin&&_6(_b.fixLower,["major"]))?_9:Math.ceil(_9/_c)*_c,_13=(!_d||_b.useMin&&_6(_b.fixLower,["major","minor"]))?_9:Math.ceil(_9/_d)*_d,_14=(!_e||_b.useMin&&_6(_b.fixLower,["major","minor","micro"]))?_9:Math.ceil(_9/_e)*_e,_15=!_c?0:(_b.useMax&&_6(_b.fixUpper,["major"])?Math.round((_a-_12)/_c):Math.floor((_a-_12)/_c))+1,_16=!_d?0:(_b.useMax&&_6(_b.fixUpper,["major","minor"])?Math.round((_a-_13)/_d):Math.floor((_a-_13)/_d))+1,_17=!_e?0:(_b.useMax&&_6(_b.fixUpper,["major","minor","micro"])?Math.round((_a-_14)/_e):Math.floor((_a-_14)/_e))+1,_18=_d?Math.round(_c/_d):0,_19=_e?Math.round(_d/_e):0,_1a=_c?Math.floor(Math.log(_c)/Math.LN10):0,_1b=_d?Math.floor(Math.log(_d)/Math.LN10):0,_1c=_f/(_a-_9);if(!isFinite(_1c)){_1c=1;}return {bounds:{lower:_10,upper:_11,from:_9,to:_a,scale:_1c,span:_f},major:{tick:_c,start:_12,count:_15,prec:_1a},minor:{tick:_d,start:_13,count:_16,prec:_1b},micro:{tick:_e,start:_14,count:_17,prec:0},minorPerMajor:_18,microPerMinor:_19,scaler:_4};};return _2.mixin(_4,{buildScaler:function(min,max,_1d,_1e){var h={fixUpper:"none",fixLower:"none",natural:false};if(_1e){if("fixUpper" in _1e){h.fixUpper=String(_1e.fixUpper);}if("fixLower" in _1e){h.fixLower=String(_1e.fixLower);}if("natural" in _1e){h.natural=Boolean(_1e.natural);}}if("min" in _1e){min=_1e.min;}if("max" in _1e){max=_1e.max;}if(_1e.includeZero){if(min>0){min=0;}if(max<0){max=0;}}h.min=min;h.useMin=true;h.max=max;h.useMax=true;if("from" in _1e){min=_1e.from;h.useMin=false;}if("to" in _1e){max=_1e.to;h.useMax=false;}if(max<=min){return _8(min,max,h,0,0,0,_1d);}var mag=Math.floor(Math.log(max-min)/Math.LN10),_1f=_1e&&("majorTickStep" in _1e)?_1e.majorTickStep:Math.pow(10,mag),_20=0,_21=0,_22;if(_1e&&("minorTickStep" in _1e)){_20=_1e.minorTickStep;}else{do{_20=_1f/10;if(!h.natural||_20>0.9){_22=_8(min,max,h,_1f,_20,0,_1d);if(_22.bounds.scale*_22.minor.tick>_5){break;}}_20=_1f/5;if(!h.natural||_20>0.9){_22=_8(min,max,h,_1f,_20,0,_1d);if(_22.bounds.scale*_22.minor.tick>_5){break;}}_20=_1f/2;if(!h.natural||_20>0.9){_22=_8(min,max,h,_1f,_20,0,_1d);if(_22.bounds.scale*_22.minor.tick>_5){break;}}return _8(min,max,h,_1f,0,0,_1d);}while(false);}if(_1e&&("microTickStep" in _1e)){_21=_1e.microTickStep;_22=_8(min,max,h,_1f,_20,_21,_1d);}else{do{_21=_20/10;if(!h.natural||_21>0.9){_22=_8(min,max,h,_1f,_20,_21,_1d);if(_22.bounds.scale*_22.micro.tick>_5){break;}}_21=_20/5;if(!h.natural||_21>0.9){_22=_8(min,max,h,_1f,_20,_21,_1d);if(_22.bounds.scale*_22.micro.tick>_5){break;}}_21=_20/2;if(!h.natural||_21>0.9){_22=_8(min,max,h,_1f,_20,_21,_1d);if(_22.bounds.scale*_22.micro.tick>_5){break;}}_21=0;}while(false);}return _21?_22:_8(min,max,h,_1f,_20,0,_1d);},buildTicks:function(_23,_24){var _25,_26,_27,_28=_23.major.start,_29=_23.minor.start,_2a=_23.micro.start;if(_24.microTicks&&_23.micro.tick){_25=_23.micro.tick,_26=_2a;}else{if(_24.minorTicks&&_23.minor.tick){_25=_23.minor.tick,_26=_29;}else{if(_23.major.tick){_25=_23.major.tick,_26=_28;}else{return null;}}}var _2b=1/_23.bounds.scale;if(_23.bounds.to<=_23.bounds.from||isNaN(_2b)||!isFinite(_2b)||_25<=0||isNaN(_25)||!isFinite(_25)){return null;}var _2c=[],_2d=[],_2e=[];while(_26<=_23.bounds.to+_2b){if(Math.abs(_28-_26)<_25/2){_27={value:_28};if(_24.majorLabels){_27.label=_7(_28,_23.major.prec,_24);}_2c.push(_27);_28+=_23.major.tick;_29+=_23.minor.tick;_2a+=_23.micro.tick;}else{if(Math.abs(_29-_26)<_25/2){if(_24.minorTicks){_27={value:_29};if(_24.minorLabels&&(_23.minMinorStep<=_23.minor.tick*_23.bounds.scale)){_27.label=_7(_29,_23.minor.prec,_24);}_2d.push(_27);}_29+=_23.minor.tick;_2a+=_23.micro.tick;}else{if(_24.microTicks){_2e.push({value:_2a});}_2a+=_23.micro.tick;}}_26+=_25;}return {major:_2c,minor:_2d,micro:_2e};},getTransformerFromModel:function(_2f){var _30=_2f.bounds.from,_31=_2f.bounds.scale;return function(x){return (x-_30)*_31;};},getTransformerFromPlot:function(_32){var _33=_32.bounds.from,_34=_32.bounds.scale;return function(x){return x/_34+_33;};}});});