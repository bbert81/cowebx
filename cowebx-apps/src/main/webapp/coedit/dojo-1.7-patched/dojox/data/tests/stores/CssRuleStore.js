/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/data/CssRuleStore","dojo/data/api/Read","dojo/data/api/Identity"],function(_1,_2,_3){_1.getObject("dojox.data.tests.stores.CssRuleStore",1);_3.data.tests.stores.CssRuleStore.createStore=function(_4){var _5=null;if(_1.isBrowser){if(!_3.data.tests.stores.CssRuleStore._loaded){var _6=_1.doc.getElementsByTagName("head")[0];var _7=document.createElement("link");_7.href=_1.moduleUrl("dojox.data.tests.stores","test1.css").toString();_7.rel="stylesheet";_7.type="text/css";_6.appendChild(_7);var _8;var _9;if(_1.isIE){_8=document.createStyleSheet();_8.cssText="@import \""+_1.moduleUrl("dojox.data.tests.stores","test2.css").toString()+"\";";}else{_8=document.createElement("style");_9=document.createTextNode("@import \""+_1.moduleUrl("dojox.data.tests.stores","test2.css").toString()+"\";");_8.appendChild(_9);_6.appendChild(_8);}if(_1.isIE){_8=document.createStyleSheet();_8.cssText=".embeddedTestClass { text-align: center; }";}else{_8=document.createElement("style");_9=document.createTextNode(".embeddedTestClass { text-align: center; }");_8.appendChild(_9);_6.appendChild(_8);}_3.data.tests.stores.CssRuleStore._loaded=true;}_5=new _3.data.CssRuleStore({context:_4});}else{}return _5;};_3.data.tests.stores.CssRuleStore.verifyItems=function(_a,_b,_c,_d){if(_b.length!=_d.length){return false;}for(var i=0;i<_b.length;i++){if(!(_a.getValue(_b[i],_c)===(_1.isWebKit?_d[i].toLowerCase():_d[i]))){return false;}}return true;};_3.data.tests.stores.CssRuleStore.error=function(t,d,_e){for(var i in _e){}d.errback(_e);};doh.register("dojox.data.tests.stores.CssRuleStore",[{name:"testReadAPI_fetch",timeout:10000,runTest:function(t){var _f=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _10(_11){t.assertTrue(_11.length===3);d.callback(true);};_f.fetch({query:{"selector":"*TestClass"},onComplete:_10,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;}},function testReadAPI_fetch_all(t){var _12=_3.data.tests.stores.CssRuleStore.createStore(["dojox/data/tests/stores/test1.css","dojox/data/tests/stores/test2.css"]);var d=new doh.Deferred();function _13(_14){t.assertTrue(_14.length===3);d.callback(true);};_12.fetch({onComplete:_13,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_withinContext(t){var _15=_3.data.tests.stores.CssRuleStore.createStore(["dojox/data/tests/stores/test1.css"]);var d=new doh.Deferred();function _16(_17){t.assertTrue(_17.length===1);d.callback(true);};_15.fetch({query:{"selector":"*TestClass"},onComplete:_16,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_withinMultipleSheetContext(t){var _18=_3.data.tests.stores.CssRuleStore.createStore(["dojox/data/tests/stores/test1.css","dojox/data/tests/stores/test2.css"]);var d=new doh.Deferred();function _19(_1a){t.assertTrue(_1a.length===2);d.callback(true);};_18.fetch({query:{"selector":"*TestClass"},onComplete:_19,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_switchContext(t){var _1b=_3.data.tests.stores.CssRuleStore.createStore(["dojox/data/tests/stores/test1.css","dojox/data/tests/stores/test2.css"]);var d=new doh.Deferred();function _1c(_1d){t.assertTrue(_1d.length===2);function _1e(_1f){t.assertTrue(_1f.length===1);d.callback(true);};_1b.setContext(["dojox/data/tests/stores/test1.css"]);_1b.fetch({query:{"selector":"*TestClass"},onComplete:_1e,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});};_1b.fetch({query:{"selector":"*TestClass"},onComplete:_1c,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_one(t){var _20=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _21(_22,_23){t.is(1,_22.length);d.callback(true);};_20.fetch({query:{"selector":".linkTestClass"},onComplete:_21,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_one_longer(t){var _24=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _25(_26,_27){t.is(1,_26.length);d.callback(true);};_24.fetch({query:{"selector":".linkTestClass .test"},onComplete:_25,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_Multiple(t){var _28=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();var _29=[false,false];function _2a(_2b,_2c){_29[0]=true;t.is(1,_2b.length);if(_29[0]&&_29[1]){d.callback(true);}};function _2d(_2e,_2f){_29[1]=true;t.is(1,_2e.length);if(_29[0]&&_29[1]){d.callback(true);}};try{_28.fetch({query:{"selector":".embeddedTestClass"},onComplete:_2a,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});_28.fetch({query:{"selector":".linkTestClass"},onComplete:_2d,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});}catch(e){for(var i in e){}}return d;},function testReadAPI_fetch_MultipleMixed(t){var _30=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();var _31=[false,false];function _32(_33,_34){_31[0]=true;t.is(1,_33.length);if(_1.isWebKit){t.is(".embeddedtestclass",_30.getValue(_33[0],"selector"));}else{t.is(".embeddedTestClass",_30.getValue(_33[0],"selector"));}if(_31[0]&&_31[1]){d.callback(true);}};function _35(_36){_31[1]=true;t.assertTrue(_36!==null);if(_1.isWebKit){t.is(".linktestclass .test",_30.getValue(_36,"selector"));}else{t.is(".linkTestClass .test",_30.getValue(_36,"selector"));}if(_31[0]&&_31[1]){d.callback(true);}};_30.fetch({query:{"selector":".embeddedTestClass"},onComplete:_32,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});_30.fetch({query:{"selector":".linkTestClass .test"},onItem:_35,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_all_streaming(t){var _37=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();var _38=0;function _39(_3a,_3b){t.assertTrue(_3a===3);};function _3c(_3d,_3e){t.assertTrue(_37.isItem(_3d));_38++;};function _3f(_40,_41){t.is(3,_38);t.is(null,_40);d.callback(true);};_37.fetch({query:{"selector":"*TestClass"},onBegin:_39,onItem:_3c,onComplete:_3f,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_paging(t){var _42=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _43(_44,_45){t.is(2,_44.length);d.callback(true);};function _46(_47,_48){t.is(1,_47.length);if(_1.isWebKit){t.is(".embeddedtestclass",_42.getValue(_47[0],"selector"));}else{t.is(".embeddedTestClass",_42.getValue(_47[0],"selector"));}_48.start=0;_48.count=2;_48.onComplete=_43;_42.fetch(_48);};function _49(_4a,_4b){t.is(3,_4a.length);_4b.start=2;_4b.count=1;_4b.onComplete=_46;_42.fetch(_4b);};_42.fetch({query:{"selector":"*TestClass"},onComplete:_49,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_getLabel(t){var _4c=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _4d(_4e,_4f){t.assertEqual(_4e.length,1);var _50=_4c.getLabel(_4e[0]);t.assertTrue(_50!==null);if(_1.isWebKit){t.assertEqual(".linktestclass",_50);}else{t.assertEqual(".linkTestClass",_50);}d.callback(true);};_4c.fetch({query:{"selector":".linkTestClass"},onComplete:_4d,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_getLabelAttributes(t){var _51=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _52(_53,_54){t.assertEqual(_53.length,1);var _55=_51.getLabelAttributes(_53[0]);t.assertTrue(_1.isArray(_55));t.assertEqual("selector",_55[0]);d.callback(true);};_51.fetch({query:{"selector":".linkTestClass"},onComplete:_52,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_getValue(t){var _56=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _57(_58){t.assertTrue(_58!==null);if(_1.isWebKit){t.is(".linktestclass",_56.getValue(_58,"selector"));}else{t.is(".linkTestClass",_56.getValue(_58,"selector"));}t.assertTrue(_56.getValue(_58,"parentStyleSheetHref").match("dojox/data/tests/stores/test1.css"));d.callback(true);};_56.fetch({query:{"selector":".linkTestClass"},onItem:_57,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_getValue_2(t){var _59=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _5a(_5b){t.assertTrue(_5b!==null);if(_1.isWebKit){t.is(".importtestclass",_59.getValue(_5b,"selector"));}else{t.is(".importTestClass",_59.getValue(_5b,"selector"));}t.assertTrue(_59.getValue(_5b,"parentStyleSheetHref").match("dojox/data/tests/stores/test2.css"));d.callback(true);};_59.fetch({query:{"selector":".importTestClass"},onItem:_5a,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_getValues(t){var _5c=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _5d(_5e){t.assertTrue(_5e!==null);var _5f=_5c.getValues(_5e,"selector");t.assertTrue(_1.isArray(_5f));t.is(1,_5f.length);if(_1.isWebKit){t.is(".embeddedtestclass",_5f[0]);}else{t.is(".embeddedTestClass",_5f[0]);}d.callback(true);};_5c.fetch({query:{"selector":".embeddedTestClass"},onItem:_5d,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_isItem(t){var _60=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _61(_62){t.assertTrue(_60.isItem(_62));t.assertTrue(!_60.isItem({}));t.assertTrue(!_60.isItem({item:"not an item"}));t.assertTrue(!_60.isItem("not an item"));t.assertTrue(!_60.isItem(["not an item"]));d.callback(true);};_60.fetch({query:{"selector":".embeddedTestClass"},onItem:_61,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_hasAttribute(t){var _63=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _64(_65){t.assertTrue(_65!==null);t.assertTrue(_63.hasAttribute(_65,"selector"));t.assertTrue(_63.hasAttribute(_65,"classes"));t.assertTrue(!_63.hasAttribute(_65,"Year"));t.assertTrue(!_63.hasAttribute(_65,"Nothing"));t.assertTrue(!_63.hasAttribute(_65,"title"));var _66=false;try{_63.hasAttribute(_65,null);}catch(e){_66=true;}t.assertTrue(_66);d.callback(true);};_63.fetch({query:{"selector":".embeddedTestClass"},onItem:_64,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_containsValue(t){var _67=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _68(_69){t.assertTrue(_69!==null);if(_1.isWebKit){t.assertTrue(_67.containsValue(_69,"selector",".embeddedtestclass"));t.assertTrue(_67.containsValue(_69,"classes",".embeddedtestclass"));}else{t.assertTrue(_67.containsValue(_69,"selector",".embeddedTestClass"));t.assertTrue(_67.containsValue(_69,"classes",".embeddedTestClass"));}t.assertTrue(!_67.containsValue(_69,"selector",".embeddedTestClass2"));t.assertTrue(!_67.containsValue(_69,"classes","embeddedTestClass\t"));t.assertTrue(!_67.containsValue(_69,"selector",null));var _6a=false;try{_67.containsValue(_69,null,"foo");}catch(e){_6a=true;}t.assertTrue(_6a);d.callback(true);};_67.fetch({query:{"selector":".embeddedTestClass"},onItem:_68,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_getAttributes(t){var _6b=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _6c(_6d){t.assertTrue(_6d!==null);t.assertTrue(_6b.isItem(_6d));var _6e=_6b.getAttributes(_6d);t.assertTrue(_6e.length>8);for(var i=0;i<8;i++){var a=_6e[i];t.assertTrue((a==="selector"||a==="classes"||a==="rule"||a==="style"||a==="cssText"||a==="styleSheet"||a==="parentStyleSheet"||a==="parentStyleSheetHref"));}d.callback(true);};_6b.fetch({query:{"selector":".embeddedTestClass"},onItem:_6c,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_getFeatures(t){var _6f=_3.data.tests.stores.CssRuleStore.createStore();var _70=_6f.getFeatures();var _71=0;for(var i in _70){t.assertTrue(i==="dojo.data.api.Read");_71++;}t.assertTrue(_71===1);},function testReadAPI_fetch_patternMatch(t){var _72=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _73(_74,_75){t.is(4,_74.length);var _76=[".linkTestClass",".linkTestClass .test",".importTestClass",".embeddedTestClass"];t.assertTrue(_3.data.tests.stores.CssRuleStore.verifyItems(_72,_74,"selector",_76));d.callback(true);};_72.fetch({query:{"selector":"*TestCla*"},onComplete:_73,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_patternMatch_caseInsensitive(t){var _77=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _78(_79,_7a){t.is(1,_79.length);if(_1.isWebKit){t.assertTrue(_77.getValue(_79[0],"selector")===".linktestclass");}else{t.assertTrue(_77.getValue(_79[0],"selector")===".linkTestClass");}d.callback(true);};_77.fetch({query:{"selector":".LINKtEsTclass"},queryOptions:{ignoreCase:true},onComplete:_78,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_patternMatch_caseSensitive(t){var _7b=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _7c(_7d,_7e){if(_1.isWebKit){t.is(1,_7d.length);}else{t.is(0,_7d.length);}d.callback(true);};_7b.fetch({query:{"selector":".LINKtEsTclass"},queryOptions:{ignoreCase:false},onComplete:_7c,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_sortAlphabetic(t){var _7f=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _80(_81,_82){var _83=[".embeddedTestClass",".importTestClass",".linkTestClass"];t.is(3,_81.length);t.assertTrue(_3.data.tests.stores.CssRuleStore.verifyItems(_7f,_81,"selector",_83));d.callback(true);};var _84=[{attribute:"selector"}];_7f.fetch({query:{"selector":"*TestClass"},sort:_84,onComplete:_80,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_fetch_sortAlphabeticDescending(t){var _85=_3.data.tests.stores.CssRuleStore.createStore();var d=new doh.Deferred();function _86(_87,_88){var _89=[".linkTestClass",".importTestClass",".embeddedTestClass"];t.is(3,_87.length);t.assertTrue(_3.data.tests.stores.CssRuleStore.verifyItems(_85,_87,"selector",_89));d.callback(true);};var _8a=[{attribute:"selector",descending:true}];_85.fetch({query:{"selector":"*TestClass"},sort:_8a,onComplete:_86,onError:_1.partial(_3.data.tests.stores.CssRuleStore.error,t,d)});return d;},function testReadAPI_functionConformance(t){var _8b=_3.data.tests.stores.CssRuleStore.createStore();var _8c=new _1.data.api.Read();var _8d=true;for(var i in _8c){if(i.toString().charAt(0)!=="_"){var _8e=_8c[i];if(typeof _8e==="function"){var _8f=_8b[i];if(!(typeof _8f==="function")){_8d=false;break;}}}}t.assertTrue(_8d);}]);});require(["dojox/data/tests/stores/CssRuleStore"]);