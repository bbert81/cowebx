/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/data/QueryReadStore","dojo/data/api/Read"],function(_1,_2,_3){_1.getObject("dojox.data.tests.stores.QueryReadStore",1);_3.data.tests.stores.QueryReadStore.getStore=function(){return new _3.data.QueryReadStore({url:_1.moduleUrl("dojox.data.tests","stores/QueryReadStore.php").toString()});};tests.register("dojox.data.tests.stores.QueryReadStore",[function testReadApi_getValue(t){var _4=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();function _5(_6,_7){var _8=_6[0];t.assertEqual("Alabama",_4.getValue(_8,"name"));t.assertEqual("<img src='images/Alabama.jpg'/>Alabama",_4.getValue(_8,"label"));t.assertEqual("AL",_4.getValue(_8,"abbreviation"));t.assertEqual("default value",_4.getValue(_8,"NAME","default value"));t.assertError(Error,_4,"getValue",["not an item","NOT THERE"]);t.assertError(Error,_4,"getValue",[_8,{}]);d.callback(true);};_4.fetch({query:{q:"Alabama"},onComplete:_5});return d;},function testReadApi_getValues(t){var _9=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();function _a(_b,_c){var _d=_b[0];t.assertEqual(["Alabama"],_9.getValues(_d,"name"));t.assertEqual(["<img src='images/Alabama.jpg'/>Alabama"],_9.getValues(_d,"label"));t.assertEqual(["AL"],_9.getValues(_d,"abbreviation"));t.assertEqual([],_9.getValues(_d,"NOT THERE"));var _e=false;try{var _f=_9.getValues("not an item","NOT THERE");}catch(e){_e=true;}t.assertTrue(_e);d.callback(true);};_9.fetch({query:{q:"Alabama"},onComplete:_a});return d;},function testReadApi_getAttributes(t){var _10=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();function _11(_12,_13){var _14=_12[0];t.assertEqual(["id","name","label","abbreviation","capital"],_10.getAttributes(_14));t.assertError(Error,_10,"getAttributes",[{}]);d.callback(true);};_10.fetch({query:{q:"Alabama"},onComplete:_11});return d;},function testReadApi_getLabel(t){var _15=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();function _16(_17,_18){var _19=_17[0];t.assertEqual(["<img src='images/Alabama.jpg'/>Alabama"],_15.getLabel(_19));d.callback(true);};_15.fetch({query:{q:"Alabama"},onComplete:_16});return d;},function testReadApi_hasAttribute(t){var _1a=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();function _1b(_1c,_1d){var _1e=_1c[0];t.assertEqual(true,_1a.hasAttribute(_1e,"name"));t.assertEqual(true,_1a.hasAttribute(_1e,"label"));t.assertEqual(true,_1a.hasAttribute(_1e,"abbreviation"));t.assertEqual(false,_1a.hasAttribute(_1e,"NAME"));t.assertEqual(false,_1a.hasAttribute(_1e,"Name"));t.assertEqual(false,_1a.hasAttribute(_1e,"Label"));t.assertEqual(false,_1a.hasAttribute({},"abbreviation"));t.assertEqual(false,_1a.hasAttribute({name:"yo"},"name"));d.callback(true);};_1a.fetch({query:{q:"Alaska"},onComplete:_1b});return d;},function testReadApi_containsValue(t){var _1f=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();function _20(_21,_22){var _23=_21[0];t.assertTrue(_1f.containsValue(_23,"name","Alaska"));d.callback(true);};_1f.fetch({query:{q:"Alaska"},onComplete:_20});return d;},function testReadApi_isItem(t){var _24=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();function _25(_26,_27){t.assertEqual(true,_24.isItem(_26[0]));t.assertEqual(false,_24.isItem({}));t.assertEqual(false,_24.isItem({name:"Alaska",label:"Alaska",abbreviation:"AK"}));d.callback(true);};_24.fetch({query:{q:"Alaska"},onComplete:_25});return d;},function testReadApi_isItemLoaded(t){var _28=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();function _29(_2a,_2b){var _2c=_2a[0];t.assertTrue(_28.isItemLoaded(_2c));d.callback(true);};_28.fetch({query:{q:"Alabama"},onComplete:_29});return d;},function testReadApi_fetch_all(t){var _2d=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();function _2e(_2f,_30){t.assertEqual(12,_2f.length);d.callback(true);};function _31(_32,_33){d.errback(_32);};_2d.fetch({query:{q:"m"},onComplete:_2e,onError:_31});return d;},function testReadApi_fetch_onBegin(t){var _34=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();var _35=false;function _36(_37,_38){t.assertEqual(12,_37);_35=true;};function _39(_3a,_3b){t.assertEqual(5,_3a.length);if(_35){d.callback(true);}else{d.errback(new Error("Store did not return proper number of rows, regardless of page size"));}};function _3c(_3d,_3e){d.errback(_3d);};_34.fetch({query:{q:"m"},start:0,count:5,onBegin:_36,onComplete:_39,onError:_3c});return d;},function testReadApi_fetch_onBegin_ServersidePaging(t){var _3f=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();var _40=false;function _41(_42,_43){t.assertEqual(12,_42);_40=true;};function _44(_45,_46){t.assertEqual(5,_45.length);if(_40){d.callback(true);}else{d.errback(new Error("Store did not return proper number of rows, regardless of page size"));}};function _47(_48,_49){d.errback(_48);};_3f.fetch({query:{q:"m"},start:5,count:5,onBegin:_41,onComplete:_44,onError:_47});return d;},function testReadApi_fetch_onBegin_ClientsidePaging(t){var _4a=_3.data.tests.stores.QueryReadStore.getStore();_4a.doClientPaging=true;var d=new doh.Deferred();var _4b=false;function _4c(_4d,_4e){t.assertEqual(12,_4d);_4b=true;};function _4f(_50,_51){t.assertEqual(5,_50.length);if(_4b){d.callback(true);}else{d.errback(new Error("Store did not return proper number of rows, regardless of page size"));}};function _52(_53,_54){d.errback(_53);};_4a.fetch({query:{q:"m"},start:0,count:5,onBegin:_4c,onComplete:_4f,onError:_52});return d;},function testReadApi_fetch_one(t){var _55=_3.data.tests.stores.QueryReadStore.getStore();var d=new doh.Deferred();function _56(_57,_58){t.assertEqual(1,_57.length);d.callback(true);};function _59(_5a,_5b){d.errback(_5a);};_55.fetch({query:{q:"Alaska"},onComplete:_56,onError:_59});return d;},function testReadApi_fetch_client_paging(t){var _5c=_3.data.tests.stores.QueryReadStore.getStore();_5c.doClientPaging=true;var _5d=null;var _5e=[];var d=new doh.Deferred();function _5f(_60,_61){t.assertEqual(5,_60.length);_5d=_5c.lastRequestHash;_5e=_60;function _62(_63,_64){t.assertEqual(5,_63.length);t.assertEqual(_5d,_5c.lastRequestHash);t.assertEqual(_5e[1],_63[0]);d.callback(true);};req.start=1;req.onComplete=_62;_5c.fetch(req);};function _65(_66,_67){d.errback(_66);};var req={query:{q:"m"},start:0,count:5,onComplete:_5f,onError:_65};_5c.fetch(req);return d;},function testReadApi_fetch_server_paging(t){var _68=_3.data.tests.stores.QueryReadStore.getStore();var _69=null;var d=new doh.Deferred();function _6a(_6b,_6c){t.assertEqual(10,_6b.length);_69=_68.lastRequestHash;firstItems=_6b;function _6d(_6e,_6f){t.assertEqual(5,_6e.length);t.assertTrue(_69!=_68.lastRequestHash);t.assertEqual(_68.getValue(firstItems[5],"name"),_68.getValue(_6e[0],"name"));t.assertEqual(_68.getValue(firstItems[6],"name"),_68.getValue(_6e[1],"name"));t.assertEqual(_68.getValue(firstItems[7],"name"),_68.getValue(_6e[2],"name"));t.assertEqual(_68.getValue(firstItems[8],"name"),_68.getValue(_6e[3],"name"));t.assertEqual(_68.getValue(firstItems[9],"name"),_68.getValue(_6e[4],"name"));d.callback(true);};_68.doClientPaging=false;_68.fetch({start:5,count:5,onComplete:_6d,onError:_70});};function _70(_71,_72){d.errback(_71);};_68.fetch({query:{},start:0,count:10,onComplete:_6a,onError:_70});return d;},function testReadApi_getFeatures(t){var _73=_3.data.tests.stores.QueryReadStore.getStore();var _74=_73.getFeatures();t.assertTrue(_74["dojo.data.api.Read"]);t.assertTrue(_74["dojo.data.api.Identity"]);var _75=0;for(i in _74){_75++;}t.assertEqual(2,_75);},function testReadAPI_functionConformance(t){var _76=_3.data.tests.stores.QueryReadStore.getStore();var _77=new _1.data.api.Read();var _78=true;for(i in _77){var _79=_77[i];if(typeof _79==="function"){var _7a=_76[i];if(!(typeof _7a==="function")){_78=false;break;}}}t.assertTrue(_78);}]);});require(["dojox/data/tests/stores/QueryReadStore"]);