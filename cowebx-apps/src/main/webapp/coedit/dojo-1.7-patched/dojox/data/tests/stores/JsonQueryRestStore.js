/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/data/ClientFilter","dojox/data/JsonQueryRestStore"],function(_1,_2,_3){_1.getObject("dojox.data.tests.stores.JsonQueryRestStore",1);_3.data.tests.stores.JsonQueryRestStore.error=function(t,d,_4){d.errback(_4);};testService=function(_5){lastQuery=_5;var _6=new _1.Deferred();_6.callback([{id:1,name:"Ball",price:5},{id:2,name:"Car",price:15},{id:3,name:"Truck",price:25},{id:4,name:"Hula Hoop",price:55}]);return _6;};testService.servicePath="/testing";jsonStore=new _3.data.JsonQueryRestStore({service:testService});doh.register("dojox.data.tests.stores.JsonQueryRestStore",[{name:"Fetch using a query object",timeout:10000,runTest:function(t){var d=new doh.Deferred();jsonStore.fetch({query:{name:"Car"},onComplete:function(_7,_8){t.is(lastQuery,"[?(@.name='Car')]");d.callback(true);},onError:_1.partial(_3.data.tests.stores.JsonQueryRestStore.error,doh,d)});return d;}},{name:"Fetch+Sorting using a query object",timeout:10000,runTest:function(t){var d=new doh.Deferred();jsonStore.fetch({query:{name:"Car"},sort:[{attribute:"price"}],onComplete:function(_9,_a){t.is(lastQuery,"[?(@.name='Car')][/@['price']]");d.callback(true);},onError:_1.partial(_3.data.tests.stores.JsonQueryRestStore.error,doh,d)});return d;}},{name:"Fetch all items (and cache for the next tests)",timeout:10000,runTest:function(t){var d=new doh.Deferred();jsonStore.fetch({query:"",onComplete:function(_b,_c){testItems=_b;t.is(4,_b.length);d.callback(true);},onError:_1.partial(_3.data.tests.stores.JsonQueryRestStore.error,doh,d),queryOptions:{cache:true}});return d;}},{name:"Fetch using a query object",timeout:10000,runTest:function(t){var d=new doh.Deferred();lastQuery=null;jsonStore.fetch({query:{name:"Car"},onComplete:function(_d,_e){t.is(1,_d.length);t.is(lastQuery,null);d.callback(true);},onError:_1.partial(_3.data.tests.stores.JsonQueryRestStore.error,doh,d)});return d;}},{name:"Fetch using a JSONQuery",timeout:10000,runTest:function(t){var d=new doh.Deferred();lastQuery=null;jsonStore.fetch({query:"?name='Car'",onComplete:function(_f,_10){t.is(1,_f.length);t.is(lastQuery,null);d.callback(true);},onError:_1.partial(_3.data.tests.stores.JsonQueryRestStore.error,doh,d)});return d;}},{name:"Fetch using a JSONQuery with operator",timeout:10000,runTest:function(t){var d=new doh.Deferred();lastQuery=null;jsonStore.fetch({query:"[?price<20]",onComplete:function(_11,_12){t.is(2,_11.length);t.is(lastQuery,null);d.callback(true);},onError:_1.partial(_3.data.tests.stores.JsonQueryRestStore.error,doh,d)});return d;}},{name:"Fetch using a JSONQuery with operator and paging",timeout:10000,runTest:function(t){var d=new doh.Deferred();lastQuery=null;jsonStore.fetch({query:"?price<20",start:1,count:1,onComplete:function(_13,_14){t.is(1,_13.length);t.is(lastQuery,null);d.callback(true);},onError:_1.partial(_3.data.tests.stores.JsonQueryRestStore.error,doh,d),queryOptions:{cache:true}});return d;}},{name:"Sorting",timeout:10000,runTest:function(t){var d=new doh.Deferred();lastQuery=null;jsonStore.fetch({sort:[{attribute:"name",descending:true}],onComplete:function(_15,_16){t.is("Truck",_15[0].name);t.is("Ball",_15[3].name);t.is(lastQuery,null);d.callback(true);},onError:_1.partial(_3.data.tests.stores.JsonQueryRestStore.error,doh,d)});return d;}},{name:"Sorting + Paging",timeout:10000,runTest:function(t){jsonStore.jsonQueryPagination=true;var d=new doh.Deferred();lastQuery=null;jsonStore.fetch({sort:[{attribute:"name",descending:true}],start:1,count:2,onBegin:function(_17){t.is(_17,4);},onComplete:function(_18,_19){t.is("Hula Hoop",_18[0].name);t.is("Car",_18[1].name);t.is(_18.length,2);t.is(lastQuery,null);d.callback(true);},onError:_1.partial(_3.data.tests.stores.JsonQueryRestStore.error,doh,d)});return d;}}]);});require(["dojox/data/tests/stores/JsonQueryRestStore"]);