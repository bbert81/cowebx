/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/data/AndOrWriteStore","dojo/data/api/Read","dojo/data/api/Identity","dojo/date","dojo/date/stamp","dojo/data/api/Write","dojo/data/api/Notification"],function(_1,_2,_3){_1.getObject("dojox.data.tests.stores.AndOrWriteStore",1);_3.data.tests.stores.AndOrWriteStore.getTestData=function(_4){var _5=null;if(_4==="countries"){if(_1.isBrowser){_5={url:_1.moduleUrl("dojox","data/tests/stores/countries.json").toString()};}else{_5={data:{identifier:"abbr",label:"name",items:[{abbr:"ec",name:"Ecuador",capital:"Quito"},{abbr:"eg",name:"Egypt",capital:"Cairo"},{abbr:"sv",name:"El Salvador",capital:"San Salvador"},{abbr:"gq",name:"Equatorial Guinea",capital:"Malabo"},{abbr:"er",name:"Eritrea",capital:"Asmara"},{abbr:"ee",name:"Estonia",capital:"Tallinn"},{abbr:"et",name:"Ethiopia",capital:"Addis Ababa"}]}};}}else{if(_4==="countries_withNull"){_5={data:{identifier:"abbr",items:[{abbr:"ec",name:null,capital:"Quito"},{abbr:"eg",name:null,capital:"Cairo"},{abbr:"sv",name:"El Salvador",capital:"San Salvador"},{abbr:"gq",name:"Equatorial Guinea",capital:"Malabo"},{abbr:"er",name:"Eritrea",capital:"Asmara"},{abbr:"ee",name:null,capital:"Tallinn"},{abbr:"et",name:"Ethiopia",capital:"Addis Ababa"}]}};}else{if(_4==="countries_withoutid"){_5={data:{label:"name",items:[{abbr:"ec",name:null,capital:"Quito"},{abbr:"eg",name:null,capital:"Cairo"},{abbr:"sv",name:"El Salvador",capital:"San Salvador"},{abbr:"gq",name:"Equatorial Guinea",capital:"Malabo"},{abbr:"er",name:"Eritrea",capital:"Asmara"},{abbr:"ee",name:null,capital:"Tallinn"},{abbr:"et",name:"Ethiopia",capital:"Addis Ababa"}]}};}else{if(_4==="countries_withBoolean"){_5={data:{identifier:"abbr",items:[{abbr:"ec",name:"Ecuador",capital:"Quito",real:true},{abbr:"eg",name:"Egypt",capital:"Cairo",real:true},{abbr:"sv",name:"El Salvador",capital:"San Salvador",real:true},{abbr:"gq",name:"Equatorial Guinea",capital:"Malabo",real:true},{abbr:"er",name:"Eritrea",capital:"Asmara",real:true},{abbr:"ee",name:"Estonia",capital:"Tallinn",real:true},{abbr:"et",name:"Ethiopia",capital:"Addis Ababa",real:true},{abbr:"ut",name:"Utopia",capital:"Paradise",real:false}]}};}else{if(_4==="countries_withDates"){_5={data:{identifier:"abbr",items:[{abbr:"ec",name:"Ecuador",capital:"Quito"},{abbr:"eg",name:"Egypt",capital:"Cairo"},{abbr:"sv",name:"El Salvador",capital:"San Salvador"},{abbr:"gq",name:"Equatorial Guinea",capital:"Malabo"},{abbr:"er",name:"Eritrea",capital:"Asmara",independence:{_type:"Date",_value:"1993-05-24T00:00:00Z"}},{abbr:"ee",name:"Estonia",capital:"Tallinn",independence:{_type:"Date",_value:"1991-08-20T00:00:00Z"}},{abbr:"et",name:"Ethiopia",capital:"Addis Ababa"}]}};}else{if(_4==="geography_hierarchy_small"){_5={data:{items:[{name:"Africa",countries:[{name:"Egypt",capital:"Cairo"},{name:"Kenya",capital:"Nairobi"},{name:"Sudan",capital:"Khartoum"}]},{name:"Australia",capital:"Canberra"},{name:"North America",countries:[{name:"Canada",population:"33 million",cities:[{name:"Toronto",population:"2.5 million"},{name:"Alberta",population:"1 million"}]},{name:"United States of America",capital:"Washington DC",states:[{name:"Missouri"},{name:"Arkansas"}]}]}]}};}else{if(_4==="data_multitype"){_5={data:{"identifier":"count","label":"count",items:[{count:1,value:"true"},{count:2,value:true},{count:3,value:"false"},{count:4,value:false},{count:5,value:true},{count:6,value:true},{count:7,value:"true"},{count:8,value:"true"},{count:9,value:"false"},{count:10,value:false},{count:11,value:[false,false]},{count:"12",value:[false,"true"]}]}};}else{if(_4==="countries_references"){_5={data:{identifier:"name",label:"name",items:[{name:"Africa",type:"continent",children:[{_reference:"Egypt"},{_reference:"Kenya"},{_reference:"Sudan"}]},{name:"Egypt",type:"country"},{name:"Kenya",type:"country",children:[{_reference:"Nairobi"},{_reference:"Mombasa"}]},{name:"Nairobi",type:"city"},{name:"Mombasa",type:"city"},{name:"Sudan",type:"country",children:{_reference:"Khartoum"}},{name:"Khartoum",type:"city"},{name:"Asia",type:"continent",children:[{_reference:"China"},{_reference:"India"},{_reference:"Russia"},{_reference:"Mongolia"}]},{name:"China",type:"country"},{name:"India",type:"country"},{name:"Russia",type:"country"},{name:"Mongolia",type:"country"},{name:"Australia",type:"continent",population:"21 million",children:{_reference:"Commonwealth of Australia"}},{name:"Commonwealth of Australia",type:"country",population:"21 million"},{name:"Europe",type:"continent",children:[{_reference:"Germany"},{_reference:"France"},{_reference:"Spain"},{_reference:"Italy"}]},{name:"Germany",type:"country"},{name:"France",type:"country"},{name:"Spain",type:"country"},{name:"Italy",type:"country"},{name:"North America",type:"continent",children:[{_reference:"Mexico"},{_reference:"Canada"},{_reference:"United States of America"}]},{name:"Mexico",type:"country",population:"108 million",area:"1,972,550 sq km",children:[{_reference:"Mexico City"},{_reference:"Guadalajara"}]},{name:"Mexico City",type:"city",population:"19 million",timezone:"-6 UTC"},{name:"Guadalajara",type:"city",population:"4 million",timezone:"-6 UTC"},{name:"Canada",type:"country",population:"33 million",area:"9,984,670 sq km",children:[{_reference:"Ottawa"},{_reference:"Toronto"}]},{name:"Ottawa",type:"city",population:"0.9 million",timezone:"-5 UTC"},{name:"Toronto",type:"city",population:"2.5 million",timezone:"-5 UTC"},{name:"United States of America",type:"country"},{name:"South America",type:"continent",children:[{_reference:"Brazil"},{_reference:"Argentina"}]},{name:"Brazil",type:"country",population:"186 million"},{name:"Argentina",type:"country",population:"40 million"}]}};}else{if(_4==="reference_integrity"){_5={data:{"identifier":"id","label":"name","items":[{"id":1,"name":"Item 1"},{"id":2,"name":"Item 2"},{"id":3,"name":"Item 3"},{"id":4,"name":"Item 4"},{"id":5,"name":"Item 5"},{"id":6,"name":"Item 6"},{"id":7,"name":"Item 7"},{"id":8,"name":"Item 8"},{"id":9,"name":"Item 9"},{"id":10,"name":"Item 10","friends":[{"_reference":1},{"_reference":3},{"_reference":5}]},{"id":11,"name":"Item 11","friends":[{"_reference":10}],"siblings":[{"_reference":10}]},{"id":12,"name":"Item 12","friends":[{"_reference":3},{"_reference":7}],"enemies":[{"_reference":10}]},{"id":13,"name":"Item 13","friends":[{"_reference":10}]},{"id":14,"name":"Item 14","friends":[{"_reference":11}]},{"id":15,"name":"item 15","friends":[{"id":16,"name":"Item 16"}]}]}};}}}}}}}}}return _5;};_3.data.tests.stores.AndOrWriteStore.getTests=function(){_3.data.tests.stores.AndOrWriteStore.tests=[{name:"Identity API: fetchItemByIdentity()",runTest:function(t){var _6=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _7=function(_8){t.assertTrue(_8!==null);if(_8!==null){var _9=_6.getValue(_8,"name");t.assertEqual(_9,"El Salvador");}d.callback(true);};var _a=function(_b){t.assertTrue(false);d.errback(_b);};_6.fetchItemByIdentity({identity:"sv",onItem:_7,onError:_a});return d;}},{name:"Identity API: fetchItemByIdentity() notFound",runTest:function(t){var _c=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _d=function(_e){t.assertTrue(_e===null);d.callback(true);};var _f=function(_10){t.assertTrue(false);d.errback(_10);};_c.fetchItemByIdentity({identity:"sv_not",onItem:_d,onError:_f});return d;}},{name:"Identity API: getIdentityAttributes()",runTest:function(t){var _11=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _12=function(_13){t.assertTrue(_13!==null);var _14=_11.getIdentityAttributes(_13);t.assertTrue(_1.isArray(_14));t.assertEqual(1,_14.length);t.assertEqual("abbr",_14[0]);d.callback(true);};var _15=function(_16){t.assertTrue(false);d.errback(_16);};_11.fetchItemByIdentity({identity:"sv",onItem:_12,onError:_15});return d;}},{name:"Identity API: fetchItemByIdentity() commentFilteredJson",runTest:function(t){if(_1.isBrowser){var _17=new _3.data.AndOrWriteStore({url:_1.moduleUrl("tests","data/countries_commentFiltered.json").toString()});var d=new doh.Deferred();var _18=function(_19){t.assertTrue(_19!==null);var _1a=_17.getValue(_19,"name");t.assertEqual(_1a,"El Salvador");d.callback(true);};var _1b=function(_1c){t.assertTrue(false);d.errback(_1c);};_17.fetchItemByIdentity({identity:"sv",onItem:_18,onError:_1b});return d;}}},{name:"Identity API: fetchItemByIdentity() nullValue",runTest:function(t){var _1d=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries_withNull"));var d=new doh.Deferred();var _1e=function(_1f){t.assertTrue(_1f!==null);var _20=_1d.getValue(_1f,"name");t.assertEqual(_20,null);d.callback(true);};var _21=function(_22){t.assertTrue(false);d.errback(_22);};_1d.fetchItemByIdentity({identity:"ec",onItem:_1e,onError:_21});return d;}},{name:"Identity API: fetchItemByIdentity() booleanValue",runTest:function(t){var _23=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries_withBoolean"));var d=new doh.Deferred();var _24=function(_25){t.assertTrue(_25!==null);var _26=_23.getValue(_25,"name");t.assertEqual(_26,"Utopia");var _27=_23.getValue(_25,"real");t.assertEqual(_27,false);d.callback(true);};var _28=function(_29){t.assertTrue(false);d.errback(_29);};_23.fetchItemByIdentity({identity:"ut",onItem:_24,onError:_28});return d;}},{name:"Identity API: fetchItemByIdentity() withoutSpecifiedIdInData",runTest:function(t){var _2a=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries_withoutid"));var d=new doh.Deferred();var _2b=function(_2c){t.assertTrue(_2c!==null);var _2d=_2a.getValue(_2c,"name");t.assertEqual(_2d,"El Salvador");d.callback(true);};var _2e=function(_2f){t.assertTrue(false);d.errback(_2f);};_2a.fetchItemByIdentity({identity:"2",onItem:_2b,onError:_2e});return d;}},{name:"Identity API: getIdentity()",runTest:function(t){var _30=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _31=function(_32){t.assertTrue(_32!==null);t.assertTrue(_30.getIdentity(_32)==="sv");d.callback(true);};var _33=function(_34){t.assertTrue(false);d.errback(_34);};_30.fetchItemByIdentity({identity:"sv",onItem:_31,onError:_33});return d;}},{name:"Identity API: getIdentity() withoutSpecifiedId",runTest:function(t){var _35=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries_withoutid"));var d=new doh.Deferred();var _36=function(_37,_38){t.assertTrue(_37!==null);t.assertTrue(_35.getIdentity(_37)===2);d.callback(true);};var _39=function(_3a,_3b){t.assertTrue(false);d.errback(_3a);};_35.fetch({query:{abbr:"sv"},onItem:_36,onError:_39});return d;}},{name:"Identity API: getIdentity() withoutSpecifiedId, complex",runTest:function(t){var _3c=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries_withoutid"));var d=new doh.Deferred();var _3d=function(_3e,_3f){t.assertTrue(_3e!==null);t.assertTrue(_3c.getIdentity(_3e)===2);d.callback(true);};var _40=function(_41,_42){t.assertTrue(false);d.errback(_41);};_3c.fetch({query:"abbr: \"sv\"",onItem:_3d,onError:_40});return d;}},{name:"Read API: fetch() all",runTest:function(t){var _43=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _44=function(_45,_46){t.is(7,_45.length);d.callback(true);};var _47=function(_48,_49){t.assertTrue(false);d.errback(_48);};_43.fetch({onComplete:_44,onError:_47});return d;}},{name:"Read API: fetch() abort",runTest:function(t){if(_1.isBrowser){var _4a=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _4b=false;function _4c(_4d,_4e){t.is(7,_4d.length);if(_4b){d.errback(new Error("Should not be here."));}else{d.callback(true);}};function _4f(_50,_51){t.assertTrue(true);d.callback(true);};var req=_4a.fetch({onComplete:_4c,onError:_4f});_4b=true;req.abort();return d;}}},{name:"Read API: fetch() one",runTest:function(t){var _52=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _53=function(_54,_55){t.assertEqual(_54.length,1);d.callback(true);};var _56=function(_57,_58){t.assertTrue(false);d.errback(_57);};_52.fetch({query:{abbr:"ec"},onComplete:_53,onError:_56});return d;}},{name:"Read API: fetch() one, complex",runTest:function(t){var _59=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _5a=function(_5b,_5c){t.assertEqual(_5b.length,1);d.callback(true);};var _5d=function(_5e,_5f){t.assertTrue(false);d.errback(_5e);};_59.fetch({query:"abbr: \"ec\"",onComplete:_5a,onError:_5d});return d;}},{name:"Read API: fetch() shallow",runTest:function(t){var _60=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("geography_hierarchy_small"));var d=new doh.Deferred();var _61=function(_62,_63){t.assertEqual(_62.length,2);d.callback(true);};var _64=function(_65,_66){t.assertTrue(false);d.errback(_65);};_60.fetch({query:{name:"A*"},onComplete:_61,onError:_64});return d;}},{name:"Read API: fetch() shallow, complex",runTest:function(t){var _67=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("geography_hierarchy_small"));var d=new doh.Deferred();var _68=function(_69,_6a){t.assertEqual(_69.length,2);d.callback(true);};var _6b=function(_6c,_6d){t.assertTrue(false);d.errback(_6c);};_67.fetch({query:"name: \"A*\"",onComplete:_68,onError:_6b});return d;}},{name:"Read API: fetch() Multiple",runTest:function(t){var _6e=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("geography_hierarchy_small"));var d=new doh.Deferred();var _6f=[false,false];var _70=function(_71,_72){_6f[0]=true;t.assertEqual(_71.length,2);if(_6f[0]&&_6f[1]){d.callback(true);}};var _73=function(_74,_75){_6f[1]=true;if(_6f[0]&&_6f[1]){d.callback(true);}};var _76=function(_77,_78){t.assertTrue(false);d.errback(_77);};_6e.fetch({query:{name:"A*"},onComplete:_70,onError:_76});_6e.fetch({query:{name:"N*"},onComplete:_73,onError:_76});return d;}},{name:"Read API: fetch() Multiple, complex",runTest:function(t){var _79=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("geography_hierarchy_small"));var d=new doh.Deferred();var _7a=[false,false];var _7b=function(_7c,_7d){_7a[0]=true;t.assertEqual(_7c.length,2);if(_7a[0]&&_7a[1]){d.callback(true);}};var _7e=function(_7f,_80){_7a[1]=true;if(_7a[0]&&_7a[1]){d.callback(true);}};var _81=function(_82,_83){t.assertTrue(false);d.errback(_82);};_79.fetch({query:"name: \"A*\"",onComplete:_7b,onError:_81});_79.fetch({query:"name: \"N*\"",onComplete:_7e,onError:_81});return d;}},{name:"Read API: fetch() MultipleMixedFetch",runTest:function(t){var _84=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _85=[false,false];var _86=function(_87,_88){_85[0]=true;t.assertEqual(_87.length,1);if(_85[0]&&_85[1]){d.callback(true);}};var _89=function(_8a){_85[1]=true;t.assertTrue(_8a!==null);var _8b=_84.getValue(_8a,"name");t.assertEqual(_8b,"El Salvador");if(_85[0]&&_85[1]){d.callback(true);}};var _8c=function(_8d){t.assertTrue(false);d.errback(_8d);};_84.fetch({query:{name:"El*"},onComplete:_86,onError:_8c});_84.fetchItemByIdentity({identity:"sv",onItem:_89,onError:_8c});return d;}},{name:"Read API: fetch() MultipleMixedFetch, complex",runTest:function(t){var _8e=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _8f=[false,false];var _90=function(_91,_92){_8f[0]=true;t.assertEqual(_91.length,1);if(_8f[0]&&_8f[1]){d.callback(true);}};var _93=function(_94){_8f[1]=true;t.assertTrue(_94!==null);var _95=_8e.getValue(_94,"name");t.assertEqual(_95,"El Salvador");if(_8f[0]&&_8f[1]){d.callback(true);}};var _96=function(_97){t.assertTrue(false);d.errback(_97);};_8e.fetch({query:"name: \"El*\"",onComplete:_90,onError:_96});_8e.fetchItemByIdentity({identity:"sv",onItem:_93,onError:_96});return d;}},{name:"Read API: fetch() deep",runTest:function(t){var _98=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("geography_hierarchy_small"));var d=new doh.Deferred();var _99=function(_9a,_9b){t.assertEqual(_9a.length,4);d.callback(true);};var _9c=function(_9d,_9e){t.assertTrue(false);d.errback(_9d);};_98.fetch({query:{name:"A*"},onComplete:_99,onError:_9c,queryOptions:{deep:true}});return d;}},{name:"Read API: fetch() deep, complex",runTest:function(t){var _9f=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("geography_hierarchy_small"));var d=new doh.Deferred();var _a0=function(_a1,_a2){t.assertEqual(_a1.length,4);d.callback(true);};var _a3=function(_a4,_a5){t.assertTrue(false);d.errback(_a4);};_9f.fetch({query:"name: \"A*\"",onComplete:_a0,onError:_a3,queryOptions:{deep:true}});return d;}},{name:"Read API: fetch() hierarchy off",runTest:function(t){var _a6=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("geography_hierarchy_small"));_a6.hierarchical=false;var d=new doh.Deferred();function _a7(_a8,_a9){t.assertEqual(2,_a8.length);var i;var _aa=true;for(i=0;i<_a8.length;i++){var _ab=_a6.getValues(_a8[i],"countries");if(_ab){var j;for(j=0;j<_ab.length;j++){_aa=!_a6.isItem(_ab[j]);if(!_aa){break;}}}if(!_aa){break;}}if(!_aa){d.errback(new Error("Located a child item with hierarchy off and no references in the data.  Error."));}else{d.callback(true);}};function _ac(_ad,_ae){d.errback(_ad);};_a6.fetch({query:{name:"A*"},onComplete:_a7,onError:_ac,queryOptions:{deep:true}});return d;}},{name:"Read API: fetch() hierarchy off refs still parse",runTest:function(t){var _af=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries_references"));_af.hierarchical=false;var d=new doh.Deferred();function _b0(_b1,_b2){t.assertEqual(_b1.length,4);var i;var _b3=true;for(i=0;i<_b1.length;i++){var _b4=_af.getValues(_b1[i],"children");if(_b4){var j;for(j=0;j<_b4.length;j++){_b3=_af.isItem(_b4[j]);if(!_b3){break;}}}if(!_b3){break;}}if(!_b3){d.errback(new Error("Found a non-child item in a reference list in a references based input.  Error."));}else{d.callback(true);}};function _b5(_b6,_b7){t.assertTrue(false);d.errback(_b6);};_af.fetch({query:{name:"A*"},onComplete:_b0,onError:_b5,queryOptions:{deep:true}});return d;}},{name:"Read API: fetch() one_commentFilteredJson",runTest:function(t){if(_1.isBrowser){var _b8=new _3.data.AndOrWriteStore({url:_1.moduleUrl("tests","data/countries_commentFiltered.json").toString()});var d=new doh.Deferred();var _b9=function(_ba,_bb){t.assertEqual(_ba.length,1);d.callback(true);};var _bc=function(_bd,_be){t.assertTrue(false);d.errback(_bd);};_b8.fetch({query:{abbr:"ec"},onComplete:_b9,onError:_bc});return d;}}},{name:"Read API: fetch() one_commentFilteredJson, complex",runTest:function(t){if(_1.isBrowser){var _bf=new _3.data.AndOrWriteStore({url:_1.moduleUrl("tests","data/countries_commentFiltered.json").toString()});var d=new doh.Deferred();var _c0=function(_c1,_c2){t.assertEqual(_c1.length,1);d.callback(true);};var _c3=function(_c4,_c5){t.assertTrue(false);d.errback(_c4);};_bf.fetch({query:"abbr: \"ec\"",onComplete:_c0,onError:_c3});return d;}}},{name:"Read API: fetch() withNull",runTest:function(t){var _c6=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries_withNull"));var d=new doh.Deferred();var _c7=function(_c8,_c9){t.assertEqual(4,_c8.length);d.callback(true);};var _ca=function(_cb,_cc){t.assertTrue(false);d.errback(_cb);};_c6.fetch({query:{name:"E*"},onComplete:_c7,onError:_ca});return d;}},{name:"Read API: fetch() withNull, complex",runTest:function(t){var _cd=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries_withNull"));var d=new doh.Deferred();var _ce=function(_cf,_d0){t.assertEqual(4,_cf.length);d.callback(true);};var _d1=function(_d2,_d3){t.assertTrue(false);d.errback(_d2);};_cd.fetch({query:"name: \"E*\"",onComplete:_ce,onError:_d1});return d;}},{name:"Read API: fetch() all_streaming",runTest:function(t){var _d4=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _d5=0;var _d6=function(_d7,_d8){t.assertEqual(_d7,7);};var _d9=function(_da,_db){t.assertTrue(_d4.isItem(_da));_d5++;};var _dc=function(_dd,_de){t.assertEqual(_d5,7);t.assertTrue(_dd===null);d.callback(true);};var _df=function(_e0,_e1){t.assertTrue(false);d.errback(_e0);};_d4.fetch({onBegin:_d6,onItem:_d9,onComplete:_dc,onError:_df});return d;}},{name:"Read API: fetch() paging",runTest:function(t){var _e2=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _e3=function(_e4,_e5){t.assertEqual(_e4.length,5);d.callback(true);};var _e6=function(_e7,_e8){t.assertEqual(_e7.length,0);_e8.start=2;_e8.count=20;_e8.onComplete=_e3;_e2.fetch(_e8);};var _e9=function(_ea,_eb){t.assertEqual(_ea.length,5);_eb.start=9;_eb.count=100;_eb.onComplete=_e6;_e2.fetch(_eb);};var _ec=function(_ed,_ee){t.assertEqual(_ed.length,5);_ee.start=2;_ee.count=20;_ee.onComplete=_e9;_e2.fetch(_ee);};var _ef=function(_f0,_f1){t.assertEqual(_f0.length,1);_f1.start=0;_f1.count=5;_f1.onComplete=_ec;_e2.fetch(_f1);};var _f2=function(_f3,_f4){t.assertEqual(_f3.length,5);_f4.start=3;_f4.count=1;_f4.onComplete=_ef;_e2.fetch(_f4);};var _f5=function(_f6,_f7){t.assertEqual(_f6.length,7);_f7.start=1;_f7.count=5;_f7.onComplete=_f2;_e2.fetch(_f7);};var _f8=function(_f9,_fa){t.assertTrue(false);d.errback(_f9);};_e2.fetch({onComplete:_f5,onError:_f8});return d;}},{name:"Read API: fetch() with MultiType Match",runTest:function(t){var _fb=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("data_multitype"));var d=new doh.Deferred();var _fc=function(_fd,_fe){t.assertEqual(4,_fd.length);d.callback(true);};var _ff=function(_100,_101){t.assertTrue(false);d.errback(_100);};_fb.fetch({query:{count:"1*"},onComplete:_fc,onError:_ff});return d;}},{name:"Read API: fetch() with MultiType Match, complex",runTest:function(t){var _102=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("data_multitype"));var d=new doh.Deferred();var _103=function(_104,_105){t.assertEqual(4,_104.length);d.callback(true);};var _106=function(_107,_108){t.assertTrue(false);d.errback(_107);};_102.fetch({query:"count: \"1*\"",onComplete:_103,onError:_106});return d;}},{name:"Read API: fetch() with MultiType, MultiValue Match",runTest:function(t){var _109=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("data_multitype"));var d=new doh.Deferred();var _10a=function(_10b,_10c){t.assertEqual(7,_10b.length);d.callback(true);};var _10d=function(_10e,_10f){t.assertTrue(false);d.errback(_10e);};_109.fetch({query:{value:"true"},onComplete:_10a,onError:_10d});return d;}},{name:"Read API: fetch() with MultiType, MultiValue Match, complex",runTest:function(t){var _110=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("data_multitype"));var d=new doh.Deferred();var _111=function(_112,_113){t.assertEqual(7,_112.length);d.callback(true);};var _114=function(_115,_116){t.assertTrue(false);d.errback(_115);};_110.fetch({query:"value: \"true\"",onComplete:_111,onError:_114});return d;}},{name:"Read API: getLabel()",runTest:function(t){var _117=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _118=function(_119,_11a){t.assertEqual(_119.length,1);var _11b=_117.getLabel(_119[0]);t.assertTrue(_11b!==null);t.assertEqual("Ecuador",_11b);d.callback(true);};var _11c=function(_11d,_11e){t.assertTrue(false);d.errback(_11d);};_117.fetch({query:{abbr:"ec"},onComplete:_118,onError:_11c});return d;}},{name:"Read API: getLabel(), complex",runTest:function(t){var _11f=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _120=function(_121,_122){t.assertEqual(_121.length,1);var _123=_11f.getLabel(_121[0]);t.assertTrue(_123!==null);t.assertEqual("Ecuador",_123);d.callback(true);};var _124=function(_125,_126){t.assertTrue(false);d.errback(_125);};_11f.fetch({query:"abbr: \"ec\"",onComplete:_120,onError:_124});return d;}},{name:"Read API: getLabelAttributes()",runTest:function(t){var _127=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _128=function(_129,_12a){t.assertEqual(_129.length,1);var _12b=_127.getLabelAttributes(_129[0]);t.assertTrue(_1.isArray(_12b));t.assertEqual("name",_12b[0]);d.callback(true);};var _12c=function(_12d,_12e){t.assertTrue(false);d.errback(_12d);};_127.fetch({query:{abbr:"ec"},onComplete:_128,onError:_12c});return d;}},{name:"Read API: getLabelAttributes(), complex",runTest:function(t){var _12f=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _130=function(_131,_132){t.assertEqual(_131.length,1);var _133=_12f.getLabelAttributes(_131[0]);t.assertTrue(_1.isArray(_133));t.assertEqual("name",_133[0]);d.callback(true);};var _134=function(_135,_136){t.assertTrue(false);d.errback(_135);};_12f.fetch({query:"abbr: \"ec\"",onComplete:_130,onError:_134});return d;}},{name:"Read API: getValue()",runTest:function(t){var _137=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _138=function(item){t.assertTrue(item!==null);var name=_137.getValue(item,"name");t.assertTrue(name==="El Salvador");d.callback(true);};var _139=function(_13a){t.assertTrue(false);d.errback(_13a);};_137.fetchItemByIdentity({identity:"sv",onItem:_138,onError:_139});return d;}},{name:"Read API: getValues()",runTest:function(t){var _13b=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _13c=function(item){t.assertTrue(item!==null);var _13d=_13b.getValues(item,"name");t.assertTrue(_1.isArray(_13d));t.assertEqual(_13d.length,1);t.assertEqual(_13d[0],"El Salvador");d.callback(true);};var _13e=function(_13f){t.assertTrue(false);d.errback(_13f);};_13b.fetchItemByIdentity({identity:"sv",onItem:_13c,onError:_13e});return d;}},{name:"Read API: isItem()",runTest:function(t){var _140=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _141=function(item){t.assertTrue(item!==null);t.assertTrue(_140.isItem(item));t.assertTrue(!_140.isItem({}));d.callback(true);};var _142=function(_143){t.assertTrue(false);d.errback(_143);};_140.fetchItemByIdentity({identity:"sv",onItem:_141,onError:_142});return d;}},{name:"Read API: isItem() multistore",runTest:function(t){var _144=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var _145=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _146=function(_147){t.assertTrue(false);d.errback(_147);};var _148=function(_149){t.assertTrue(_149!==null);var _14a=function(_14b){t.assertTrue(_149!==null);t.assertTrue(_14b!==null);t.assertTrue(_144.isItem(_149));t.assertTrue(_145.isItem(_14b));t.assertTrue(!_144.isItem(_14b));t.assertTrue(!_145.isItem(_149));d.callback(true);};_145.fetchItemByIdentity({identity:"sv",onItem:_14a,onError:_146});};_144.fetchItemByIdentity({identity:"sv",onItem:_148,onError:_146});return d;}},{name:"Read API: hasAttribute()",runTest:function(t){var _14c=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _14d=function(item){t.assertTrue(item!==null);t.assertTrue(_14c.hasAttribute(item,"abbr"));t.assertTrue(!_14c.hasAttribute(item,"abbr_not"));var _14e=false;try{_14c.hasAttribute(item,null);}catch(e){_14e=true;}t.assertTrue(_14e);d.callback(true);};var _14f=function(_150){t.assertTrue(false);d.errback(_150);};_14c.fetchItemByIdentity({identity:"sv",onItem:_14d,onError:_14f});return d;}},{name:"Read API: containsValue()",runTest:function(t){var _151=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _152=function(item){t.assertTrue(item!==null);t.assertTrue(_151.containsValue(item,"abbr","sv"));t.assertTrue(!_151.containsValue(item,"abbr","sv1"));t.assertTrue(!_151.containsValue(item,"abbr",null));var _153=false;try{_151.containsValue(item,null,"foo");}catch(e){_153=true;}t.assertTrue(_153);d.callback(true);};var _154=function(_155){t.assertTrue(false);d.errback(_155);};_151.fetchItemByIdentity({identity:"sv",onItem:_152,onError:_154});return d;}},{name:"Read API: getAttributes()",runTest:function(t){var _156=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _157=function(item){t.assertTrue(item!==null);t.assertTrue(_156.isItem(item));var _158=_156.getAttributes(item);t.assertEqual(_158.length,3);for(var i=0;i<_158.length;i++){t.assertTrue((_158[i]==="name"||_158[i]==="abbr"||_158[i]==="capital"));}d.callback(true);};var _159=function(_15a){t.assertTrue(false);d.errback(_15a);};_156.fetchItemByIdentity({identity:"sv",onItem:_157,onError:_159});return d;}},{name:"Read API: getFeatures()",runTest:function(t){var _15b=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var _15c=_15b.getFeatures();t.assertTrue(_15c["dojo.data.api.Read"]!==null);t.assertTrue(_15c["dojo.data.api.Identity"]!==null);}},{name:"Read API: fetch() patternMatch0",runTest:function(t){var _15d=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _15e=function(_15f,_160){t.assertEqual(_15f.length,5);var _161=true;for(var i=0;i<_15f.length;i++){var _162=_15d.getValue(_15f[i],"abbr");if(!(_162==="ec"||_162==="eg"||_162==="er"||_162==="ee"||_162==="et")){_161=false;break;}}t.assertTrue(_161);if(_161){d.callback(true);}else{d.errback(new Error("Unexpected abbreviation found, match failure."));}};var _163=function(_164,_165){t.assertTrue(false);d.errback(_164);};_15d.fetch({query:{abbr:"e*"},onComplete:_15e,onError:_163});return d;}},{name:"Read API: fetch() patternMatch0, complex",runTest:function(t){var _166=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _167=function(_168,_169){t.assertEqual(_168.length,5);var _16a=true;for(var i=0;i<_168.length;i++){var _16b=_166.getValue(_168[i],"abbr");if(!(_16b==="ec"||_16b==="eg"||_16b==="er"||_16b==="ee"||_16b==="et")){_16a=false;break;}}t.assertTrue(_16a);if(_16a){d.callback(true);}else{d.errback(new Error("Unexpected abbreviation found, match failure."));}};var _16c=function(_16d,_16e){t.assertTrue(false);d.errback(_16d);};_166.fetch({query:"abbr: \"e*\"",onComplete:_167,onError:_16c});return d;}},{name:"Read API: fetch() patternMatch1",runTest:function(t){var _16f=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"BaBaMaSaRa***Foo"},{uniqueId:7,value:"squawl"},{uniqueId:8,value:"seaweed"},{uniqueId:9,value:"jfq4@#!$!@Rf14r14i5u"}]}});var d=new doh.Deferred();var _170=function(_171,_172){t.assertEqual(_171.length,2);var _173=true;for(var i=0;i<_171.length;i++){var _174=_16f.getValue(_171[i],"value");if(!(_174==="bit$Bite"||_174==="jfq4@#!$!@Rf14r14i5u")){_173=false;break;}}t.assertTrue(_173);if(_173){d.callback(true);}else{d.errback(new Error("Unexpected pattern matched.  Filter failure."));}};var _175=function(_176,_177){t.assertTrue(false);d.errback(_176);};_16f.fetch({query:{value:"*$*"},onComplete:_170,onError:_175});return d;}},{name:"Read API: fetch() patternMatch1, complex",runTest:function(t){var _178=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"BaBaMaSaRa***Foo"},{uniqueId:7,value:"squawl"},{uniqueId:8,value:"seaweed"},{uniqueId:9,value:"jfq4@#!$!@Rf14r14i5u"}]}});var d=new doh.Deferred();var _179=function(_17a,_17b){t.assertEqual(_17a.length,2);var _17c=true;for(var i=0;i<_17a.length;i++){var _17d=_178.getValue(_17a[i],"value");if(!(_17d==="bit$Bite"||_17d==="jfq4@#!$!@Rf14r14i5u")){_17c=false;break;}}t.assertTrue(_17c);if(_17c){d.callback(true);}else{d.errback(new Error("Unexpected pattern matched.  Filter failure."));}};var _17e=function(_17f,_180){t.assertTrue(false);d.errback(_17f);};_178.fetch({query:"value: \"*$*\"",onComplete:_179,onError:_17e});return d;}},{name:"Read API: fetch() patternMatch2",runTest:function(t){var _181=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"BaBaMaSaRa***Foo"},{uniqueId:7,value:"squawl"},{uniqueId:8,value:"seaweed"},{uniqueId:9,value:"jfq4@#!$!@Rf14r14i5u"}]}});var d=new doh.Deferred();var _182=function(_183,_184){t.assertEqual(_183.length,1);var _185=true;for(var i=0;i<_183.length;i++){var _186=_181.getValue(_183[i],"value");if(!(_186==="bar*foo")){_185=false;break;}}t.assertTrue(_185);if(_185){d.callback(true);}else{d.errback(new Error("Unexpected abbreviation found, match failure."));}};var _187=function(_188,_189){t.assertTrue(false);d.errback(_188);};_181.fetch({query:{value:"bar\\*foo"},onComplete:_182,onError:_187});return d;}},{name:"Read API: fetch() patternMatch2, complex",runTest:function(t){var _18a=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"BaBaMaSaRa***Foo"},{uniqueId:7,value:"squawl"},{uniqueId:8,value:"seaweed"},{uniqueId:9,value:"jfq4@#!$!@Rf14r14i5u"}]}});var d=new doh.Deferred();var _18b=function(_18c,_18d){t.assertEqual(_18c.length,1);var _18e=true;for(var i=0;i<_18c.length;i++){var _18f=_18a.getValue(_18c[i],"value");if(!(_18f==="bar*foo")){_18e=false;break;}}t.assertTrue(_18e);if(_18e){d.callback(true);}else{d.errback(new Error("Unexpected abbreviation found, match failure."));}};var _190=function(_191,_192){t.assertTrue(false);d.errback(_191);};_18a.fetch({query:"value: \"bar\\*foo\"",onComplete:_18b,onError:_190});return d;}},{name:"Read API: fetch() patternMatch_caseSensitive",runTest:function(t){var _193=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"BAR*foo"},{uniqueId:4,value:"BARBananafoo"}]}});var d=new doh.Deferred();var _194=function(_195,_196){t.assertEqual(1,_195.length);var _197=true;for(var i=0;i<_195.length;i++){var _198=_193.getValue(_195[i],"value");if(!(_198==="bar*foo")){_197=false;break;}}t.assertTrue(_197);if(_197){d.callback(true);}else{d.errback(new Error("Unexpected pattern matched.  Filter failure."));}};var _199=function(_19a,_19b){t.assertTrue(false);d.errback(_19a);};_193.fetch({query:{value:"bar\\*foo"},queryOptions:{ignoreCase:false},onComplete:_194,onError:_199});return d;}},{name:"Read API: fetch() patternMatch_caseSensitive, complex",runTest:function(t){var _19c=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"BAR*foo"},{uniqueId:4,value:"BARBananafoo"}]}});var d=new doh.Deferred();var _19d=function(_19e,_19f){t.assertEqual(1,_19e.length);var _1a0=true;for(var i=0;i<_19e.length;i++){var _1a1=_19c.getValue(_19e[i],"value");if(!(_1a1==="bar*foo")){_1a0=false;break;}}t.assertTrue(_1a0);if(_1a0){d.callback(true);}else{d.errback(new Error("Unexpected pattern matched.  Filter failure."));}};var _1a2=function(_1a3,_1a4){t.assertTrue(false);d.errback(_1a3);};_19c.fetch({query:"value: \"bar\\*foo\"",queryOptions:{ignoreCase:false},onComplete:_19d,onError:_1a2});return d;}},{name:"Read API: fetch() patternMatch_caseInsensitive",runTest:function(t){var _1a5=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"BAR*foo"},{uniqueId:4,value:"BARBananafoo"}]}});var d=new doh.Deferred();var _1a6=function(_1a7,_1a8){t.assertEqual(_1a7.length,2);var _1a9=true;for(var i=0;i<_1a7.length;i++){var _1aa=_1a5.getValue(_1a7[i],"value");if(!(_1aa==="BAR*foo"||_1aa==="bar*foo")){_1a9=false;break;}}t.assertTrue(_1a9);if(_1a9){d.callback(true);}else{d.errback(new Error("Unexpected pattern matched.  Filter failure."));}};var _1ab=function(_1ac,_1ad){t.assertTrue(false);d.errback(_1ac);};_1a5.fetch({query:{value:"bar\\*foo"},queryOptions:{ignoreCase:true},onComplete:_1a6,onError:_1ab});return d;}},{name:"Read API: fetch() patternMatch_caseInsensitive, complex",runTest:function(t){var _1ae=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"BAR*foo"},{uniqueId:4,value:"BARBananafoo"}]}});var d=new doh.Deferred();var _1af=function(_1b0,_1b1){t.assertEqual(_1b0.length,2);var _1b2=true;for(var i=0;i<_1b0.length;i++){var _1b3=_1ae.getValue(_1b0[i],"value");if(!(_1b3==="BAR*foo"||_1b3==="bar*foo")){_1b2=false;break;}}t.assertTrue(_1b2);if(_1b2){d.callback(true);}else{d.errback(new Error("Unexpected pattern matched.  Filter failure."));}};var _1b4=function(_1b5,_1b6){t.assertTrue(false);d.errback(_1b5);};_1ae.fetch({query:"value: \"bar\\*foo\"",queryOptions:{ignoreCase:true},onComplete:_1af,onError:_1b4});return d;}},{name:"Read API: fetch() sortNumeric",runTest:function(t){var _1b7=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"fo|o*b.ar"},{uniqueId:1,value:"ba|r*foo"},{uniqueId:2,value:"boomBam"},{uniqueId:3,value:"bit$Bite"},{uniqueId:4,value:"ouagadogou"},{uniqueId:5,value:"jfq4@#!$!@|f1.$4r14i5u"},{uniqueId:6,value:"BaB{aMa|SaRa***F}oo"},{uniqueId:7,value:"squawl"},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"zulu"},{uniqueId:8,value:"seaweed"}]}});var d=new doh.Deferred();var _1b8=function(_1b9,_1ba){t.assertEqual(_1b9.length,11);var _1bb=true;for(var i=0;i<_1b9.length;i++){var _1bc=_1b7.getValue(_1b9[i],"value");if(!(_1b7.getValue(_1b9[i],"uniqueId")===i)){_1bb=false;break;}}t.assertTrue(_1bb);if(_1bb){d.callback(true);}else{d.errback(new Error("Unexpected sorting order found, sort failure."));}};var _1bd=function(_1be,_1bf){t.assertTrue(false);d.errback(_1be);};var _1c0=[{attribute:"uniqueId"}];_1b7.fetch({onComplete:_1b8,onError:_1bd,sort:_1c0});return d;}},{name:"Read API: fetch() sortNumericDescending",runTest:function(t){var _1c1=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"fo|o*b.ar"},{uniqueId:1,value:"ba|r*foo"},{uniqueId:2,value:"boomBam"},{uniqueId:3,value:"bit$Bite"},{uniqueId:4,value:"ouagadogou"},{uniqueId:5,value:"jfq4@#!$!@|f1.$4r14i5u"},{uniqueId:6,value:"BaB{aMa|SaRa***F}oo"},{uniqueId:7,value:"squawl"},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"zulu"},{uniqueId:8,value:"seaweed"}]}});var d=new doh.Deferred();var _1c2=function(_1c3,_1c4){t.assertEqual(_1c3.length,11);var _1c5=true;for(var i=0;i<_1c3.length;i++){var _1c6=_1c1.getValue(_1c3[i],"value");if(!((_1c3.length-(_1c1.getValue(_1c3[i],"uniqueId")+1))===i)){_1c5=false;break;}}t.assertTrue(_1c5);if(_1c5){d.callback(true);}else{d.errback(new Error("Unexpected sorting order found, sort failure."));}};var _1c7=function(_1c8,_1c9){t.assertTrue(false);d.errback(_1c8);};var _1ca=[{attribute:"uniqueId",descending:true}];_1c1.fetch({onComplete:_1c2,onError:_1c7,sort:_1ca});return d;}},{name:"Read API: fetch() sortNumericWithCount",runTest:function(t){var _1cb=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"fo|o*b.ar"},{uniqueId:1,value:"ba|r*foo"},{uniqueId:2,value:"boomBam"},{uniqueId:3,value:"bit$Bite"},{uniqueId:4,value:"ouagadogou"},{uniqueId:5,value:"jfq4@#!$!@|f1.$4r14i5u"},{uniqueId:6,value:"BaB{aMa|SaRa***F}oo"},{uniqueId:7,value:"squawl"},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"zulu"},{uniqueId:8,value:"seaweed"}]}});var d=new doh.Deferred();var _1cc=function(_1cd,_1ce){t.assertEqual(_1cd.length,5);var _1cf=10;var _1d0=true;for(var i=0;i<_1cd.length;i++){var _1d1=_1cb.getValue(_1cd[i],"value");if(!(_1cb.getValue(_1cd[i],"uniqueId")===_1cf)){_1d0=false;break;}_1cf--;}t.assertTrue(_1d0);if(_1d0){d.callback(true);}else{d.errback(new Error("Unexpected sorting order found, sort failure."));}};var _1d2=function(_1d3,_1d4){t.assertTrue(false);d.errback(_1d3);};var _1d5=[{attribute:"uniqueId",descending:true}];_1cb.fetch({onComplete:_1cc,onError:_1d2,sort:_1d5,count:5});return d;}},{name:"Read API: fetch() sortAlphabetic",runTest:function(t){var _1d6=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"abc"},{uniqueId:1,value:"bca"},{uniqueId:2,value:"abcd"},{uniqueId:3,value:"abcdefg"},{uniqueId:4,value:"lmnop"},{uniqueId:5,value:"foghorn"},{uniqueId:6,value:"qberty"},{uniqueId:7,value:"qwerty"},{uniqueId:8,value:""},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"123abc"}]}});var d=new doh.Deferred();var _1d7=function(_1d8,_1d9){var _1da=["","123abc","abc","abcd","abcdefg","bca","foghorn","lmnop","qberty","qwerty","seaweed"];t.assertEqual(_1d8.length,11);var _1db=true;for(var i=0;i<_1d8.length;i++){var _1dc=_1d6.getValue(_1d8[i],"value");if(!(_1d6.getValue(_1d8[i],"value")===_1da[i])){_1db=false;break;}}t.assertTrue(_1db);if(_1db){d.callback(true);}else{d.errback(new Error("Unexpected sorting order found, sort failure."));}};var _1dd=function(_1de,_1df){t.assertTrue(false);d.errback(_1de);};var _1e0=[{attribute:"value"}];_1d6.fetch({onComplete:_1d7,onError:_1dd,sort:_1e0});return d;}},{name:"Read API: fetch() sortAlphabeticDescending",runTest:function(t){var _1e1=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"abc"},{uniqueId:1,value:"bca"},{uniqueId:2,value:"abcd"},{uniqueId:3,value:"abcdefg"},{uniqueId:4,value:"lmnop"},{uniqueId:5,value:"foghorn"},{uniqueId:6,value:"qberty"},{uniqueId:7,value:"qwerty"},{uniqueId:8,value:""},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"123abc"}]}});var d=new doh.Deferred();var _1e2=function(_1e3,_1e4){var _1e5=["","123abc","abc","abcd","abcdefg","bca","foghorn","lmnop","qberty","qwerty","seaweed"];_1e5=_1e5.reverse();t.assertEqual(_1e3.length,11);var _1e6=true;for(var i=0;i<_1e3.length;i++){var _1e7=_1e1.getValue(_1e3[i],"value");if(!(_1e1.getValue(_1e3[i],"value")===_1e5[i])){_1e6=false;break;}}t.assertTrue(_1e6);if(_1e6){d.callback(true);}else{d.errback(new Error("Unexpected sorting order found, sort failure."));}};var _1e8=function(_1e9,_1ea){t.assertTrue(false);d.errback(_1e9);};var _1eb=[{attribute:"value",descending:true}];_1e1.fetch({onComplete:_1e2,onError:_1e8,sort:_1eb});return d;}},{name:"Read API: fetch() sortDate",runTest:function(t){var _1ec=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:0,value:new Date(0)},{uniqueId:1,value:new Date(100)},{uniqueId:2,value:new Date(1000)},{uniqueId:3,value:new Date(2000)},{uniqueId:4,value:new Date(3000)},{uniqueId:5,value:new Date(4000)},{uniqueId:6,value:new Date(5000)},{uniqueId:7,value:new Date(6000)},{uniqueId:8,value:new Date(7000)},{uniqueId:9,value:new Date(8000)},{uniqueId:10,value:new Date(9000)}]}});var d=new doh.Deferred();var _1ed=function(_1ee,_1ef){var _1f0=[0,100,1000,2000,3000,4000,5000,6000,7000,8000,9000];t.assertEqual(_1ee.length,11);var _1f1=true;for(var i=0;i<_1ee.length;i++){var _1f2=_1ec.getValue(_1ee[i],"value");if(!(_1ec.getValue(_1ee[i],"value").getTime()===_1f0[i])){_1f1=false;break;}}t.assertTrue(_1f1);if(_1f1){d.callback(true);}else{d.errback(new Error("Unexpected sorting order found, sort failure."));}};var _1f3=function(_1f4,_1f5){t.assertTrue(false);d.errback(_1f4);};var _1f6=[{attribute:"value"}];_1ec.fetch({onComplete:_1ed,onError:_1f3,sort:_1f6});return d;}},{name:"Read API: fetch() sortDateDescending",runTest:function(t){var _1f7=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:0,value:new Date(0)},{uniqueId:1,value:new Date(100)},{uniqueId:2,value:new Date(1000)},{uniqueId:3,value:new Date(2000)},{uniqueId:4,value:new Date(3000)},{uniqueId:5,value:new Date(4000)},{uniqueId:6,value:new Date(5000)},{uniqueId:7,value:new Date(6000)},{uniqueId:8,value:new Date(7000)},{uniqueId:9,value:new Date(8000)},{uniqueId:10,value:new Date(9000)}]}});var d=new doh.Deferred();var _1f8=function(_1f9,_1fa){var _1fb=[0,100,1000,2000,3000,4000,5000,6000,7000,8000,9000];_1fb=_1fb.reverse();t.assertEqual(_1f9.length,11);var _1fc=true;for(var i=0;i<_1f9.length;i++){var _1fd=_1f7.getValue(_1f9[i],"value");if(!(_1f7.getValue(_1f9[i],"value").getTime()===_1fb[i])){_1fc=false;break;}}t.assertTrue(_1fc);if(_1fc){d.callback(true);}else{d.errback(new Error("Unexpected sorting order found, sort failure."));}};var _1fe=function(_1ff,_200){t.assertTrue(false);d.errback(_1ff);};var _201=[{attribute:"value",descending:true}];_1f7.fetch({onComplete:_1f8,onError:_1fe,sort:_201});return d;}},{name:"Read API: fetch() sortMultiple",runTest:function(t){var _202=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"fo|o*b.ar"},{uniqueId:2,value:"ba|r*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"jfq4@#!$!@|f1.$4r14i5u"},{uniqueId:7,value:"BaB{aMa|SaRa***F}oo"},{uniqueId:8,value:"squawl"},{uniqueId:10,value:"seaweed"},{uniqueId:12,value:"seaweed"},{uniqueId:11,value:"zulu"},{uniqueId:9,value:"seaweed"}]}});var d=new doh.Deferred();var _203=function(_204,_205){var _206=[7,2,4,3,1,6,5,12,10,9,8,11];var _207=["BaB{aMa|SaRa***F}oo","ba|r*foo","bit$Bite","boomBam","fo|o*b.ar","jfq4@#!$!@|f1.$4r14i5u","ouagadogou","seaweed","seaweed","seaweed","squawl","zulu"];var _208=true;for(var i=0;i<_204.length;i++){var _209=_202.getValue(_204[i],"value");if(!((_202.getValue(_204[i],"uniqueId")===_206[i])&&(_202.getValue(_204[i],"value")===_207[i]))){_208=false;break;}}t.assertTrue(_208);if(_208){d.callback(true);}else{d.errback(new Error("Unexpected sorting order found, sort failure."));}};var _20a=function(_20b,_20c){t.assertTrue(false);d.errback(_20b);};var _20d=[{attribute:"value"},{attribute:"uniqueId",descending:true}];_202.fetch({onComplete:_203,onError:_20a,sort:_20d});return d;}},{name:"Read API: fetch() sortMultipleSpecialComparator",runTest:function(t){var _20e=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,status:"CLOSED"},{uniqueId:2,status:"OPEN"},{uniqueId:3,status:"PENDING"},{uniqueId:4,status:"BLOCKED"},{uniqueId:5,status:"CLOSED"},{uniqueId:6,status:"OPEN"},{uniqueId:7,status:"PENDING"},{uniqueId:8,status:"PENDING"},{uniqueId:10,status:"BLOCKED"},{uniqueId:12,status:"BLOCKED"},{uniqueId:11,status:"OPEN"},{uniqueId:9,status:"CLOSED"}]}});_20e.comparatorMap={};_20e.comparatorMap["status"]=function(a,b){var ret=0;var _20f={OPEN:3,BLOCKED:2,PENDING:1,CLOSED:0};if(_20f[a]>_20f[b]){ret=1;}if(_20f[a]<_20f[b]){ret=-1;}return ret;};var _210=[{attribute:"status",descending:true},{attribute:"uniqueId",descending:true}];var d=new doh.Deferred();var _211=function(_212,_213){var _214=[11,6,2,12,10,4,8,7,3,9,5,1];var _215=true;for(var i=0;i<_212.length;i++){var _216=_20e.getValue(_212[i],"value");if(!(_20e.getValue(_212[i],"uniqueId")===_214[i])){_215=false;break;}}t.assertTrue(_215);if(_215){d.callback(true);}else{d.errback(new Error("Unexpected sorting order found, sort failure."));}};var _217=function(_218,_219){t.assertTrue(false);d.errback(_218);};_20e.fetch({onComplete:_211,onError:_217,sort:_210});return d;}},{name:"Read API: fetch() sortAlphabeticWithUndefined",runTest:function(t){var _21a=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"abc"},{uniqueId:1,value:"bca"},{uniqueId:2,value:"abcd"},{uniqueId:3,value:"abcdefg"},{uniqueId:4,value:"lmnop"},{uniqueId:5,value:"foghorn"},{uniqueId:6,value:"qberty"},{uniqueId:7,value:"qwerty"},{uniqueId:8},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"123abc"}]}});var d=new doh.Deferred();var _21b=function(_21c,_21d){var _21e=[10,0,2,3,1,5,4,6,7,9,8];t.assertEqual(_21c.length,11);var _21f=true;for(var i=0;i<_21c.length;i++){if(!(_21a.getValue(_21c[i],"uniqueId")===_21e[i])){_21f=false;break;}}t.assertTrue(_21f);if(_21f){d.callback(true);}else{d.errback(new Error("Unexpected sorting order found, sort failure."));}};var _220=function(_221,_222){t.assertTrue(false);d.errback(_221);};var _223=[{attribute:"value"}];_21a.fetch({onComplete:_21b,onError:_220,sort:_223});return d;}},{name:"Read API: errorCondition_idCollision_inMemory",runTest:function(t){var _224=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:12345,value:"foo"},{uniqueId:123456,value:"bar"},{uniqueId:12345,value:"boom"},{uniqueId:123457,value:"bit"}]}});var d=new doh.Deferred();var _225=function(_226,_227){t.assertTrue(false);d.callback(false);};var _228=function(_229,_22a){t.assertTrue(true);d.callback(true);};_224.fetch({onComplete:_225,onError:_228});return d;}},{name:"Read API: errorCondition_idCollision_xhr",runTest:function(t){if(_1.isBrowser){var _22b=new _3.data.AndOrWriteStore({url:_1.moduleUrl("tests","data/countries_idcollision.json").toString()});var d=new doh.Deferred();var _22c=function(_22d,_22e){t.assertTrue(false);d.callback(false);};var _22f=function(_230,_231){t.assertTrue(true);d.callback(true);};_22b.fetch({onComplete:_22c,onError:_22f});return d;}}},{name:"Read API: Date_datatype",runTest:function(t){var _232=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries_withDates"));var d=new doh.Deferred();var _233=function(item){t.assertTrue(item!==null);var _234=_232.getValue(item,"independence");t.assertTrue(_234 instanceof Date);t.assertTrue(_1.date.stamp.toISOString(_234,{zulu:true})==="1993-05-24T00:00:00Z");d.callback(true);};var _235=function(_236){t.assertTrue(false);d.errback(_236);};_232.fetchItemByIdentity({identity:"er",onItem:_233,onError:_235});return d;}},{name:"Read API: custom_datatype_Color_SimpleMapping",runTest:function(t){var _237={identifier:"name",items:[{name:"Kermit",species:"frog",color:{_type:"Color",_value:"green"}},{name:"Beaker",hairColor:{_type:"Color",_value:"red"}}]};var _238=new _3.data.AndOrWriteStore({data:_237,typeMap:{"Color":_1.Color}});var d=new doh.Deferred();var _239=function(item){t.assertTrue(item!==null);var _23a=item;var _23b=_238.getValue(_23a,"hairColor");t.assertTrue(_23b instanceof _1.Color);t.assertTrue(_23b.toHex()=="#ff0000");d.callback(true);};var _23c=function(_23d){d.errback(_23d);};_238.fetchItemByIdentity({identity:"Beaker",onItem:_239,onError:_23c});return d;}},{name:"Read API: custom_datatype_Color_GeneralMapping",runTest:function(t){var _23e={identifier:"name",items:[{name:"Kermit",species:"frog",color:{_type:"Color",_value:"green"}},{name:"Beaker",hairColor:{_type:"Color",_value:"red"}}]};var _23f=new _3.data.AndOrWriteStore({data:_23e,typeMap:{"Color":{type:_1.Color,deserialize:function(_240){return new _1.Color(_240);}}}});var d=new doh.Deferred();var _241=function(item){t.assertTrue(item!==null);var _242=item;var _243=_23f.getValue(_242,"hairColor");t.assertTrue(_243 instanceof _1.Color);t.assertTrue(_243.toHex()=="#ff0000");d.callback(true);};var _244=function(_245){d.errback(_245);};_23f.fetchItemByIdentity({identity:"Beaker",onItem:_241,onError:_244});return d;}},{name:"Read API: hierarchical_data",runTest:function(t){var _246=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("geography_hierarchy_small"));var d=new doh.Deferred();var _247=function(_248,_249){t.assertEqual(_248.length,1);var _24a=_248[0];var _24b=_246.getValue(_24a,"countries");var _24c=_246.getValue(_24b,"cities");t.assertEqual(_246.getValue(_24b,"name"),"Canada");t.assertEqual(_246.getValue(_24c,"name"),"Toronto");d.callback(true);};var _24d=function(_24e){d.errback(_24e);};_246.fetch({query:{name:"North America"},onComplete:_247,onError:_24d});return d;}},{name:"Read API: hierarchical_data, complex",runTest:function(t){var _24f=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("geography_hierarchy_small"));var d=new doh.Deferred();var _250=function(_251,_252){t.assertEqual(_251.length,1);var _253=_251[0];var _254=_24f.getValue(_253,"countries");var _255=_24f.getValue(_254,"cities");t.assertEqual(_24f.getValue(_254,"name"),"Canada");t.assertEqual(_24f.getValue(_255,"name"),"Toronto");d.callback(true);};var _256=function(_257){d.errback(_257);};_24f.fetch({query:"name: \"North America\"",onComplete:_250,onError:_256});return d;}},{name:"Identity API: no_identifier_specified",runTest:function(t){var _258=[{name:"Kermit",color:"green"},{name:"Miss Piggy",likes:"Kermit"},{name:"Beaker",hairColor:"red"}];var _259=new _3.data.AndOrWriteStore({data:{items:_258}});var d=new doh.Deferred();var _25a=function(_25b,_25c){var _25d=_259.getFeatures();var _25e=Boolean(_25d["dojo.data.api.Identity"]);t.assertTrue(_25e);for(var i=0;i<_25b.length;++i){var item=_25b[i];var _25f=_259.getIdentityAttributes(item);t.assertTrue(_25f===null);var _260=_259.getIdentity(item);t.assertTrue(typeof _260=="number");}d.callback(true);};var _261=function(_262,_263){d.errback(true);};_259.fetch({onComplete:_25a,onError:_261});return d;}},{name:"Identity API: hierarchical_data",runTest:function(t){var _264=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("geography_hierarchy_small"));var d=new doh.Deferred();var _265=function(_266,_267){var _268=_264.getFeatures();var _269=Boolean(_268["dojo.data.api.Identity"]);t.assertTrue(_269);for(var i=0;i<_266.length;++i){var item=_266[i];var _26a=_264.getIdentityAttributes(item);t.assertTrue(_26a===null);var _26b=_264.getIdentity(item);t.assertTrue(typeof _26b=="number");}d.callback(true);};var _26c=function(_26d,_26e){d.errback(true);};_264.fetch({onComplete:_265,onError:_26c});return d;}},{name:"Read API: functionConformance",runTest:function(t){var _26f=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var _270=new _1.data.api.Read();var _271=true;for(var i in _270){if(i.toString().charAt(0)!=="_"){var _272=_270[i];if(typeof _272==="function"){var _273=_26f[i];if(!(typeof _273==="function")){_271=false;break;}}}}t.assertTrue(_271);}},{name:"Identity API: functionConformance",runTest:function(t){var _274=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var _275=new _1.data.api.Identity();var _276=true;for(var i in _275){if(i.toString().charAt(0)!=="_"){var _277=_275[i];if(typeof _277==="function"){var _278=_274[i];if(!(typeof _278==="function")){_276=false;break;}}}}t.assertTrue(_276);}},{name:"Read API: fetch() multiple, OR, complex",runTest:function(t){var _279=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _27a=function(_27b,_27c){t.assertEqual(_27b.length,3);d.callback(true);};var _27d=function(_27e,_27f){t.assertTrue(false);d.errback(_27e);};_279.fetch({query:"abbr: \"s*\" || capital:\"A*\"",onComplete:_27a,onError:_27d});return d;}},{name:"Read API: fetch() multiple, AND(OR, complex",runTest:function(t){var _280=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _281=function(_282,_283){t.assertEqual(_282.length,3);d.callback(true);};var _284=function(_285,_286){t.assertTrue(false);d.errback(_285);};_280.fetch({query:"abbr: \"e*\" AND (capital:\"A*\" or capital: \"Q*\")",onComplete:_281,onError:_284});return d;}},{name:"Read API: fetch() multiple, AND/OR, as json object, complex",runTest:function(t){var _287=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _288=function(_289,_28a){t.assertEqual(_289.length,3);d.callback(true);};var _28b=function(_28c,_28d){t.assertTrue(false);d.errback(_28c);};_287.fetch({query:{complexQuery:"abbr: \"e*\" AND (capital:\"A*\" or capital: \"Q*\")"},onComplete:_288,onError:_28b});return d;}},{name:"Read API: fetch() multiple, AND/OR, as json object, complex, with extra attrs",runTest:function(t){var _28e=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _28f=function(_290,_291){t.assertEqual(_290.length,1);d.callback(true);};var _292=function(_293,_294){t.assertTrue(false);d.errback(_293);};_28e.fetch({query:{complexQuery:"abbr: \"e*\" AND (capital:\"A*\" or capital: \"Q*\")",name:"Ec*"},onComplete:_28f,onError:_292});return d;}},{name:"Read API: fetch() multiple, AND/OR, as json object, complex, with extra attrs and spaces",runTest:function(t){var _295=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _296=function(_297,_298){try{t.assertEqual(_297.length,1);t.assertEqual("Equatorial Guinea",_295.getValue(_297[0],"name"));d.callback(true);}catch(e){d.errback(e);}};var _299=function(_29a,_29b){d.errback(_29a);};_295.fetch({query:{complexQuery:"abbr: \"g*\" AND (capital:\"A*\" or capital: \"M*\")",name:"Equatorial G*"},onComplete:_296,onError:_299});return d;}},{name:"Read API: fetch() multiple, AND/OR, as quoted json object, complex",runTest:function(t){var _29c=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _29d=function(_29e,_29f){t.assertEqual(_29e.length,3);d.callback(true);};var _2a0=function(_2a1,_2a2){t.assertTrue(false);d.errback(_2a1);};_29c.fetch({query:"{complexQuery:'abbr: \"e*\" AND (capital:\"A*\" or capital: \"Q*\")'}",onComplete:_29d,onError:_2a0});return d;}},{name:"Read API: close (clearOnClose: true, reset url.)",runTest:function(t){if(_1.isBrowser){var _2a3=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));_2a3.clearOnClose=true;_2a3.urlPreventCache=true;var d=new doh.Deferred();function _2a4(item){var _2a5=null;try{t.assertTrue(item!==null);var ec=item;var val=_2a3.getValue(ec,"name");t.assertEqual("Ecuador",val);_2a3.close();t.assertTrue(_2a3._arrayOfAllItems.length===0);t.assertTrue(_2a3._loadFinished===false);_2a3.url=_1.moduleUrl("dojox","data/tests/stores/countries_withNull.json").toString();function _2a6(item){var err;try{t.assertTrue(item!==null);var val=_2a3.getValue(item,"name");t.assertEqual(null,val);}catch(e){err=e;}if(err){d.errback(err);}else{d.callback(true);}};_2a3.fetchItemByIdentity({identity:"ec",onItem:_2a6,onError:_2a7});}catch(e){_2a5=e;}if(_2a5){d.errback(_2a5);}};function _2a7(_2a8){d.errback(_2a8);};_2a3.fetchItemByIdentity({identity:"ec",onItem:_2a4,onError:_2a7});return d;}}},{name:"Read API: fetch, close (clearOnClose: true, reset url.)",runTest:function(t){if(_1.isBrowser){var _2a9=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));_2a9.clearOnClose=true;_2a9.urlPreventCache=true;var d=new doh.Deferred();function _2aa(item){var _2ab=null;try{t.assertTrue(item!==null);var ec=item;var val=_2a9.getValue(ec,"name");t.assertEqual("Ecuador",val);_2a9.close();t.assertTrue(_2a9._arrayOfAllItems.length===0);t.assertTrue(_2a9._loadFinished===false);_2a9.url=_1.moduleUrl("dojox","data/tests/stores/countries_withNull.json").toString();function _2ac(_2ad){var err;try{t.assertEqual(1,_2ad.length);var item=_2ad[0];t.assertTrue(item!==null);var val=_2a9.getValue(item,"name");t.assertEqual(null,val);}catch(e){err=e;}if(err){d.errback(err);}else{d.callback(true);}};_2a9.fetch({query:{abbr:"ec"},onComplete:_2ac,onError:_2ae});}catch(e){_2ab=e;}if(_2ab){d.errback(_2ab);}};function _2ae(_2af){d.errback(_2af);};_2a9.fetchItemByIdentity({identity:"ec",onItem:_2aa,onError:_2ae});return d;}}},{name:"Read API: close (clearOnClose: true, reset _jsonFileUrl.)",runTest:function(t){if(_1.isBrowser){var _2b0=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));_2b0.clearOnClose=true;_2b0.urlPreventCache=true;var d=new doh.Deferred();function _2b1(item){var _2b2=null;try{t.assertTrue(item!==null);var ec=item;var val=_2b0.getValue(ec,"name");t.assertEqual("Ecuador",val);_2b0.close();t.assertTrue(_2b0._arrayOfAllItems.length===0);t.assertTrue(_2b0._loadFinished===false);_2b0._jsonFileUrl=_1.moduleUrl("dojox","data/tests/stores/countries_withNull.json").toString();function _2b3(item){var err;try{t.assertTrue(item!==null);var val=_2b0.getValue(item,"name");t.assertEqual(null,val);}catch(e){err=e;}if(err){d.errback(err);}else{d.callback(true);}};_2b0.fetchItemByIdentity({identity:"ec",onItem:_2b3,onError:_2b4});}catch(e){_2b2=e;}if(_2b2){d.errback(_2b2);}};function _2b4(_2b5){d.errback(_2b5);};_2b0.fetchItemByIdentity({identity:"ec",onItem:_2b1,onError:_2b4});return d;}}},{name:"Read API: close (clearOnClose: true, reset data.)",runTest:function(t){var _2b6=new _3.data.AndOrWriteStore({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"BaBaMaSaRa***Foo"},{uniqueId:7,value:"squawl"},{uniqueId:8,value:"seaweed"},{uniqueId:9,value:"jfq4@#!$!@Rf14r14i5u"}]}});var d=new doh.Deferred();var _2b7=function(_2b8,_2b9){t.assertEqual(_2b8.length,1);var _2ba=_2b8[0];_2b6.clearOnClose=true;_2b6.data={identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"BaBaMaSaRa***Foo"},{uniqueId:7,value:"squawl"},{uniqueId:8,value:"seaweed"},{uniqueId:9,value:"jfq4@#!$!@Rf14r14i5u"}]};_2b6.close();var _2bb=function(_2bc,_2bd){try{t.assertEqual(_2bc.length,1);var _2be=_2bc[0];t.assertTrue(_2ba!=null);t.assertTrue(_2be!=null);t.assertTrue(_2ba!=_2be);d.callback(true);}catch(e){d.errback(e);}};_2b6.fetch({query:{value:"bar*foo"},onComplete:_2bb,onError:_2bf});};function _2bf(_2c0,_2c1){t.assertTrue(false);d.errback(_2c0);};_2b6.fetch({query:{value:"bar*foo"},onComplete:_2b7,onError:_2bf});return d;}},{name:"Write API:  getFeatures",runTest:function(t){var _2c2=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var _2c3=_2c2.getFeatures();t.assertTrue(_2c3["dojo.data.api.Read"]!==null);t.assertTrue(_2c3["dojo.data.api.Identity"]!==null);t.assertTrue(_2c3["dojo.data.api.Write"]!==null);t.assertTrue(_2c3["dojo.data.api.Notification"]!==null);t.assertFalse(_2c3["iggy"]);var _2c4=0;for(var i in _2c3){t.assertTrue((i==="dojo.data.api.Read"||i==="dojo.data.api.Identity"||i==="dojo.data.api.Write"||i==="dojo.data.api.Notification"));_2c4++;}t.assertEqual(_2c4,4);}},{name:"Write API:  setValue",runTest:function(t){var _2c5=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _2c6=function(_2c7,_2c8){t.assertEqual(1,_2c7.length);var item=_2c7[0];t.assertTrue(_2c5.containsValue(item,"capital","Cairo"));t.assertEqual(_2c5.isDirty(item),false);t.assertTrue(_2c5.isDirty(item)===false);t.assertFalse(_2c5.isDirty());t.assertTrue(_2c5.isDirty(item)===false);t.assertTrue(!_2c5.isDirty());_2c5.setValue(item,"capital","New Cairo");t.assertTrue(_2c5.isDirty(item));t.assertTrue(_2c5.isDirty());t.assertEqual(_2c5.getValue(item,"capital").toString(),"New Cairo");d.callback(true);};var _2c9=function(_2ca,_2cb){d.errback(_2ca);};_2c5.fetch({query:{name:"Egypt"},onComplete:_2c6,onError:_2c9});return d;}},{name:"Write API: setValues",runTest:function(t){var _2cc=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _2cd=function(_2ce,_2cf){t.assertEqual(1,_2ce.length);var item=_2ce[0];t.assertTrue(_2cc.containsValue(item,"name","Egypt"));t.assertTrue(_2cc.isDirty(item)===false);t.assertTrue(!_2cc.isDirty());_2cc.setValues(item,"name",["Egypt 1","Egypt 2"]);t.assertTrue(_2cc.isDirty(item));t.assertTrue(_2cc.isDirty());var _2d0=_2cc.getValues(item,"name");t.assertTrue(_2d0[0]=="Egypt 1");t.assertTrue(_2d0[1]=="Egypt 2");d.callback(true);};var _2d1=function(_2d2,_2d3){d.errback(_2d2);};_2cc.fetch({query:{name:"Egypt"},onComplete:_2cd,onError:_2d1});return d;}},{name:"Write API: unsetAttribute",runTest:function(t){var _2d4=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _2d5=function(_2d6,_2d7){t.assertEqual(1,_2d6.length);var item=_2d6[0];t.assertTrue(_2d4.containsValue(item,"name","Egypt"));t.assertTrue(_2d4.isDirty(item)===false);t.assertTrue(!_2d4.isDirty());_2d4.unsetAttribute(item,"name");t.assertTrue(_2d4.isDirty(item));t.assertTrue(_2d4.isDirty());t.assertTrue(!_2d4.hasAttribute(item,"name"));d.callback(true);};var _2d8=function(_2d9,_2da){d.errback(_2d9);};_2d4.fetch({query:{name:"Egypt"},onComplete:_2d5,onError:_2d8});return d;}},{name:"Write API: newItem",runTest:function(t){var _2db=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();t.assertTrue(!_2db.isDirty());var _2dc=false;_2db.onNew=function(_2dd,_2de){t.assertTrue(_2dd!==null);t.assertTrue(_2de===null);t.assertTrue(_2db.isItem(_2dd));_2dc=true;};var _2df=_2db.newItem({name:"Canada",abbr:"ca",capital:"Ottawa"});t.assertTrue(_2dc);t.assertTrue(_2db.isDirty(_2df));t.assertTrue(_2db.isDirty());t.assertTrue(_2db.getValues(_2df,"name")=="Canada");var _2e0=function(_2e1,_2e2){t.assertEqual(1,_2e1.length);var item=_2e1[0];t.assertTrue(_2db.containsValue(item,"name","Canada"));d.callback(true);};var _2e3=function(_2e4,_2e5){d.errback(_2e4);};_2db.fetch({query:{name:"Canada"},onComplete:_2e0,onError:_2e3});return d;}},{name:"Write API: newItem with a parent assignment",runTest:function(t){var _2e6=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();t.assertTrue(!_2e6.isDirty());var _2e7=function(_2e8,_2e9){d.errback(_2e8);};var _2ea=function(_2eb,_2ec){t.assertEqual(1,_2eb.length);var item=_2eb[0];t.assertTrue(_2e6.containsValue(item,"name","Egypt"));var _2ed=false;_2e6.onNew=function(_2ee,_2ef){t.assertEqual(item,_2ef.item);t.assertEqual("cities",_2ef.attribute);t.assertTrue(_2ef.oldValue===undefined);t.assertTrue(_2ef.newValue===_2ee);_2ed=true;};_2e6.onSet=function(item,_2f0,_2f1,_2f2){t.assertTrue(false);};var _2f3=_2e6.newItem({name:"Cairo",abbr:"Cairo"},{parent:item,attribute:"cities"});t.assertTrue(_2ed);var _2f4=function(_2f5,_2f6){t.assertEqual(0,_2f5.length);var _2f7=function(_2f8,_2f9){t.assertEqual(1,_2f8.length);var item=_2f8[0];t.assertEqual("Cairo",_2e6.getValue(item,"name"));d.callback(true);};_2e6.fetch({query:{name:"Cairo"},onComplete:_2f7,onError:_2e7,queryOptions:{deep:true}});};_2e6.fetch({query:{name:"Cairo"},onComplete:_2f4,onError:_2e7});};_2e6.fetch({query:{name:"Egypt"},onComplete:_2ea,onError:_2e7});return d;}},{name:"Write API: newItem with a parent assignment multiple times",runTest:function(t){var _2fa=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();t.assertTrue(!_2fa.isDirty());var _2fb=function(_2fc,_2fd){t.assertEqual(1,_2fc.length);var item=_2fc[0];t.assertTrue(_2fa.containsValue(item,"name","Egypt"));_2fa.onNew=function(_2fe,_2ff){t.assertEqual(item,_2ff.item);t.assertEqual("cities",_2ff.attribute);t.assertTrue(_2ff.oldValue===undefined);t.assertTrue(_2ff.newValue===_2fe);};var _300=_2fa.newItem({name:"Cairo",abbr:"Cairo"},{parent:item,attribute:"cities"});_2fa.onNew=function(_301,_302){t.assertEqual(item,_302.item);t.assertEqual("cities",_302.attribute);t.assertTrue(_302.oldValue==_300);t.assertTrue(_302.newValue[0]==_300);t.assertTrue(_302.newValue[1]==_301);};var _303=_2fa.newItem({name:"Banha",abbr:"Banha"},{parent:item,attribute:"cities"});_2fa.onNew=function(_304,_305){t.assertEqual(item,_305.item);t.assertEqual("cities",_305.attribute);t.assertTrue(_305.oldValue[0]==_300);t.assertTrue(_305.oldValue[1]==_303);t.assertTrue(_305.newValue[0]==_300);t.assertTrue(_305.newValue[1]==_303);t.assertTrue(_305.newValue[2]==_304);};var _306=_2fa.newItem({name:"Damanhur",abbr:"Damanhur"},{parent:item,attribute:"cities"});d.callback(true);};var _307=function(_308,_309){d.errback(_308);};_2fa.fetch({query:{name:"Egypt"},onComplete:_2fb,onError:_307});return d;}},{name:"Write API: deleteItem",runTest:function(t){var _30a=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _30b=function(_30c,_30d){d.errback(_30c);};var _30e=function(_30f,_310){t.assertEqual(1,_30f.length);var item=_30f[0];t.assertTrue(_30a.containsValue(item,"name","Egypt"));t.assertTrue(_30a.isDirty(item)===false);t.assertTrue(!_30a.isDirty());_30a.deleteItem(item);t.assertTrue(_30a.isDirty(item));t.assertTrue(_30a.isDirty());var _311=function(_312,_313){t.assertEqual(0,_312.length);d.callback(true);};_30a.fetch({query:{name:"Egypt"},onComplete:_311,onError:_30b});};_30a.fetch({query:{name:"Egypt"},onComplete:_30e,onError:_30b});return d;}},{name:"Write API: isDirty",runTest:function(t){var _314=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _315=function(_316,_317){t.assertEqual(1,_316.length);var item=_316[0];t.assertTrue(_314.containsValue(item,"name","Egypt"));_314.setValue(item,"name","Egypt 2");t.assertTrue(_314.getValue(item,"name")=="Egypt 2");t.assertTrue(_314.isDirty(item));d.callback(true);};var _318=function(_319,_31a){d.errback(_319);};_314.fetch({query:{name:"Egypt"},onComplete:_315,onError:_318});return d;}},{name:"Write API: revert",runTest:function(t){var _31b=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _31c=function(_31d,_31e){d.errback(_31d);};var _31f=function(_320,_321){t.assertEqual(1,_320.length);var item=_320[0];t.assertTrue(_31b.containsValue(item,"name","Egypt"));t.assertTrue(_31b.isDirty(item)===false);t.assertTrue(!_31b.isDirty());_31b.setValue(item,"name","Egypt 2");t.assertTrue(_31b.getValue(item,"name")=="Egypt 2");t.assertTrue(_31b.isDirty(item));t.assertTrue(_31b.isDirty());_31b.revert();var _322=function(_323,_324){t.assertEqual(1,_323.length);var _325=_323[0];t.assertTrue(_31b.containsValue(_325,"name","Egypt"));d.callback(true);};_31b.fetch({query:{name:"Egypt"},onComplete:_322,onError:_31c});};_31b.fetch({query:{name:"Egypt"},onComplete:_31f,onError:_31c});return d;}},{name:"Write API: save",runTest:function(t){var _326=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _327=function(_328){d.errback(_328);};var _329=function(item){_326.setValue(item,"capital","New Cairo");var _32a=function(){d.callback(true);};_326.save({onComplete:_32a,onError:_327});};_326.fetchItemByIdentity({identity:"eg",onItem:_329,onError:_327});return d;}},{name:"Write API: save, verify state",runTest:function(t){var _32b=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _32c=function(_32d){d.errback(_32d);};var _32e=function(item){_32b.setValue(item,"capital","New Cairo");var _32f=function(){t.assertTrue(!_32b._saveInProgress);d.callback(true);};_32b.save({onComplete:_32f,onError:_32c});};_32b.fetchItemByIdentity({identity:"eg",onItem:_32e,onError:_32c});return d;}},{name:"Write API: saveEverything",runTest:function(t){var _330=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var _331;var d=new doh.Deferred();var _332=function(_333){d.errback(_333);};_330._saveEverything=function(_334,_335,_336){var _337=_1.fromJson(_336);t.assertEqual(_337.identifier,_330.getIdentityAttributes(_331)[0]);t.assertEqual(_337.label,_330.getLabelAttributes(_331)[0]);t.assertEqual(_337.items.length,7);var _338=new _3.data.AndOrWriteStore({data:_337});var _339=function(_33a){var _33b=_33a;t.assertEqual(_330.getIdentityAttributes(_331)[0],_338.getIdentityAttributes(_33b)[0]);t.assertEqual(_330.getLabelAttributes(_331)[0],_338.getLabelAttributes(_33b)[0]);t.assertEqual(_330.getValue(_331,"name"),_338.getValue(_33b,"name"));};_338.fetchItemByIdentity({identity:"eg",onItem:_339,onError:_332});_334();};var _33c=function(item){_331=item;var _33d=function(){d.callback(true);};_330.setValue(_331,"capital","New Cairo");_330.save({onComplete:_33d,onError:_332});};_330.fetchItemByIdentity({identity:"eg",onItem:_33c,onError:_332});return d;}},{name:"Write API: saveEverything with Date type",runTest:function(t){var _33e=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();_33e._saveEverything=function(_33f,_340,_341){var _342=_1.fromJson(_341);var _343=new _3.data.AndOrWriteStore({data:_342});var _344=function(item){var _345=_343.getValue(item,"independence");t.assertTrue(_345 instanceof Date);t.assertTrue(_1.date.compare(new Date(1993,4,24),_345,"date")===0);_33f();};var _346=function(_347,_348){d.errback(_347);_340();};_343.fetchItemByIdentity({identity:"eg",onItem:_344,onError:_346});};var _349=function(_34a){d.errback(_34a);};var _34b=function(item){var _34c=function(){d.callback(true);};_33e.setValue(item,"independence",new Date(1993,4,24));_33e.save({onComplete:_34c,onError:_349});};_33e.fetchItemByIdentity({identity:"eg",onItem:_34b,onError:_349});return d;}},{name:"Write API: saveEverything, with custom color simple type",runTest:function(t){var _34d={identifier:"name",items:[{name:"Kermit",species:"frog",color:{_type:"Color",_value:"green"}},{name:"Beaker",hairColor:{_type:"Color",_value:"red"}}]};var _34e={"Color":_1.Color};var _34f=new _3.data.AndOrWriteStore({data:_34d,typeMap:_34e});var d=new doh.Deferred();_34f._saveEverything=function(_350,_351,_352){var _353=_1.fromJson(_352);var _354=new _3.data.AndOrWriteStore({data:_353,typeMap:_34e});var _355=function(item){var _356=_354.getValue(item,"hairColor");t.assertTrue(_356 instanceof _1.Color);t.assertEqual("rgba(255, 255, 0, 1)",_356.toString());_350();};var _357=function(_358,_359){d.errback(_358);_351();};_354.fetchItemByIdentity({identity:"Animal",onItem:_355,onError:_357});};var _35a=function(_35b){d.errback(_35b);};var _35c=function(){d.callback(true);};var _35d=_34f.newItem({name:"Animal",hairColor:new _1.Color("yellow")});_34f.save({onComplete:_35c,onError:_35a});return d;}},{name:"Write API: saveEverything, with custom color type general",runTest:function(t){var _35e={identifier:"name",items:[{name:"Kermit",species:"frog",color:{_type:"Color",_value:"green"}},{name:"Beaker",hairColor:{_type:"Color",_value:"red"}}]};var _35f={"Color":{type:_1.Color,deserialize:function(_360){return new _1.Color(_360);},serialize:function(obj){return obj.toString();}}};var _361=new _3.data.AndOrWriteStore({data:_35e,typeMap:_35f});var d=new doh.Deferred();_361._saveEverything=function(_362,_363,_364){var _365=_1.fromJson(_364);var _366=new _3.data.AndOrWriteStore({data:_365,typeMap:_35f});var _367=function(item){var _368=_366.getValue(item,"hairColor");t.assertTrue(_368 instanceof _1.Color);t.assertEqual("rgba(255, 255, 0, 1)",_368.toString());_362();};var _369=function(_36a,_36b){d.errback(_36a);_363();};_366.fetchItemByIdentity({identity:"Animal",onItem:_367,onError:_369});};var _36c=function(_36d){d.errback(_36d);};var _36e=function(){d.callback(true);};var _36f=_361.newItem({name:"Animal",hairColor:new _1.Color("yellow")});_361.save({onComplete:_36e,onError:_36c});return d;}},{name:"Write API: newItem, revert",runTest:function(t){var args={data:{label:"name",items:[{name:"Ecuador",capital:"Quito"},{name:"Egypt",capital:"Cairo"},{name:"El Salvador",capital:"San Salvador"},{name:"Equatorial Guinea",capital:"Malabo"},{name:"Eritrea",capital:"Asmara"},{name:"Estonia",capital:"Tallinn"},{name:"Ethiopia",capital:"Addis Ababa"}]}};var _370=new _3.data.AndOrWriteStore(args);var _371=_370.newItem({name:"Utopia",capitol:"Perfect"});var _372=_371[_370._itemNumPropName];t.assertTrue(_370._arrayOfAllItems[_372]===_371);_370.revert();t.assertTrue(_370._arrayOfAllItems[_372]===null);}},{name:"Write API: newItem, modify revert",runTest:function(){var _373=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var _374=new doh.Deferred();doh.assertTrue(!_373.isDirty());var _375=function(_376,_377){_374.errback(_376);};var _378=function(_379,_37a){var _37b=_379.length;var _37c=_373.newItem({name:"Canada",abbr:"ca",capital:"Ottawa"});_373.setValue(_37c,"someattribute","modified a new item!");var _37d=function(_37e,_37f){var _380=_37e.length;doh.assertEqual(_380,(_37b+1));_373.revert();var _381=function(_382,_383){var _384=_382.length;doh.assertEqual(_384,_37b);_374.callback(true);};_373.fetch({onComplete:_381,onError:_375});};_373.fetch({onComplete:_37d,onError:_375});};_373.fetch({onComplete:_378,onError:_375});return _374;}},{name:"Write API: newItem, modify, delete, revert",runTest:function(){var _385=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var i;var _386=false;var _387=new doh.Deferred();doh.assertTrue(!_385.isDirty());var _388=function(_389,_38a){_387.errback(_389);};var _38b=function(_38c,_38d){var _38e=_38c.length;var _38f=_385.newItem({name:"Canada",abbr:"ca",capital:"Ottawa"});_385.setValue(_38f,"someattribute","modified a new item!");var _390=function(_391,_392){var _393=_391.length;doh.assertEqual(_393,(_38e+1));_385.deleteItem(_38f);var _394=function(_395,_396){var _397=_395.length;doh.assertEqual(_38e,_397);for(i=0;i<_395.length;i++){_386=(_385.getIdentity(_395[i])==="ca");if(_386){break;}}if(_386){_387.errback(new Error("Error: Found the supposedly deleted item!"));}else{_385.revert();var _398=function(_399,_39a){var _39b=_399.length;doh.assertEqual(_39b,_38e);for(i=0;i<_399.length;i++){_386=(_385.getIdentity(_399[i])==="ca");if(_386){break;}}if(_386){_387.errback(new Error("Error: Found the 'new' item after revert!"));}else{_387.callback(true);}};_385.fetch({onComplete:_398,onError:_388});}};_385.fetch({onComplete:_394,onError:_388});};_385.fetch({onComplete:_390,onError:_388});};_385.fetch({onComplete:_38b,onError:_388});return _387;}},{name:"Write API: onSet notification",runTest:function(t){var _39c=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _39d=function(_39e){d.errback(_39e);};var _39f=function(_3a0){var _3a1=_3a0;var _3a2=null;var _3a3=function(item,_3a4,_3a5,_3a6){t.assertTrue(_39c.isItem(item));t.assertTrue(item==_3a1);t.assertTrue(_3a4=="capital");t.assertTrue(_3a5=="Cairo");t.assertTrue(_3a6=="New Cairo");d.callback(true);_1.disconnect(_3a2);};_3a2=_1.connect(_39c,"onSet",_3a3);_39c.setValue(_3a1,"capital","New Cairo");};_39c.fetchItemByIdentity({identity:"eg",onItem:_39f,onError:_39d});}},{name:"Write API: onNew notification",runTest:function(t){var _3a7=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _3a8=null;var _3a9=function(item){t.assertTrue(_3a7.isItem(item));t.assertTrue(_3a7.getValue(item,"name")=="Canada");d.callback(true);_1.disconnect(_3a8);};_3a8=_1.connect(_3a7,"onNew",_3a9);var _3aa=_3a7.newItem({name:"Canada",abbr:"ca",capital:"Ottawa"});}},{name:"Write API: onDelete notification",runTest:function(t){var _3ab=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var d=new doh.Deferred();var _3ac=function(_3ad){d.errback(_3ad);};var _3ae=function(_3af){var _3b0=_3af;var _3b1=null;var _3b2=function(item){t.assertTrue(_3ab.isItem(item)===false);t.assertTrue(item==_3b0);d.callback(true);_1.disconnect(_3b1);};_3b1=_1.connect(_3ab,"onDelete",_3b2);_3ab.deleteItem(_3b0);};_3ab.fetchItemByIdentity({identity:"eg",onItem:_3ae,onError:_3ac});}},{name:"Write API: Read API conformance",runTest:function(t){var _3b3=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var _3b4=new _1.data.api.Read();var _3b5=true;for(var _3b6 in _3b4){var _3b7=_3b4[_3b6];if(typeof _3b7==="function"){var _3b8=_3b3[_3b6];if(!(typeof _3b8==="function")){_3b5=false;break;}}}t.assertTrue(_3b5);}},{name:"Write API: Write API conformance",runTest:function(t){var _3b9=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var _3ba=new _1.data.api.Write();var _3bb=true;for(var _3bc in _3ba){var _3bd=_3ba[_3bc];if(typeof _3bd==="function"){var _3be=_3b9[_3bc];if(!(typeof _3be==="function")){_3bb=false;break;}}}t.assertTrue(_3bb);}},{name:"Write API: Notification API conformance",runTest:function(t){var _3bf=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries"));var api=new _1.data.api.Notification();var _3c0=true;for(var _3c1 in api){var _3c2=api[_3c1];if(typeof _3c2==="function"){var _3c3=_3bf[_3c1];if(!(typeof _3c3==="function")){_3c0=false;break;}}}t.assertTrue(_3c0);}},{name:"Write API: Identity, auto-creation when missing",runTest:function(t){var args={data:{label:"name",items:[{name:"Ecuador",capital:"Quito"},{name:"Egypt",capital:"Cairo"},{name:"El Salvador",capital:"San Salvador"},{name:"Equatorial Guinea",capital:"Malabo"},{name:"Eritrea",capital:"Asmara"},{name:"Estonia",capital:"Tallinn"},{name:"Ethiopia",capital:"Addis Ababa"}]}};var _3c4=new _3.data.AndOrWriteStore(args);var d=new doh.Deferred();var _3c5=function(_3c6,_3c7){d.errback(_3c6);};var _3c8=function(_3c9,_3ca){t.assertEqual(7,_3c9.length);var _3cb=_3c9[(_3c9.length-1)];var _3cc=_3c4.getIdentity(_3cb);_3c4.deleteItem(_3cb);_3c4.newItem({name:"Canada",capital:"Ottawa"});var _3cd=function(_3ce,_3cf){t.assertEqual(7,_3ce.length);var _3d0={};for(var i=0;i<_3ce.length;++i){var item=_3ce[i];var id=_3c4.getIdentity(item);if(_3d0.hasOwnProperty(id)){t.assertTrue(false);}else{_3d0[id]=item;}}d.callback(true);};_3c4.fetch({onComplete:_3cd,onError:_3c5});};_3c4.fetch({onComplete:_3c8,onError:_3c5});return d;}},{name:"Write API: Identity, auto-creation when missing, revert",runTest:function(t){var args={data:{label:"name",items:[{name:"Ecuador",capital:"Quito"},{name:"Egypt",capital:"Cairo"},{name:"El Salvador",capital:"San Salvador"},{name:"Equatorial Guinea",capital:"Malabo"},{name:"Eritrea",capital:"Asmara"},{name:"Estonia",capital:"Tallinn"},{name:"Ethiopia",capital:"Addis Ababa"}]}};var _3d1=new _3.data.AndOrWriteStore(args);var d=new doh.Deferred();var _3d2=function(_3d3,_3d4){d.errback(_3d3);};var _3d5=function(_3d6,_3d7){t.assertEqual(7,_3d6.length);var _3d8=_3d6[(_3d6.length-1)];var _3d9=_3d1.getIdentity(_3d8);_3d1.deleteItem(_3d8);_3d1.newItem({name:"Canada",capital:"Ottawa"});var _3da=function(_3db,_3dc){t.assertEqual(7,_3db.length);var _3dd={};for(var i=0;i<_3db.length;++i){var item=_3db[i];var id=_3d1.getIdentity(item);if(_3dd.hasOwnProperty(id)){t.assertTrue(false);}else{_3dd[id]=item;}}_3d1.revert();var _3de=function(_3df,_3e0){t.assertEqual(7,_3df.length);d.callback(true);};_3d1.fetch({onComplete:_3de,onError:_3d2});};_3d1.fetch({onComplete:_3da,onError:_3d2});};_3d1.fetch({onComplete:_3d5,onError:_3d2});return d;}},{name:"Write API: reference integrity, check references",runTest:function(t){var _3e1=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("reference_integrity"));var d=new doh.Deferred();var _3e2=function(_3e3,_3e4){d.errback(_3e3);};var _3e5=function(_3e6,_3e7){var _3e8=null;var _3e9=null;var _3ea=null;var _3eb=null;var i;for(i=0;i<_3e6.length;i++){var _3ec=_3e1.getIdentity(_3e6[i]);if(_3ec===10){_3e8=_3e6[i];}else{if(_3ec===1){_3e9=_3e6[i];}else{if(_3ec===3){_3ea=_3e6[i];}else{if(_3ec===5){_3eb=_3e6[i];}}}}}var _3ed=_3e1.getValues(_3e8,"friends");t.assertTrue(_3ed!==null);t.assertTrue(_3ed!==undefined);t.assertTrue(_3e1.isItem(_3e8));t.assertTrue(_3e1.isItem(_3e9));t.assertTrue(_3e1.isItem(_3ea));t.assertTrue(_3e1.isItem(_3eb));var _3ee=0;try{for(i=0;i<_3ed.length;i++){if(i===0){t.assertTrue(_3e1.isItem(_3ed[i]));t.assertEqual(_3ed[i],_3e9);t.assertEqual(_3e1.getIdentity(_3ed[i]),1);_3ee++;}else{if(i===1){t.assertTrue(_3e1.isItem(_3ed[i]));t.assertEqual(_3ed[i],_3ea);t.assertEqual(_3e1.getIdentity(_3ed[i]),3);_3ee++;}else{if(i===2){t.assertTrue(_3e1.isItem(_3ed[i]));t.assertEqual(_3ed[i],_3eb);t.assertEqual(_3e1.getIdentity(_3ed[i]),5);_3ee++;}}}}}catch(e){doh.errback(e);}t.assertEqual(3,_3ee);d.callback(true);};_3e1.fetch({onError:_3e2,onComplete:_3e5});return d;}},{name:"Write API: reference integrity, delete referenced item",runTest:function(t){var _3ef=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("reference_integrity"));var d=new doh.Deferred();var _3f0=true;var _3f1=function(_3f2,_3f3){d.errback(_3f2);};var _3f4=function(item,_3f5){try{_3ef.deleteItem(item);function _3f6(_3f7,_3f8){var _3f9=true;for(var i=0;i<_3f7.length;i++){var _3fa=_3f7[i];var _3fb=_3ef.getAttributes(_3fa);for(var j=0;j<_3fb.length;j++){var _3fc=_3ef.getValues(_3fa,_3fb[j]);var _3fd=false;for(var k=0;k<_3fc.length;k++){var _3fe=_3fc[k];try{var id=_3ef.getIdentity(_3fe);if(id==10){_3fd=true;break;}}catch(e){}}if(_3fd){d.errback(new Error("Found a reference remaining to a deleted item.  Failure."));_3f9=false;break;}}}if(_3f9){d.callback(true);}};_3ef.fetch({onComplete:_3f6,onError:_3f1});}catch(error){d.errback(error);}};_3ef.fetchItemByIdentity({identity:10,onError:_3f1,onItem:_3f4});return d;}},{name:"Write API: reference integrity, delete referenced item, then revert",runTest:function(t){var _3ff=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("reference_integrity"));var d=new doh.Deferred();var _400=true;var _401=function(_402,_403){d.errback(_402);};var _404=function(item,_405){try{_3ff._dumpReferenceMap();var _406=_1.toJson(item[_3ff._reverseRefMap]);_3ff.deleteItem(item);_3ff._dumpReferenceMap();var _407=_1.toJson(item[_3ff._reverseRefMap]);_3ff.revert();_3ff._dumpReferenceMap();var _408=_1.toJson(item[_3ff._reverseRefMap]);t.assertTrue(_408===_406);}catch(e){d.errback(e);_400=false;}if(_400){d.callback(true);}};_3ff.fetchItemByIdentity({identity:10,onError:_401,onItem:_404});return d;}},{name:"Write API: reference integrity, delete multiple items with references and revert",runTest:function(t){var _409=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("countries_references"));var d=new doh.Deferred();var _40a=true;var _40b=function(_40c,_40d){d.errback(_40c);t.assertTrue(false);};var _40e=function(item,_40f){t.assertTrue(_409.isItem(item));var _410=item;var _411=function(item,_412){t.assertTrue(_409.isItem(item));var _413=item;_409.deleteItem(_410);_409.deleteItem(_413);try{_409.revert();var _414=function(_415,_416){d.callback(true);};_409.fetch({query:{name:"*"},start:0,count:20,onComplete:_414,onError:_40b});}catch(e){d.errback(e);}};_409.fetchItemByIdentity({identity:"Nairobi",onError:_40b,onItem:_411});};_409.fetchItemByIdentity({identity:"Egypt",onError:_40b,onItem:_40e});return d;}},{name:"Write API: reference integrity, remove reference from attribute",runTest:function(t){var _417=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("reference_integrity"));var d=new doh.Deferred();var _418=true;var _419=function(_41a,_41b){d.errback(_41a);t.assertTrue(false);};var _41c=function(item,_41d){try{_417.setValues(item,"friends",[null]);var _41e=function(_41f,_420){var _421=_41f[_417._reverseRefMap];_417._dumpReferenceMap();t.assertTrue(!_421["11"]["friends"]);_417.setValues(item,"siblings",[0,1,2]);t.assertTrue(!_421["11"]);d.callback(true);};_417.fetchItemByIdentity({identity:10,onError:_419,onItem:_41e});}catch(e){d.errback(e);t.assertTrue(false);}};_417.fetchItemByIdentity({identity:11,onError:_419,onItem:_41c});return d;}},{name:"Write API: reference integrity, delete referenced item non-parent",runTest:function(t){var _422=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("reference_integrity"));var d=new doh.Deferred();var _423=true;var _424=function(_425,_426){d.errback(_425);};var _427=function(item,_428){try{_422.deleteItem(item);function _429(_42a,_42b){var _42c=true;for(var i=0;i<_42a.length;i++){var _42d=_42a[i];var _42e=_422.getAttributes(_42d);for(var j=0;j<_42e.length;j++){var _42f=_422.getValues(_42d,_42e[j]);var _430=false;for(var k=0;k<_42f.length;k++){var _431=_42f[k];try{var id=_422.getIdentity(_431);if(id==16){_430=true;break;}}catch(e){}}if(_430){d.errback(new Error("Found a reference remaining to a deleted item.  Failure."));_42c=false;break;}}}if(_42c){d.callback(true);}};_422.fetch({onComplete:_429,onError:_424});}catch(error){d.errback(error);}};_422.fetchItemByIdentity({identity:16,onError:_424,onItem:_427});return d;}},{name:"Write API: reference integrity, add reference to attribute",runTest:function(t){var _432=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("reference_integrity"));var d=new doh.Deferred();var _433=true;var _434=function(_435,_436){d.errback(_435);t.assertTrue(false);};var _437=function(_438,_439){t.assertTrue(_438.length>2);var _43a=_438[0];var _43b=_438[1];_432.setValue(_43a,"siblings",_43b);t.assertTrue(_43b[_432._reverseRefMap]!==null);t.assertTrue(_43b[_432._reverseRefMap][_432.getIdentity(_43a)]["siblings"]);d.callback(true);};_432.fetch({onError:_434,onComplete:_437});return d;}},{name:"Write API: reference integrity, new item with parent reference",runTest:function(t){var _43c=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("reference_integrity"));var d=new doh.Deferred();var _43d=true;var _43e=function(_43f,_440){d.errback(_43f);t.assertTrue(false);};var _441=function(item,_442){try{var _443=_43c.newItem({id:17,name:"Item 17"},{parent:item,attribute:"uncles"});var refs=_443[_43c._reverseRefMap];t.assertTrue(refs["10"]["uncles"]);}catch(e){d.errback(e);t.assertTrue(false);_43d=false;}if(_43d){d.callback(true);}};_43c.fetchItemByIdentity({identity:10,onError:_43e,onItem:_441});return d;}},{name:"Write API: reference integrity, new item with reference to existing item",runTest:function(t){var _444=new _3.data.AndOrWriteStore(_3.data.tests.stores.AndOrWriteStore.getTestData("reference_integrity"));var d=new doh.Deferred();var _445=true;var _446=function(_447,_448){d.errback(_447);t.assertTrue(false);};var _449=function(item,_44a){try{var _44b=_444.newItem({id:17,name:"Item 17",friends:[item]});var refs=item[_444._reverseRefMap];t.assertTrue(refs["17"]["friends"]);}catch(e){d.errback(e);t.assertTrue(false);_445=false;}if(_445){d.callback(true);}};_444.fetchItemByIdentity({identity:10,onError:_446,onItem:_449});return d;}},{name:"Write API: reference integrity, disable reference integrity",runTest:function(t){var _44c=_3.data.tests.stores.AndOrWriteStore.getTestData("reference_integrity");_44c.referenceIntegrity=false;var _44d=new _3.data.AndOrWriteStore(_44c);var d=new doh.Deferred();var _44e=function(_44f,_450){d.errback(_44f);t.assertTrue(false);};var _451=function(item,_452){if(item[_44d._reverseRefMap]===undefined){d.callback(true);}else{d.errback(new Error("Disabling of reference integrity failed."));}};_44d.fetchItemByIdentity({identity:10,onError:_44e,onItem:_451});return d;}}];return _3.data.tests.stores.AndOrWriteStore.tests;};doh.register("dojox.data.tests.stores.AndOrWriteStore",_3.data.tests.stores.AndOrWriteStore.getTests());});require(["dojox/data/tests/stores/AndOrWriteStore"]);