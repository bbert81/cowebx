/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/html","dojo/_base/event","dojox/gfx/fx","dojox/color"],function(_1,_2,_3,_4,fx,_5){return _1.declare("dojox.geo.charting.Feature",null,{_isZoomIn:false,isSelected:false,markerText:null,constructor:function(_6,_7,_8){this.id=_7;this.shape=_6.mapObj.createGroup();this.parent=_6;this.mapObj=_6.mapObj;this._bbox=_8.bbox;this._center=_8.center;this._defaultFill=_6.defaultColor;this._highlightFill=_6.highlightColor;this._defaultStroke={width:this._normalizeStrokeWeight(0.5),color:"white"};var _9=(_1.isArray(_8.shape[0]))?_8.shape:[_8.shape];_1.forEach(_9,function(_a){this.shape.createPolyline(_a).setStroke(this._defaultStroke);},this);this.unsetValue();},unsetValue:function(){this.value=null;this._defaultFill=this.parent.defaultColor;var _b=new _5.Color(this.parent.defaultColor).toHsl();_b.l=1.2*_b.l;this._highlightFill=_5.fromHsl(_b);this._setFillWith(this._defaultFill);},setValue:function(_c){this.value=_c;if(this.parent.series.length!=0){for(var i=0;i<this.parent.series.length;i++){var _d=this.parent.series[i];if((_c>=_d.min)&&(_c<_d.max)){this._setFillWith(_d.color);this._defaultFill=_d.color;var _e=new _5.Color(_d.color).toHsv();_e.v=(_e.v+20);this._highlightFill=_5.fromHsv(_e);}}}},_setFillWith:function(_f){var _10=(_1.isArray(this.shape.children))?this.shape.children:[this.shape.children];_1.forEach(_10,_1.hitch(this,function(_11){if(this.parent.colorAnimationDuration>0){var _12=fx.animateFill({shape:_11,color:{start:_11.getFill(),end:_f},duration:this.parent.colorAnimationDuration});_12.play();}else{_11.setFill(_f);}}));},_setStrokeWith:function(_13){var _14=(_1.isArray(this.shape.children))?this.shape.children:[this.shape.children];_1.forEach(_14,function(_15){_15.setStroke({color:_13.color,width:_13.width,join:"round"});});},_normalizeStrokeWeight:function(_16){var _17=this.shape._getRealMatrix();return (dojox.gfx.renderer!="vml")?_16/(this.shape._getRealMatrix()||{xx:1}).xx:_16;},_onmouseoverHandler:function(evt){this.parent.onFeatureOver(this);this._setFillWith(this._highlightFill);this.mapObj.marker.show(this.id);},_onmouseoutHandler:function(){this._setFillWith(this._defaultFill);this.mapObj.marker.hide();_1.style("mapZoomCursor","display","none");},_onmousemoveHandler:function(evt){if(this.mapObj.marker._needTooltipRefresh){this.mapObj.marker.show(this.id);}if(this.isSelected){if(parent.enableFeatureZoom){evt=_1.fixEvent(evt||window.event);_1.style("mapZoomCursor","left",evt.pageX+12+"px");_1.style("mapZoomCursor","top",evt.pageY+"px");_1.byId("mapZoomCursor").className=this._isZoomIn?"mapZoomOut":"mapZoomIn";_1.style("mapZoomCursor","display","block");}else{_1.style("mapZoomCursor","display","none");}}},_onclickHandler:function(evt){this.parent.onFeatureClick(this);if(!this.isSelected){this.parent.deselectAll();this.select(true);this._onmousemoveHandler(evt);}else{if(parent.enableFeatureZoom){if(this._isZoomIn){this._zoomOut();}else{this._zoomIn();}}}},select:function(_18){if(_18){this.shape.moveToFront();this._setStrokeWith({color:"black",width:this._normalizeStrokeWeight(2)});this._setFillWith(this._highlightFill);this.isSelected=true;this.parent.selectedFeature=this;}else{this._setStrokeWith(this._defaultStroke);this._setFillWith(this._defaultFill);this.isSelected=false;this._isZoomIn=false;}},_zoomIn:function(){var _19=this.mapObj.marker;_19.hide();this.parent.fitToMapArea(this._bbox,15,true,_1.hitch(this,function(){this._setStrokeWith({color:"black",width:this._normalizeStrokeWeight(2)});_19._needTooltipRefresh=true;this.parent.onZoomEnd(this);}));this._isZoomIn=true;_1.byId("mapZoomCursor").className="";},_zoomOut:function(){var _1a=this.mapObj.marker;_1a.hide();this.parent.fitToMapContents(3,true,_1.hitch(this,function(){this._setStrokeWith({color:"black",width:this._normalizeStrokeWeight(2)});_1a._needTooltipRefresh=true;this.parent.onZoomEnd(this);}));this._isZoomIn=false;_1.byId("mapZoomCursor").className="";},init:function(){this.shape.id=this.id;this.tooltip=null;}});});