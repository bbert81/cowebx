/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/data/ItemFileReadStore"],function(_1,_2){return _1.declare("dojox.geo.openlayers.tests.ecr.EcrRenderer",null,{constructor:function(_3,_4){this._options=_3;this._context=_4;},render:function(_5){var o=this._options;return this._render(o,_5);},_render:function(o,_6){if(o instanceof Array){var _7=[];o.sort(function(i1,i2){var d1=i1.depth;var d2=i2.depth;if(d1!=undefined&&d2!=undefined){var _8=parseInt(d1);var _9=parseInt(d2);if(_8==_9){return 0;}if(_8<_9){return -1;}return 1;}return 0;});_1.forEach(o,function(oi,_a,_b){var co=_1.clone(oi);this._callFunctions(co,_6);this._solveReferences(co,_6);var f=this._render(co,_6);if(f!=null){f.setStroke(co.stroke);f.setFill(co.fill);_7.push(f);}},this);return _7;}var co=_1.clone(o);this._callFunctions(co,_6);this._solveReferences(co,_6);var gf=this._renderItem(co,_6);if(gf!=null){gf.setStroke(co.stroke);gf.setFill(co.fill);}return gf;},_renderItem:function(o,_c){return null;},_callFunctions:function(o,_d){for(var _e in o){if(o.hasOwnProperty(_e)){var v=o[_e];if(typeof v=="function"){o[_e]=v.call(_d,this._context);}else{if(typeof v=="object"){this._callFunctions(v,_d);}}}}},getContext:function(){return this._context;},getContextValue:function(_f){if(this._context){return this._context[_f];}return undefined;},getValue:function(_10,_11){var s=this.getContextValue("store");if((s!=undefined)&&s.isItem(_10)){return s.getValue(_10,_11);}if(_10.hasOwnProperty(_11)){return _10[_11];}return undefined;},_coords:[0,0],getCoordinates:function(_12){var lon=this.getValue(_12,"longitude");var lat=this.getValue(_12,"latitude");var _13=parseFloat(lon);var _14=parseFloat(lat);var a=this._coords;a[0]=_13;a[1]=_14;return a;},_findAttributeValue:function(o,a,_15){var v=undefined;if(_15!=null){v=this.getValue(_15,a);}if(v!=undefined){return v;}v=o[a];if(v!=undefined){return v;}for(var i in o){var ov=o[i];if(typeof (ov)=="object"){var vv=this._findAttributeValue(ov,a,null);if(vv!=undefined){return vv;}}}return undefined;},_solveReferences:function(o,_16){this.__solveReferences(o,o,_16);},__solveReferences:function(oo,o,_17){for(var a in o){var v=o[a];if(typeof (v)=="object"){this.__solveReferences(oo,v,_17);}if(typeof (v)=="string"){var re=/{(.*)}/;if(v.match(re)){v=v.replace(re,"$1");var r=this._findAttributeValue(oo,v,_17);if(r!=undefined){var ps=parseFloat(r);if(isNaN(ps)){o[a]=r;}else{o[a]=ps;}}}}}}});});