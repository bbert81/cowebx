/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/_base/html","dojox/lang/functional"],function(_1,_2,_3,_4,_5){return _1.declare("dojox.geo.charting.KeyboardInteractionSupport",null,{_map:null,_zoomEnabled:false,constructor:function(_6,_7){this._map=_6;if(_7){this._zoomEnabled=_7.enableZoom;}},connect:function(){var _8=_1.byId(this._map.container);_1.attr(_8,{tabindex:0,role:"presentation","aria-label":"map"});this._keydownListener=_1.connect(_8,"keydown",this,"keydownHandler");this._onFocusListener=_1.connect(_8,"focus",this,"onFocus");this._onBlurListener=_1.connect(_8,"blur",this,"onBlur");},disconnect:function(){_1.disconnect(this._keydownListener);this._keydownListener=null;_1.disconnect(this._onFocusListener);this._onFocusListener=null;_1.disconnect(this._onBlurListener);this._onBlurListener=null;},keydownHandler:function(e){switch(e.keyCode){case _1.keys.LEFT_ARROW:this._directTo(-1,-1,1,-1);break;case _1.keys.RIGHT_ARROW:this._directTo(-1,-1,-1,1);break;case _1.keys.UP_ARROW:this._directTo(1,-1,-1,-1);break;case _1.keys.DOWN_ARROW:this._directTo(-1,1,-1,-1);break;case _1.keys.SPACE:if(this._map.selectedFeature&&!this._map.selectedFeature._isZoomIn&&this._zoomEnabled){this._map.selectedFeature._zoomIn();}break;case _1.keys.ESCAPE:if(this._map.selectedFeature&&this._map.selectedFeature._isZoomIn&&this._zoomEnabled){this._map.selectedFeature._zoomOut();}break;default:return;}_1.stopEvent(e);},onFocus:function(e){if(this._map.selectedFeature||this._map.focused){return;}this._map.focused=true;var _9,_a=false;if(this._map.lastSelectedFeature){_9=this._map.lastSelectedFeature;}else{var _b=this._map.getMapCenter(),_c=Infinity;_5.forIn(this._map.mapObj.features,function(_d){var _e=Math.sqrt(Math.pow(_d._center[0]-_b.x,2)+Math.pow(_d._center[1]-_b.y,2));if(_e<_c){_c=_e;_9=_d;}});_a=true;}if(_9){if(_a){_9._onclickHandler(null);}else{}this._map.mapObj.marker.show(_9.id);}},onBlur:function(){this._map.lastSelectedFeature=this._map.selectedFeature;},_directTo:function(up,_f,_10,_11){var _12=this._map.selectedFeature,_13=_12._center[0],_14=_12._center[1],_15=Infinity,_16=null;_5.forIn(this._map.mapObj.features,function(_17){var _18=Math.abs(_13-_17._center[0]),_19=Math.abs(_14-_17._center[1]),_1a=_18+_19;if((up-_f)*(_14-_17._center[1])>0){if(_18<_19&&_15>_1a){_15=_1a;_16=_17;}}if((_10-_11)*(_13-_17._center[0])>0){if(_18>_19&&_15>_1a){_15=_1a;_16=_17;}}});if(_16){this._map.mapObj.marker.hide();_16._onclickHandler(null);this._map.mapObj.marker.show(_16.id);}}});});