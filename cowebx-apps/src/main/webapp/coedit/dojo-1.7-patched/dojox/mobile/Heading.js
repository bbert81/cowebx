/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/html","dojo/_base/array","dojo/_base/lang","./common","dijit/_WidgetBase","dijit/_Container","dijit/_Contained"],function(_1,_2,_3,_4,_5,_6,_7){return dojo.declare("dojox.mobile.Heading",[dijit._WidgetBase,dijit._Container,dijit._Contained],{back:"",href:"",moveTo:"",transition:"slide",label:"",iconBase:"",backProp:{className:"mblArrowButton"},tag:"H1",buildRendering:function(){this.domNode=this.containerNode=this.srcNodeRef||dojo.doc.createElement(this.tag);this.domNode.className="mblHeading";if(!this.label){dojo.forEach(this.domNode.childNodes,function(n){if(n.nodeType==3){var v=dojo.trim(n.nodeValue);if(v){this.label=v;this.labelNode=dojo.create("SPAN",{innerHTML:v},n,"replace");}}},this);}if(!this.labelNode){this.labelNode=dojo.create("SPAN",null,this.domNode);}this.labelNode.className="mblHeadingSpanTitle";this.labelDivNode=dojo.create("DIV",{className:"mblHeadingDivTitle",innerHTML:this.labelNode.innerHTML},this.domNode);},startup:function(){if(this._started){return;}var _8=this.getParent&&this.getParent();if(!_8||!_8.resize){var _9=this;setTimeout(function(){_9.resize();},0);}this.inherited(arguments);},resize:function(){if(this._btn){this._btn.style.width=this._body.offsetWidth+this._head.offsetWidth+"px";}if(this.labelNode){var _a,_b;var _c=this.containerNode.childNodes;for(i=_c.length-1;i>=0;i--){var c=_c[i];if(c.nodeType===1){if(!_b&&dojo.hasClass(c,"mblToolbarButton")&&dojo.style(c,"float")==="right"){_b=c;}if(!_a&&(dojo.hasClass(c,"mblToolbarButton")&&dojo.style(c,"float")==="left"||c===this._btn)){_a=c;}}}if(!this.labelNodeLen&&this.label){this.labelNode.style.display="inline";this.labelNodeLen=this.labelNode.offsetWidth;this.labelNode.style.display="";}var bw=this.domNode.offsetWidth;var rw=_b?bw-_b.offsetLeft+5:0;var lw=_a?_a.offsetLeft+_a.offsetWidth+5:0;var tw=this.labelNodeLen||0;dojo[bw-Math.max(rw,lw)*2>tw?"addClass":"removeClass"](this.domNode,"mblHeadingCenterTitle");}dojo.forEach(this.getChildren(),function(_d){if(_d.resize){_d.resize();}});},_setBackAttr:function(_e){if(!this._btn){var _f=dojo.create("DIV",this.backProp,this.domNode,"first");var _10=dojo.create("DIV",{className:"mblArrowButtonHead"},_f);var _11=dojo.create("DIV",{className:"mblArrowButtonBody mblArrowButtonText"},_f);this._body=_11;this._head=_10;this._btn=_f;this.backBtnNode=_f;this.connect(_11,"onclick","onClick");var _12=dojo.create("DIV",{className:"mblArrowButtonNeck"},_f);}this.back=_e;this._body.innerHTML=this._cv(this.back);this.resize();},_setLabelAttr:function(_13){this.label=_13;this.labelNode.innerHTML=this.labelDivNode.innerHTML=this._cv(_13);},findCurrentView:function(){var w=this;while(true){w=w.getParent();if(!w){return null;}if(w instanceof dojox.mobile.View){break;}}return w;},onClick:function(e){var h1=this.domNode;dojo.addClass(h1,"mblArrowButtonSelected");setTimeout(function(){dojo.removeClass(h1,"mblArrowButtonSelected");},1000);if(this.back&&!this.moveTo&&!this.href&&history){history.back();return;}var _14=this.findCurrentView();if(_14){_14.clickedPosX=e.clientX;_14.clickedPosY=e.clientY;}this.goTo(this.moveTo,this.href);},goTo:function(_15,_16){var _17=this.findCurrentView();if(!_17){return;}if(_16){_17.performTransition(null,-1,this.transition,this,function(){location.href=_16;});}else{if(dojox.mobile.app&&dojox.mobile.app.STAGE_CONTROLLER_ACTIVE){dojo.publish("/dojox/mobile/app/goback");}else{var _18=dijit.byId(_17.convertToId(_15));if(_18){var _19=_18.getParent();while(_17){var _1a=_17.getParent();if(_19===_1a){break;}_17=_1a;}}if(_17){_17.performTransition(_15,-1,this.transition);}}}}});});