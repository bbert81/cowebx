/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/mobile/app/SceneAssistant"],function(_1,_2,_3){_1.getObject("dojox.mobile.tests.imageControlsApp.app.assistants.flickr-image-view-assistant",1);_1.declare("FlickrImageViewAssistant",_3.mobile.app.SceneAssistant,{apiKey:"8c6803164dbc395fb7131c9d54843627",setup:function(){this.controller.parse();var _4=this.viewer=_2.byId("flickrImageView");var _5=this;this.handlePhotoLoad=_1.hitch(this,this.handlePhotoLoad);var _6=this.controller.query(".loading")[0];var _7=_1.connect(_4,"onLoad",function(_8,_9,_a){if(_8=="center"){_1.disconnect(_7);_1.destroy(_6);_6=null;}});var _b=1;var _c=this.controller.query(".report")[0];this.connect(_4,"onChange",function(_d){_5.index+=_d;if(_5.index>0){_4.set("leftUrl",_5.urls[_5.index-1]);}if(_5.index<_5.urls.length-1){_4.set("rightUrl",_5.urls[_5.index+1]);}_c.innerHTML=(_5.index+1)+" of "+_5.urls.length+" "+_5.urls[_5.index].title;});},activate:function(_e){this.dataType=(_e&&_e.type?_e.type:"interesting");switch(this.dataType){case "interesting":this.loadInteresting();break;case "group":this.loadGroup(_e);break;case "data":this.useData(_e.images,_e.index||0);break;}},useData:function(_f,_10){this.urls=_f;this.index=Math.min(_f.length-1,Math.max(0,_10));if(this.index>0){this.viewer.set("leftUrl",_f[this.index-1]);}this.viewer.set("centerUrl",_f[this.index]);if(this.index<_f.length){this.viewer.set("rightUrl",_f[this.index+1]);}},loadInteresting:function(){var _11=this;var url="http://api.flickr.com/services/rest/?method="+"flickr.interestingness.getList";var _12=_1.io.script.get({url:url,content:{api_key:this.apiKey,format:"json"},jsonp:"jsoncallback"});_12.addBoth(this.handlePhotoLoad);},loadGroup:function(_13){var _14=this;var url="http://api.flickr.com/services/rest/?method="+"flickr.groups.pools.getPhotos";var _15=_1.io.script.get({url:url,content:{api_key:this.apiKey,format:"json",group_id:_13.nsid,per_page:20},jsonp:"jsoncallback"});_15.addBoth(this.handlePhotoLoad);},handlePhotoLoad:function(res){if(res&&res.photos&&res.photos.photo){var _16=res.photos.photo;var _17=[];var _18;for(var i=0;i<_16.length;i++){_18="http://farm"+_16[i].farm+".static.flickr.com/"+_16[i].server+"/"+_16[i].id+"_"+_16[i].secret;_17.push({large:_18+"_m.jpg",small:_18+"_t.jpg",title:_16[i].title});}this.urls=_17;this.index=0;this.viewer.set("centerUrl",_17[0]);this.viewer.set("rightUrl",_17[1]);}else{}}});});require(["dojox/mobile/tests/imageControlsApp/app/assistants/flickr-image-view-assistant"]);