/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/mvc","dojox/mvc/StatefulModel","dojo/data/ItemFileWriteStore"],function(_1,_2,_3){_1.getObject("dojox.mvc.tests.models.LoanWizardModel",1);_1.declare("dojox.mvc.tests.models.LoanWizardModel",_3.mvc.StatefulModel,{chartStore:new _1.data.ItemFileWriteStore({data:{"hierarchical":false,"identifier":"id","items":[{"id":"mortgage","x":1,"y":0},{"id":"taxes","x":2,"y":0},{"id":"otherhousing","x":3,"y":0}]}}),constructor:function(_4){this.inherited(arguments);_3.mvc.bindInputs([this.Zip,this.Country],_1.hitch(this,this._lookupAddrs));_3.mvc.bindInputs([this.Mortgage,this.Taxes,this.OtherHousing,this.BaseIncome,this.BonusIncome],_1.hitch(this,this._recomputeTotalAndPercentages));_3.mvc.bind(this.HousingPercent,"value",this.HousingPercent,"valid",_1.hitch(this,this._isHousingLessThanOrEqualToThirtyThreePercent),true);_3.mvc.bind(this.HousingPercent,"value",this.HousingPercent,"relevant",_1.hitch(this,this._nonZeroRelevance),true);_3.mvc.bind(this.TotalHousing,"value",this.TotalHousing,"relevant",_1.hitch(this,this._nonZeroRelevance),true);this._recomputeTotalAndPercentages();},_lookupItem:function(_5,_6){var _7;_5.fetchItemByIdentity({"identity":_6,"onItem":function(_8){_7=_8;}});return _7;},_lookupAddrs:function(){if(this.Zip.get("value")==null||isNaN(this.Zip.get("value"))){return;}var _9=this;var _a={"postalcode":this.Zip.get("value"),"country":this.Country.get("value")};var _b={url:"zips/"+this.Zip.get("value")+".json",sync:true,content:_a,preventCache:true,handleAs:"json",load:function(_c,io){_9.City.set("value",_c.postalcodes[0].placeName);_9.County.set("value",_c.postalcodes[0].adminName2);_9.State.set("value",_c.postalcodes[0].adminCode1);_9.Zip.set("valid",true);},error:function(_d){_9.City.set("value","");_9.County.set("value","");_9.State.set("value","");_9.Zip.set("valid",false);}};var _e=_1.xhrGet(_b);},_recomputeTotalAndPercentages:function(){var _f=parseInt(this.Mortgage.get("value"));var _10=parseInt(this.Taxes.get("value"));var _11=parseInt(this.OtherHousing.get("value"));var _12=_f+_10+_11;var _13=parseInt(this.BaseIncome.get("value"));var _14=parseInt(this.BonusIncome.get("value"));var _15=_13+_14;var _16=Math.round(_12/_15*100);this.HousingPercent.set("value",_16);this.TotalHousing.set("value",_12);this.TotalIncome.set("value",_15);var _17=this._lookupItem(this.chartStore,"mortgage");var _18=this._lookupItem(this.chartStore,"taxes");var _19=this._lookupItem(this.chartStore,"otherhousing");this.chartStore.setValue(_17,"y",_f);this.chartStore.setValue(_18,"y",_10);this.chartStore.setValue(_19,"y",_11);},_isHousingLessThanOrEqualToThirtyThreePercent:function(_1a){return _1a<=33;},_nonZeroRelevance:function(_1b){if(_1b>0){return true;}else{return false;}}});});require(["dojox/mvc/tests/models/LoanWizardModel"]);