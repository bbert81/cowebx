/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojo/dnd/Selector","dojo/dnd/Manager"],function(_1,_2,_3){_1.getObject("dojox.mdnd.PureSource",1);_1.declare("dojox.mdnd.PureSource",_1.dnd.Selector,{horizontal:false,copyOnly:true,skipForm:false,withHandles:false,isSource:true,targetState:"Disabled",generateText:true,constructor:function(_4,_5){_1.mixin(this,_1.mixin({},_5));var _6=this.accept;this.isDragging=false;this.mouseDown=false;this.sourceState="";_1.addClass(this.node,"dojoDndSource");if(this.horizontal){_1.addClass(this.node,"dojoDndHorizontal");}this.topics=[_1.subscribe("/dnd/cancel",this,"onDndCancel"),_1.subscribe("/dnd/drop",this,"onDndCancel")];},onDndCancel:function(){this.isDragging=false;this.mouseDown=false;delete this.mouseButton;},copyState:function(_7){return this.copyOnly||_7;},destroy:function(){_3.mdnd.PureSource.superclass.destroy.call(this);_1.forEach(this.topics,_1.unsubscribe);this.targetAnchor=null;},markupFactory:function(_8,_9){_8._skipStartup=true;return new _3.mdnd.PureSource(_9,_8);},onMouseMove:function(e){if(this.isDragging){return;}_3.mdnd.PureSource.superclass.onMouseMove.call(this,e);var m=_1.dnd.manager();if(this.mouseDown&&!this.isDragging&&this.isSource){var _a=this.getSelectedNodes();if(_a.length){m.startDrag(this,_a,this.copyState(_1.isCopyKey(e)));this.isDragging=true;}}},onMouseDown:function(e){if(this._legalMouseDown(e)&&(!this.skipForm||!_1.dnd.isFormElement(e))){this.mouseDown=true;this.mouseButton=e.button;_3.mdnd.PureSource.superclass.onMouseDown.call(this,e);}},onMouseUp:function(e){if(this.mouseDown){this.mouseDown=false;_3.mdnd.PureSource.superclass.onMouseUp.call(this,e);}},onOverEvent:function(){_3.mdnd.PureSource.superclass.onOverEvent.call(this);_1.dnd.manager().overSource(this);},onOutEvent:function(){_3.mdnd.PureSource.superclass.onOutEvent.call(this);_1.dnd.manager().outSource(this);},_markDndStatus:function(_b){this._changeState("Source",_b?"Copied":"Moved");},_legalMouseDown:function(e){if(!this.withHandles){return true;}for(var _c=e.target;_c&&!_1.hasClass(_c,"dojoDndItem");_c=_c.parentNode){if(_1.hasClass(_c,"dojoDndHandle")){return true;}}return false;}});});require(["dojox/mdnd/PureSource"]);