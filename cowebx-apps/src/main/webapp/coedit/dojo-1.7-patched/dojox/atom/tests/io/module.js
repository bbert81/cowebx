/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo","dijit","dojox","dojox/atom/io/model","dojox/atom/io/Connection","dojox/data/dom","dojo/date/stamp","dojo/date"],function(_1,_2,_3){_1.getObject("dojox.atom.tests.io.module",1);doh.register("dojox.atom.tests.io.module",[function checkCreateDate(t){var _4=document.createElement("div");var _5="2007-08-06T20:00:00-04:00";var _6=_1.date.stamp.fromISOString(_5);_4.innerHTML="  "+_5+"  ";var _7=_3.atom.io.model.util.createDate(_4);var _8=_1.date.compare(_7,_6);t.t(_8===0);},function checkEscapeHTML(t){var _9="<html><head><title>This is a \"Test Title\"</title></head><body class=\"tundra\">Woo hoo, this is an awesome & exciting test case!</body></html>";var _a=_3.atom.io.model.util.escapeHtml(_9);var _b="&lt;html&gt;&lt;head&gt;&lt;title&gt;This is a &quot;Test Title&quot;&lt;/title&gt;&lt;/head&gt;&lt;body class=&quot;tundra&quot;&gt;Woo hoo, this is an awesome &amp; exciting test case!&lt;/body&gt;&lt;/html&gt;";t.is(_b,_a);},function checkUnEscapeHtml(t){var _c="&lt;html&gt;&lt;head&gt;&lt;title&gt;This is a &quot;Test Title&quot;&lt;/title&gt;&lt;/head&gt;&lt;body class=&quot;tundra&quot;&gt;Woo hoo, this is an awesome &amp; exciting test case!&lt;/body&gt;&lt;/html&gt;";var _d=_3.atom.io.model.util.unEscapeHtml(_c);var _e="<html><head><title>This is a \"Test Title\"</title></head><body class=\"tundra\">Woo hoo, this is an awesome & exciting test case!</body></html>";t.is(_e,_d);t.is("&lt;",_3.atom.io.model.util.unEscapeHtml("&amp;lt;"));},function checkGetNodename(t){var _f=document.createElement("div");t.is("div",_3.atom.io.model.util.getNodename(_f).toLowerCase());_f=_3.data.dom.createDocument("<root><first/><second/><third/></root>").firstChild;t.is("root",_3.atom.io.model.util.getNodename(_f));var n=_f.firstChild;_1.forEach(["first","second","third"],function(_10){t.is(_10,_3.atom.io.model.util.getNodename(n));_f.removeChild(n);n=_f.firstChild;});},{name:"checkFeed",runTest:function(t){var d=new doh.Deferred();var _11=new _3.atom.io.Connection();_11.getFeed(_1.moduleUrl("dojox.atom.tests.widget","samplefeed.xml").toString(),function(_12){var i;t.is("Example.com",_12.title.value);_12.setTitle("Example.com Atom Feed","text");t.is("Example.com Atom Feed",_12.title.value);t.is("Example.com's Sample Feed",_12.subtitle.value);t.is("Copyright Example.com",_12.rights);t.is("http://example.com/samplefeed.xml",_12.id);t.is(_1.date.stamp.fromISOString("2007-08-07T20:00:00-05:00"),_12.updated);_12.addNamespace("http://www.test.com");t.is({},_12.name_spaces);_12.addNamespace("","test");t.is({},_12.name_spaces);_12.addNamespace("http://www.test.com","test");t.is({"test":"http://www.test.com"},_12.name_spaces);t.is(null,_12.authors);_12.addAuthor("John");_12.addAuthor("Matt","matt@example.com");_12.addAuthor("Joe","joe@example.com","http://joe.example.com");t.t(_1.isArray(_12.authors));t.t(_12.authors.length===3);t.is(null,_12.contributors);_12.addContributor("Sam");_12.addContributor("Dave","Dave@example.com");_12.addContributor("Harry","harry@example.com","http://harry.example.com");t.t(_1.isArray(_12.contributors));t.t(_12.contributors.length===3);t.t(_1.isArray(_12.links));t.t(_12.links.length===2);_12.removeLink("http://example.com/","alternate");t.t(_12.links.length===1);_12.addLink("http://www.example.com/","alternate","en","Example.com","text/html");t.t(_12.links.length===2);_12.addLink("http://test.example.com/","","en","Example.com","text/html");t.t(_12.links.length===3);_12.removeBasicLinks();t.t(_12.links.length===2);t.is(null,_12.categories);_12.addCategory("scheme","term","label");_12.addCategory("scheme","term2","label2");_12.addCategory("scheme2","term","label");t.t(_1.isArray(_12.categories));t.t(_12.categories.length===3);var c=_12.getCategories("scheme");t.t(c.length===2);c=_12.getCategories("scheme2");t.t(c.length===1);_12.removeCategories("scheme","term2");t.t(_12.categories.length===2);_12.removeCategories("scheme","term");t.t(_12.categories.length===1);_12.removeCategories("scheme2","term");t.t(_12.categories.length===0);t.is(null,_12.extensions);t.is([],_12.getExtensions());_12.addExtension("nameSpace","element",[],"A Test Element","sns");_12.addExtension("nameSpace","element2",[],"Another Test Element","sns");_12.addExtension("anotherNameSpace","element",[],"A Test Element","asns");t.t(_12.extensions.length===3);t.t(_12.getExtensions("nameSpace").length===2);t.t(_12.getExtensions("nameSpace","element").length===1);t.t(_12.getExtensions("anotherNameSpace","element").length===1);t.t(_12.getExtensions("sns").length===2);_12.removeExtensions("anotherNameSpace","element");_12.removeExtensions("sns","element2");t.t(_12.getExtensions("anotherNameSpace").length===0);t.t(_12.getExtensions("sns").length===1);t.t(_12.accept("title"));t.t(_12.accept("entry"));t.f(_12.accept("workspace"));var e=_12.getFirstEntry();t.f(e===null);t.t(e.id==="http://example.com/samplefeed.xml/entry/1");t.t(_12.entries.length===6);_12.removeEntry(e);t.t(_12.entries.length===5);t.t(_12.getEntry("http://example.com/samplefeed.xml/entry/1")===null);e=_12.getFirstEntry();t.t(e.id==="http://example.com/samplefeed.xml/entry/2");e=_12.getEntry("http://example.com/samplefeed.xml/entry/4");t.f(e===null);t.t(e.title.value==="Test Entry #4");e=new _3.atom.io.model.Entry();t.e(Error,_12,"addEntry",[e]);t.t(_12.entries.length===5);e.id="http://example.com/samplefeed.xml/newentry/1";_12.addEntry(e);t.t(_12.entries.length===6);var _13=[];for(i=2;i<5;i++){e=new _3.atom.io.model.Entry();e.id="http://example.com/samplefeed.xml/newentry/"+i;_13.push(e);}_12.setEntries(_13);t.t(_12.entries.length===9);e=_12.getSelfHref();t.t(e==="http://www.example.com/samplefeed.xml");e=_12.createEntry();t.t(e.feedUrl==="http://www.example.com/samplefeed.xml");for(i=2;i<7;i++){e=_12.getEntry("http://example.com/samplefeed.xml/entry/"+i);_12.removeEntry(e);}t.t(_12.entries.length===4);var _14=_1.date.stamp.toISOString(_1.date.stamp.fromISOString("2007-08-07T20:00:00-05:00"));var str="<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<feed xmlns=\"http://www.w3.org/2005/Atom\" xmlns:test=\"http://www.test.com\">\n<id>http://example.com/samplefeed.xml</id>\n<title  type=\"text\" >Example.com Atom Feed</title>\n<rights>Copyright Example.com</rights>\n";str+="<updated>"+_14+"</updated>\n<subtitle  type=\"text\" >Example.com's Sample Feed</subtitle>\n<author>\n\t<name>John</name>\n</author>\n<author>\n\t<name>Matt</name>\n\t<email>matt@example.com</email>\n</author>\n<author>\n\t<name>Joe</name>\n\t<email>joe@example.com</email>\n\t<uri>http://joe.example.com</uri>\n</author>\n<contributor>\n\t<name>Sam</name>\n</contributor>\n<contributor>\n\t<name>Dave</name>\n\t<email>Dave@example.com</email>\n</contributor>\n<contributor>\n\t<name>Harry</name>\n\t<email>harry@example.com</email>\n\t<uri>http://harry.example.com</uri>\n</contributor>\n<sns:element xmlns='nameSpace'>A Test Element</sns:element>\n<entry>\n<id>http://example.com/samplefeed.xml/newentry/1</id>\n</entry>\n<entry>\n<id>http://example.com/samplefeed.xml/newentry/2</id>\n</entry>\n<entry>\n<id>http://example.com/samplefeed.xml/newentry/3</id>\n</entry>\n<entry>\n<id>http://example.com/samplefeed.xml/newentry/4</id>\n</entry>\n</feed>";t.t(_12.toString()==str);d.callback(true);},function(e){d.errback("Feed fetching failed");});return d;}},{name:"checkEntry",runTest:function(t){var d=new doh.Deferred();var _15=new _3.atom.io.Connection();_15.getFeed(_1.moduleUrl("dojox.atom.tests.widget","samplefeedEdit.xml").toString(),function(_16){t.is("Example.com",_16.title.value);var e=_16.createEntry();var str=e.getEditHref();t.t(str===null);e=_16.getFirstEntry();str=e.getEditHref();t.t(str===null);e=_16.getEntry("http://example.com/samplefeedEdit.xml/entry/10");str=e.getEditHref();t.t(str==="http://example.com/samplefeedEdit.xml/entry/edit/10");d.callback(true);},function(){d.errback("Feed fetching failed");});return d;}},{name:"checkXmlEntry",runTest:function(t){var d=new doh.Deferred();var _17=new _3.atom.io.Connection();_17.getFeed(_1.moduleUrl("dojox.atom.tests.io","sampleFeedXMLContent.xml"),function(_18){try{t.is("Example.com",_18.title.value);var e=_18.getFirstEntry();t.t(e.title.value=="Test Entry #1");var c=e.content.value;c=_1.trim(c);t.t(c.indexOf("<rootNode ")===0);d.callback(true);}catch(err){d.errback(err);}},function(){d.errback("Feed fetching failed");});return d;}},{name:"checkEntry_preventCache",runTest:function(t){var d=new doh.Deferred();var _19=new _3.atom.io.Connection(false,true);_19.getFeed(_1.moduleUrl("dojox.atom.tests.widget","samplefeedEdit.xml").toString(),function(_1a){t.is("Example.com",_1a.title.value);var e=_1a.createEntry();var str=e.getEditHref();t.t(str===null);e=_1a.getFirstEntry();str=e.getEditHref();t.t(str===null);e=_1a.getEntry("http://example.com/samplefeedEdit.xml/entry/10");str=e.getEditHref();t.t(str==="http://example.com/samplefeedEdit.xml/entry/edit/10");d.callback(true);},function(){d.errback("Feed fetching failed");});return d;}},{name:"checkAtomIOGetFeedFail",runTest:function(t){var d=new doh.Deferred();var _1b=new _3.atom.io.Connection();_1b.getFeed(_1.moduleUrl("dojox.atom.tests.widget","samplefee.xml").toString(),function(_1c){d.errback("Feed fetching succeeded when it should've failed");},function(_1d,_1e){t.t(_1d.name==="Error");t.t(_1d.status===404);d.callback(true);});return d;}},{name:"checkAtomIOGetFeedSuccess",runTest:function(t){var d=new doh.Deferred();var _1f=new _3.atom.io.Connection();_1f.getFeed(_1.moduleUrl("dojox.atom.tests.widget","samplefeed.xml").toString(),function(_20){t.t(_20.title.value==="Example.com");d.callback(true);},function(_21,_22){d.errback("Feed fetching failed");});return d;}},{name:"checkAtomIOGetEntryFail",runTest:function(t){var d=new doh.Deferred();var _23=new _3.atom.io.Connection();_23.getEntry(_1.moduleUrl("dojox.atom.tests.io","sampleEntr.xml").toString(),function(_24){d.errback("Feed fetching succeeded when it should've failed");},function(_25,_26){t.t(_25.name==="Error");t.t(_25.status===404);d.callback(true);});return d;}},{name:"checkAtomIOGetEntrySuccess",runTest:function(t){var d=new doh.Deferred();var _27=new _3.atom.io.Connection();_27.getEntry(_1.moduleUrl("dojox.atom.tests.io","sampleEntry.xml").toString(),function(_28){t.t(_28.title.value==="Test Entry #1");t.t(_28.id==="http://example.com/sampleEntry.xml/entry/1");d.callback(true);},function(_29,_2a){d.errback("Feed fetching failed");});return d;}},{name:"checkAtomIOGetEntryFeedSuccess",runTest:function(t){var d=new doh.Deferred();var _2b=new _3.atom.io.Connection();_2b.getEntry(_1.moduleUrl("dojox.atom.tests.widget","samplefeed.xml").toString(),function(_2c){t.t(_2c.title.value==="Test Entry #1");t.t(_2c.id==="http://example.com/samplefeed.xml/entry/1");d.callback(true);},function(_2d,_2e){d.errback("Feed fetching failed");});return d;}},{name:"checkGetService",runTest:function(t){var d=new doh.Deferred();var _2f=new _3.atom.io.Connection();_2f.getService(_1.moduleUrl("dojox.atom.tests.io","service.xml").toString(),function(_30,_31){var _32=_30.getCollection("http://example.com/feed");t.t(_32[0].href==="http://example.com/feed");t.t(_32[0].title==="Test Collection");d.callback(true);},function(_33,_34){d.errback("Service fetching failed");});return d;}},{name:"checkAtomIOUpdateEntrySuccess",timeout:5000,runTest:function(t){var d=new doh.Deferred();var _35=new _3.atom.io.Connection();_35.getEntry(_1.moduleUrl("dojox.atom.tests.widget","samplefeed.xml").toString(),function(_36){t.t(_36.title.value==="Test Entry #1");t.t(_36.id==="http://example.com/samplefeed.xml/entry/1");_36.setEditHref(_1.moduleUrl("dojox.atom.tests.io","app.php"));_36.setTitle("<h1>New Editable Title!</h1>","xhtml");_35.updateEntry(_36,function(e,dom,_37){t.t(e.title.value==="<h1>New Editable Title!</h1>");t.t(e.id==="http://example.com/samplefeed.xml/entry/1");d.callback(true);},function(_38,_39){d.errback("Updating entry failed");});},function(_3a,_3b){d.errback("Feed fetching failed");});return d;}},{name:"checkAtomIOUpdateEntryFail",timeout:5000,runTest:function(t){var d=new doh.Deferred();var _3c=new _3.atom.io.Connection();_3c.getEntry(_1.moduleUrl("dojox.atom.tests.widget","samplefeed.xml").toString(),function(_3d){t.t(_3d.title.value==="Test Entry #1");t.t(_3d.id==="http://example.com/samplefeed.xml/entry/1");_3d.setEditHref(_1.moduleUrl("dojox.atom.tests.io","appFail.php"));_3d.setTitle("<h1>New Editable Title!</h1>","xhtml");_3c.updateEntry(_3d,function(e,dom,_3e){d.errback("Updating entry succeeded");},function(_3f,_40){d.callback(true);});},function(_41,_42){d.errback("Updating entry failed.");});return d;}},{name:"checkAtomIOAddEntrySuccess",timeout:5000,runTest:function(t){var d=new doh.Deferred();var _43=new _3.atom.io.model.Entry();_43.setTitle("Test Editable Entry #1","text");_43.addAuthor("Test Person","test@example.com");_43.content=new _3.atom.io.model.Content("content","This is the content of my test new entry!",null,"text");var _44=new _3.atom.io.Connection();_44.addEntry(_43,_1.moduleUrl("dojox.atom.tests.io","app.php").toString(),function(_45,url){t.t(_45.title.value==="Test Editable Entry #1");t.t(url==="http://example.com/samplefeed.xml/entry/10");d.callback(true);},function(_46,_47){d.errback("Adding entry failed.");});return d;}},{name:"checkAtomIOAddEntryFail",timeout:5000,runTest:function(t){var d=new doh.Deferred();var _48=new _3.atom.io.model.Entry();_48.content=new _3.atom.io.model.Content("content","This is the content of my test new entry!",null,"text");var _49=new _3.atom.io.Connection();_49.addEntry(_48,_1.moduleUrl("dojox.atom.tests.io","appFail.php").toString(),function(_4a,url){d.errback("Adding entry succeeded when it shouldn't!");},function(_4b,_4c){d.callback(true);});return d;}},{name:"checkAtomIODeleteEntrySuccess",timeout:5000,runTest:function(t){var d=new doh.Deferred();var _4d=new _3.atom.io.Connection();_4d.getEntry(_1.moduleUrl("dojox.atom.tests.widget","samplefeed.xml").toString(),function(_4e){t.t(_4e.title.value==="Test Entry #1");t.t(_4e.id==="http://example.com/samplefeed.xml/entry/1");_4e.setEditHref(_1.moduleUrl("dojox.atom.tests.io","app.php"));_4d.deleteEntry(_4e,function(_4f){if(_4f){d.callback(true);}else{d.errback("Deleting entry failed");}},function(_50,_51){d.errback("Deleting entry failed");});},function(_52,_53){d.errback("Retreiving the entry failed.");});return d;}},{name:"checkAtomIODeleteEntryFail",timeout:5000,runTest:function(t){var d=new doh.Deferred();var _54=new _3.atom.io.Connection();_54.getEntry(_1.moduleUrl("dojox.atom.tests.widget","samplefeed.xml").toString(),function(_55){t.t(_55.title.value==="Test Entry #1");t.t(_55.id==="http://example.com/samplefeed.xml/entry/1");_55.setEditHref(_1.moduleUrl("dojox.atom.tests.io","appFail.php"));_54.deleteEntry(_55,function(_56){if(_56){d.errback("Deleting entry succeeded but it shouldn't have");}else{d.errback("The callback was called but it shouldn't have");}},function(_57,_58){d.callback(true);});},function(_59,_5a){d.errback("Retreiving the entry failed.");});return d;}}]);});require(["dojox/atom/tests/io/module"]);