/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/kernel","..","dojo/cookie","../_WidgetBase","../_TemplatedMixin","./_LayoutWidget","dojo/_base/array","dojo/_base/connect","dojo/_base/event","dojo/_base/html","dojo/_base/lang","dojo/_base/window"],function(_1,_2){_1.declare("dijit.layout.BorderContainer",_2.layout._LayoutWidget,{design:"headline",gutters:true,liveSplitters:true,persist:false,baseClass:"dijitBorderContainer",_splitterClass:"dijit.layout._Splitter",postMixInProperties:function(){if(!this.gutters){this.baseClass+="NoGutter";}this.inherited(arguments);},startup:function(){if(this._started){return;}_1.forEach(this.getChildren(),this._setupChild,this);this.inherited(arguments);},_setupChild:function(_3){var _4=_3.region;if(_4){this.inherited(arguments);_1.addClass(_3.domNode,this.baseClass+"Pane");var _5=this.isLeftToRight();if(_4=="leading"){_4=_5?"left":"right";}if(_4=="trailing"){_4=_5?"right":"left";}if(_4!="center"&&(_3.splitter||this.gutters)&&!_3._splitterWidget){var _6=_1.getObject(_3.splitter?this._splitterClass:"dijit.layout._Gutter");var _7=new _6({id:_3.id+"_splitter",container:this,child:_3,region:_4,live:this.liveSplitters});_7.isSplitter=true;_3._splitterWidget=_7;_1.place(_7.domNode,_3.domNode,"after");_7.startup();}_3.region=_4;}},layout:function(){this._layoutChildren();},addChild:function(_8,_9){this.inherited(arguments);if(this._started){this.layout();}},removeChild:function(_a){var _b=_a.region;var _c=_a._splitterWidget;if(_c){_c.destroy();delete _a._splitterWidget;}this.inherited(arguments);if(this._started){this._layoutChildren();}_1.removeClass(_a.domNode,this.baseClass+"Pane");_1.style(_a.domNode,{top:"auto",bottom:"auto",left:"auto",right:"auto",position:"static"});_1.style(_a.domNode,_b=="top"||_b=="bottom"?"width":"height","auto");},getChildren:function(){return _1.filter(this.inherited(arguments),function(_d){return !_d.isSplitter;});},getSplitter:function(_e){return _1.filter(this.getChildren(),function(_f){return _f.region==_e;})[0]._splitterWidget;},resize:function(_10,_11){if(!this.cs||!this.pe){var _12=this.domNode;this.cs=_1.getComputedStyle(_12);this.pe=_1._getPadExtents(_12,this.cs);this.pe.r=_1._toPixelValue(_12,this.cs.paddingRight);this.pe.b=_1._toPixelValue(_12,this.cs.paddingBottom);_1.style(_12,"padding","0px");}this.inherited(arguments);},_layoutChildren:function(_13,_14){if(!this._borderBox||!this._borderBox.h){return;}var _15=_1.map(this.getChildren(),function(_16,idx){return {pane:_16,weight:[_16.region=="center"?Infinity:0,_16.layoutPriority,(this.design=="sidebar"?1:-1)*(/top|bottom/.test(_16.region)?1:-1),idx]};},this);_15.sort(function(a,b){var aw=a.weight,bw=b.weight;for(var i=0;i<aw.length;i++){if(aw[i]!=bw[i]){return aw[i]-bw[i];}}return 0;});var _17=[];_1.forEach(_15,function(_18){var _19=_18.pane;_17.push(_19);if(_19._splitterWidget){_17.push(_19._splitterWidget);}});var dim={l:this.pe.l,t:this.pe.t,w:this._borderBox.w-this.pe.w,h:this._borderBox.h-this.pe.h};_2.layout.layoutChildren(this.domNode,dim,_17,_13,_14);},destroyRecursive:function(){_1.forEach(this.getChildren(),function(_1a){var _1b=_1a._splitterWidget;if(_1b){_1b.destroy();}delete _1a._splitterWidget;});this.inherited(arguments);}});_1.extend(_2._WidgetBase,{region:"",layoutPriority:0,splitter:false,minSize:0,maxSize:Infinity});_1.declare("dijit.layout._Splitter",[_2._Widget,_2._TemplatedMixin],{live:true,templateString:"<div class=\"dijitSplitter\" dojoAttachEvent=\"onkeypress:_onKeyPress,onmousedown:_startDrag,onmouseenter:_onMouse,onmouseleave:_onMouse\" tabIndex=\"0\" role=\"separator\"><div class=\"dijitSplitterThumb\"></div></div>",postMixInProperties:function(){this.inherited(arguments);this.horizontal=/top|bottom/.test(this.region);this._factor=/top|left/.test(this.region)?1:-1;this._cookieName=this.container.id+"_"+this.region;},buildRendering:function(){this.inherited(arguments);_1.addClass(this.domNode,"dijitSplitter"+(this.horizontal?"H":"V"));if(this.container.persist){var _1c=_1.cookie(this._cookieName);if(_1c){this.child.domNode.style[this.horizontal?"height":"width"]=_1c;}}},_computeMaxSize:function(){var dim=this.horizontal?"h":"w",_1d=_1.marginBox(this.child.domNode)[dim],_1e=_1.filter(this.container.getChildren(),function(_1f){return _1f.region=="center";})[0],_20=_1.marginBox(_1e.domNode)[dim];return Math.min(this.child.maxSize,_1d+_20);},_startDrag:function(e){if(!this.cover){this.cover=_1.doc.createElement("div");_1.addClass(this.cover,"dijitSplitterCover");_1.place(this.cover,this.child.domNode,"after");}_1.addClass(this.cover,"dijitSplitterCoverActive");if(this.fake){_1.destroy(this.fake);}if(!(this._resize=this.live)){(this.fake=this.domNode.cloneNode(true)).removeAttribute("id");_1.addClass(this.domNode,"dijitSplitterShadow");_1.place(this.fake,this.domNode,"after");}_1.addClass(this.domNode,"dijitSplitterActive dijitSplitter"+(this.horizontal?"H":"V")+"Active");if(this.fake){_1.removeClass(this.fake,"dijitSplitterHover dijitSplitter"+(this.horizontal?"H":"V")+"Hover");}var _21=this._factor,_22=this.horizontal,_23=_22?"pageY":"pageX",_24=e[_23],_25=this.domNode.style,dim=_22?"h":"w",_26=_1.marginBox(this.child.domNode)[dim],max=this._computeMaxSize(),min=this.child.minSize||20,_27=this.region,_28=_27=="top"||_27=="bottom"?"top":"left",_29=parseInt(_25[_28],10),_2a=this._resize,_2b=_1.hitch(this.container,"_layoutChildren",this.child.id),de=_1.doc;this._handlers=(this._handlers||[]).concat([_1.connect(de,"onmousemove",this._drag=function(e,_2c){var _2d=e[_23]-_24,_2e=_21*_2d+_26,_2f=Math.max(Math.min(_2e,max),min);if(_2a||_2c){_2b(_2f);}_25[_28]=_2d+_29+_21*(_2f-_2e)+"px";}),_1.connect(de,"ondragstart",_1.stopEvent),_1.connect(_1.body(),"onselectstart",_1.stopEvent),_1.connect(de,"onmouseup",this,"_stopDrag")]);_1.stopEvent(e);},_onMouse:function(e){var o=(e.type=="mouseover"||e.type=="mouseenter");_1.toggleClass(this.domNode,"dijitSplitterHover",o);_1.toggleClass(this.domNode,"dijitSplitter"+(this.horizontal?"H":"V")+"Hover",o);},_stopDrag:function(e){try{if(this.cover){_1.removeClass(this.cover,"dijitSplitterCoverActive");}if(this.fake){_1.destroy(this.fake);}_1.removeClass(this.domNode,"dijitSplitterActive dijitSplitter"+(this.horizontal?"H":"V")+"Active dijitSplitterShadow");this._drag(e);this._drag(e,true);}finally{this._cleanupHandlers();delete this._drag;}if(this.container.persist){_1.cookie(this._cookieName,this.child.domNode.style[this.horizontal?"height":"width"],{expires:365});}},_cleanupHandlers:function(){_1.forEach(this._handlers,_1.disconnect);delete this._handlers;},_onKeyPress:function(e){this._resize=true;var _30=this.horizontal;var _31=1;var dk=_1.keys;switch(e.charOrCode){case _30?dk.UP_ARROW:dk.LEFT_ARROW:_31*=-1;case _30?dk.DOWN_ARROW:dk.RIGHT_ARROW:break;default:return;}var _32=_1._getMarginSize(this.child.domNode)[_30?"h":"w"]+this._factor*_31;this.container._layoutChildren(this.child.id,Math.max(Math.min(_32,this._computeMaxSize()),this.child.minSize));_1.stopEvent(e);},destroy:function(){this._cleanupHandlers();delete this.child;delete this.container;delete this.cover;delete this.fake;this.inherited(arguments);}});_1.declare("dijit.layout._Gutter",[_2._Widget,_2._TemplatedMixin],{templateString:"<div class=\"dijitGutter\" role=\"presentation\"></div>",postMixInProperties:function(){this.inherited(arguments);this.horizontal=/top|bottom/.test(this.region);},buildRendering:function(){this.inherited(arguments);_1.addClass(this.domNode,"dijitGutter"+(this.horizontal?"H":"V"));}});return _2.layout.BorderContainer;});