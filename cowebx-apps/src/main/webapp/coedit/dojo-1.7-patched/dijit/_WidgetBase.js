/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define(["dojo/_base/kernel",".","dojo/aspect","./_base/manager","dojo/Stateful","dojo/_base/NodeList","dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/html","dojo/_base/lang","dojo/_base/url","dojo/_base/window","dojo/query"],function(_1,_2,_3){_1.declare("dijit._WidgetBase",_1.Stateful,{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:"domNode",dir:"",_setDirAttr:"domNode",textDir:"","class":"",_setClassAttr:{node:"domNode",type:"class"},style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,attributeMap:{},_blankGif:(_1.config.blankGif||_1.moduleUrl("dojo","resources/blank.gif")).toString(),postscript:function(_4,_5){this.create(_4,_5);},create:function(_6,_7){this.srcNodeRef=_1.byId(_7);this._connects=[];this._subscribes=[];this._supportingWidgets=[];if(this.srcNodeRef&&(typeof this.srcNodeRef.id=="string")){this.id=this.srcNodeRef.id;}if(_6){this.params=_6;_1._mixin(this,_6);}this.postMixInProperties();if(!this.id){this.id=_2.getUniqueId(this.declaredClass.replace(/\./g,"_"));}_2.registry.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();var _8=this.srcNodeRef;if(_8&&_8.parentNode&&this.domNode!==_8){_8.parentNode.replaceChild(this.domNode,_8);}}if(this.domNode){this.domNode.setAttribute("widgetId",this.id);}this.postCreate();if(this.srcNodeRef&&!this.srcNodeRef.parentNode){delete this.srcNodeRef;}this._created=true;},_applyAttributes:function(){var _9=this.constructor,_a=_9._setterAttrs;if(!_a){_a=(_9._setterAttrs=[]);for(var _b in this.attributeMap){_a.push(_b);}var _c=_9.prototype;for(var _d in _c){if(_d in this.attributeMap){continue;}var _e="_set"+_d.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase();})+"Attr";if(_e in _c){_a.push(_d);}}}_1.forEach(_a,function(_f){if(this.params&&_f in this.params){}else{if(this[_f]){this.set(_f,this[_f]);}}},this);for(var _10 in this.params){this.set(_10,this[_10]);}},postMixInProperties:function(){},buildRendering:function(){if(!this.domNode){this.domNode=this.srcNodeRef||_1.create("div");}if(this.baseClass){var _11=this.baseClass.split(" ");if(!this.isLeftToRight()){_11=_11.concat(_1.map(_11,function(_12){return _12+"Rtl";}));}_1.addClass(this.domNode,_11);}},postCreate:function(){},startup:function(){this._started=true;},destroyRecursive:function(_13){this._beingDestroyed=true;this.destroyDescendants(_13);this.destroy(_13);},destroy:function(_14){this._beingDestroyed=true;this.uninitialize();var d=_1,dfe=d.forEach,dun=d.unsubscribe;dfe(this._connects,function(_15){d.disconnect(_15);});dfe(this._subscribes,function(_16){dun(_16);});dfe(this._supportingWidgets||[],function(w){if(w.destroyRecursive){w.destroyRecursive();}else{if(w.destroy){w.destroy();}}});this.destroyRendering(_14);_2.registry.remove(this.id);this._destroyed=true;},destroyRendering:function(_17){if(this.bgIframe){this.bgIframe.destroy(_17);delete this.bgIframe;}if(this.domNode){if(_17){_1.removeAttr(this.domNode,"widgetId");}else{_1.destroy(this.domNode);}delete this.domNode;}if(this.srcNodeRef){if(!_17){_1.destroy(this.srcNodeRef);}delete this.srcNodeRef;}},destroyDescendants:function(_18){_1.forEach(this.getChildren(),function(_19){if(_19.destroyRecursive){_19.destroyRecursive(_18);}});},uninitialize:function(){return false;},_setStyleAttr:function(_1a){var _1b=this.domNode;if(_1.isObject(_1a)){_1.style(_1b,_1a);}else{if(_1b.style.cssText){_1b.style.cssText+="; "+_1a;}else{_1b.style.cssText=_1a;}}this._set("style",_1a);},_attrToDom:function(_1c,_1d,_1e){_1e=arguments.length>=3?_1e:this.attributeMap[_1c];_1.forEach(_1.isArray(_1e)?_1e:[_1e],function(_1f){var _20=this[_1f.node||_1f||"domNode"];var _21=_1f.type||"attribute";switch(_21){case "attribute":if(_1.isFunction(_1d)){_1d=_1.hitch(this,_1d);}var _22=_1f.attribute?_1f.attribute:(/^on[A-Z][a-zA-Z]*$/.test(_1c)?_1c.toLowerCase():_1c);_1.attr(_20,_22,_1d);break;case "innerText":_20.innerHTML="";_20.appendChild(_1.doc.createTextNode(_1d));break;case "innerHTML":_20.innerHTML=_1d;break;case "class":_1.replaceClass(_20,_1d,this[_1c]);break;}},this);},get:function(_23){var _24=this._getAttrNames(_23);return this[_24.g]?this[_24.g]():this[_23];},set:function(_25,_26){if(typeof _25==="object"){for(var x in _25){this.set(x,_25[x]);}return this;}var _27=this._getAttrNames(_25),_28=this[_27.s];if(_1.isFunction(_28)){var _29=_28.apply(this,Array.prototype.slice.call(arguments,1));}else{var _2a=this.focusNode?"focusNode":"domNode",map=_25 in this.attributeMap?this.attributeMap[_25]:_27.s in this?this[_27.s]:(_25 in this[_2a]||/^aria-|^role$/.test(_25))?_2a:null;if(map!=null){this._attrToDom(_25,_26,map);}this._set(_25,_26);}return _29||this;},_attrPairNames:{},_getAttrNames:function(_2b){var apn=this._attrPairNames;if(apn[_2b]){return apn[_2b];}var uc=_2b.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase();});return (apn[_2b]={n:_2b+"Node",s:"_set"+uc+"Attr",g:"_get"+uc+"Attr"});},_set:function(_2c,_2d){var _2e=this[_2c];this[_2c]=_2d;if(this._watchCallbacks&&this._created&&_2d!==_2e){this._watchCallbacks(_2c,_2e,_2d);}},on:function(_2f,_30){_2f=_2f.replace(/^on/,"");return _3.after(this,"on"+_2f.charAt(0).toUpperCase()+_2f.substr(1),_30,true);},toString:function(){return "[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]";},getDescendants:function(){return this.containerNode?_1.query("[widgetId]",this.containerNode).map(_2.byNode):[];},getChildren:function(){return this.containerNode?_2.findWidgets(this.containerNode):[];},connect:function(obj,_31,_32){var _33=_1.connect(obj,_31,this,_32);this._connects.push(_33);return _33;},disconnect:function(_34){for(var i=0;i<this._connects.length;i++){if(this._connects[i]==_34){_1.disconnect(_34);this._connects.splice(i,1);return;}}},subscribe:function(_35,_36){var _37=_1.subscribe(_35,this,_36);this._subscribes.push(_37);return _37;},unsubscribe:function(_38){for(var i=0;i<this._subscribes.length;i++){if(this._subscribes[i]==_38){_1.unsubscribe(_38);this._subscribes.splice(i,1);return;}}},isLeftToRight:function(){return this.dir?(this.dir=="ltr"):_1._isBodyLtr();},isFocusable:function(){return this.focus&&(_1.style(this.domNode,"display")!="none");},placeAt:function(_39,_3a){if(_39.declaredClass&&_39.addChild){_39.addChild(this,_3a);}else{_1.place(this.domNode,_39,_3a);}return this;},getTextDir:function(_3b,_3c){return _3c;},applyTextDir:function(_3d,_3e){}});return _2._WidgetBase;});