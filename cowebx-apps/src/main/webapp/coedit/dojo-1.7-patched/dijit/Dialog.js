/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

define("*text/dijit/templates/Dialog.html","<div class=\"dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\n\t<div dojoAttachPoint=\"titleBar\" class=\"dijitDialogTitleBar\">\n\t<span dojoAttachPoint=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\n\t<span dojoAttachPoint=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" dojoAttachEvent=\"ondijitclick: onCancel\" title=\"${buttonCancel}\" role=\"button\" tabIndex=\"-1\">\n\t\t<span dojoAttachPoint=\"closeText\" class=\"closeText\" title=\"${buttonCancel}\">x</span>\n\t</span>\n\t</div>\n\t\t<div dojoAttachPoint=\"containerNode\" class=\"dijitDialogPaneContent\"></div>\n</div>\n");define(["dojo/_base/kernel",".","dijit/focus","dojo/text!./templates/Dialog.html","dojo/dnd/move","dojo/dnd/TimedMoveable","dojo/fx","dojo/window","./_Widget","./_TemplatedMixin","./_CssStateMixin","./form/_FormMixin","./_DialogMixin","./DialogUnderlay","./layout/ContentPane","dojo/i18n!./nls/common","dojo/_base/Deferred","dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/event","dojo/_base/fx","dojo/_base/html","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/dnd/Moveable","dojo/fx","dojo/i18n"],function(_1,_2,_3,_4){_1.declare("dijit._DialogBase",[_2._TemplatedMixin,_2.form._FormMixin,_2._DialogMixin,_2._CssStateMixin],{templateString:_4,baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},_setTitleAttr:[{node:"titleNode",type:"innerHTML"},{node:"titleBar",type:"attribute"}],open:false,duration:_2.defaultDuration,refocus:true,autofocus:true,_firstFocusItem:null,_lastFocusItem:null,doLayout:false,draggable:true,"aria-describedby":"",postMixInProperties:function(){var _5=_1.i18n.getLocalization("dijit","common");_1.mixin(this,_5);this.inherited(arguments);},postCreate:function(){_1.style(this.domNode,{display:"none",position:"absolute"});_1.body().appendChild(this.domNode);this.inherited(arguments);this.connect(this,"onExecute","hide");this.connect(this,"onCancel","hide");this._modalconnects=[];},onLoad:function(){this._position();if(this.autofocus&&_2._DialogLevelManager.isTop(this)){this._getFocusItems(this.domNode);_2.focus(this._firstFocusItem);}this.inherited(arguments);},_endDrag:function(e){if(e&&e.node&&e.node===this.domNode){this._relativePosition=_1.position(e.node);}},_setup:function(){var _6=this.domNode;if(this.titleBar&&this.draggable){this._moveable=(_1.isIE==6)?new _1.dnd.TimedMoveable(_6,{handle:this.titleBar}):new _1.dnd.Moveable(_6,{handle:this.titleBar,timeout:0});this._dndListener=_1.subscribe("/dnd/move/stop",this,"_endDrag");}else{_1.addClass(_6,"dijitDialogFixed");}this.underlayAttrs={dialogId:this.id,"class":_1.map(this["class"].split(/\s/),function(s){return s+"_underlay";}).join(" ")};},_size:function(){this._checkIfSingleChild();if(this._singleChild){if(this._singleChildOriginalStyle){this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle;}delete this._singleChildOriginalStyle;}else{_1.style(this.containerNode,{width:"auto",height:"auto"});}var mb=_1._getMarginSize(this.domNode);var _7=_1.window.getBox();if(mb.w>=_7.w||mb.h>=_7.h){var w=Math.min(mb.w,Math.floor(_7.w*0.75)),h=Math.min(mb.h,Math.floor(_7.h*0.75));if(this._singleChild&&this._singleChild.resize){this._singleChildOriginalStyle=this._singleChild.domNode.style.cssText;this._singleChild.resize({w:w,h:h});}else{_1.style(this.containerNode,{width:w+"px",height:h+"px",overflow:"auto",position:"relative"});}}else{if(this._singleChild&&this._singleChild.resize){this._singleChild.resize();}}},_position:function(){if(!_1.hasClass(_1.body(),"dojoMove")){var _8=this.domNode,_9=_1.window.getBox(),p=this._relativePosition,bb=p?null:_1._getBorderBox(_8),l=Math.floor(_9.l+(p?p.x:(_9.w-bb.w)/2)),t=Math.floor(_9.t+(p?p.y:(_9.h-bb.h)/2));_1.style(_8,{left:l+"px",top:t+"px"});}},_onKey:function(_a){if(_a.charOrCode){var dk=_1.keys;var _b=_a.target;if(_a.charOrCode===dk.TAB){this._getFocusItems(this.domNode);}var _c=(this._firstFocusItem==this._lastFocusItem);if(_b==this._firstFocusItem&&_a.shiftKey&&_a.charOrCode===dk.TAB){if(!_c){_2.focus(this._lastFocusItem);}_1.stopEvent(_a);}else{if(_b==this._lastFocusItem&&_a.charOrCode===dk.TAB&&!_a.shiftKey){if(!_c){_2.focus(this._firstFocusItem);}_1.stopEvent(_a);}else{while(_b){if(_b==this.domNode||_1.hasClass(_b,"dijitPopup")){if(_a.charOrCode==dk.ESCAPE){this.onCancel();}else{return;}}_b=_b.parentNode;}if(_a.charOrCode!==dk.TAB){_1.stopEvent(_a);}else{if(!_1.isOpera){try{this._firstFocusItem.focus();}catch(e){}}}}}}},show:function(){if(this.open){return;}if(!this._started){this.startup();}if(!this._alreadyInitialized){this._setup();this._alreadyInitialized=true;}if(this._fadeOutDeferred){this._fadeOutDeferred.cancel();}this._modalconnects.push(_1.connect(window,"onscroll",this,"layout"));this._modalconnects.push(_1.connect(window,"onresize",this,function(){var _d=_1.window.getBox();if(!this._oldViewport||_d.h!=this._oldViewport.h||_d.w!=this._oldViewport.w){this.layout();this._oldViewport=_d;}}));this._modalconnects.push(_1.connect(this.domNode,"onkeypress",this,"_onKey"));_1.style(this.domNode,{opacity:0,display:""});this._set("open",true);this._onShow();this._size();this._position();var _e;this._fadeInDeferred=new _1.Deferred(_1.hitch(this,function(){_e.stop();delete this._fadeInDeferred;}));_e=_1.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:_1.hitch(this,function(){_2._DialogLevelManager.show(this,this.underlayAttrs);}),onEnd:_1.hitch(this,function(){if(this.autofocus&&_2._DialogLevelManager.isTop(this)){this._getFocusItems(this.domNode);_2.focus(this._firstFocusItem);}this._fadeInDeferred.callback(true);delete this._fadeInDeferred;})}).play();return this._fadeInDeferred;},hide:function(){if(!this._alreadyInitialized){return;}if(this._fadeInDeferred){this._fadeInDeferred.cancel();}var _f;this._fadeOutDeferred=new _1.Deferred(_1.hitch(this,function(){_f.stop();delete this._fadeOutDeferred;}));this._fadeOutDeferred.then(_1.hitch(this,"onHide"));_f=_1.fadeOut({node:this.domNode,duration:this.duration,onEnd:_1.hitch(this,function(){this.domNode.style.display="none";_2._DialogLevelManager.hide(this);this._fadeOutDeferred.callback(true);delete this._fadeOutDeferred;})}).play();if(this._scrollConnected){this._scrollConnected=false;}_1.forEach(this._modalconnects,_1.disconnect);this._modalconnects=[];if(this._relativePosition){delete this._relativePosition;}this._set("open",false);return this._fadeOutDeferred;},layout:function(){if(this.domNode.style.display!="none"){if(_2._underlay){_2._underlay.layout();}this._position();}},destroy:function(){if(this._fadeInDeferred){this._fadeInDeferred.cancel();}if(this._fadeOutDeferred){this._fadeOutDeferred.cancel();}if(this._moveable){this._moveable.destroy();}if(this._dndListener){_1.unsubscribe(this._dndListener);}_1.forEach(this._modalconnects,_1.disconnect);_2._DialogLevelManager.hide(this);this.inherited(arguments);}});_1.declare("dijit.Dialog",[_2.layout.ContentPane,_2._DialogBase],{});_2._DialogLevelManager={show:function(_10,_11){var ds=_2._dialogStack;ds[ds.length-1].focus=_3.curNode;var _12=_2._underlay;if(!_12||_12._destroyed){_12=_2._underlay=new _2.DialogUnderlay(_11);}else{_12.set(_10.underlayAttrs);}var _13=ds[ds.length-1].dialog?ds[ds.length-1].zIndex+2:950;if(ds.length==1){_12.show();}_1.style(_2._underlay.domNode,"zIndex",_13-1);_1.style(_10.domNode,"zIndex",_13);ds.push({dialog:_10,underlayAttrs:_11,zIndex:_13});},hide:function(_14){var ds=_2._dialogStack;if(ds[ds.length-1].dialog==_14){ds.pop();var pd=ds[ds.length-1];if(ds.length==1){if(!_2._underlay._destroyed){_2._underlay.hide();}}else{_1.style(_2._underlay.domNode,"zIndex",pd.zIndex-1);_2._underlay.set(pd.underlayAttrs);}if(_14.refocus){var _15=pd.focus;if(pd.dialog&&(!_15||!_1.isDescendant(_15,pd.dialog.domNode))){pd.dialog._getFocusItems(pd.dialog.domNode);_15=pd.dialog._firstFocusItem;}if(_15){_15.focus();}}}else{var idx=_1.indexOf(_1.map(ds,function(_16){return _16.dialog;}),_14);if(idx!=-1){ds.splice(idx,1);}}},isTop:function(_17){var ds=_2._dialogStack;return ds[ds.length-1].dialog==_17;}};_2._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}];return _2.Dialog;});